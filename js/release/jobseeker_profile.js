var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobseekerProfile=(function(a){var p;var aQ=function(aU){aQ={jobseekers:aU+"jobseekers/:id",relocations:aU+"jobseekers/:id/relocations",educations:aU+"jobseekers/:id/educations",positions:aU+"jobseekers/:id/positions",jobseekerSkills:aU+"jobseekers/:id/skills",photos:aU+"files",formPhoto:aU+"files/form",fetchPhoto:aU+"files/fetch",resumes:aU+"resumes",formResume:aU+"resumes/form",fetchResume:aU+"resumes/fetch",countries:"/api/v1.0/countries",provinces:"/api/v1.0/provinces?countryId=:id",memberStatuses:"/api/v1.0/memberstatuses",careerLevels:"/api/v1.0/careerlevels",locations:aU+"locations?pageSize=7&types=town%2Cprovince%2Ccountry",skills:aU+"skills?pageSize=7"}};var c=Backbone.Model.extend({_validators:{required:function(aX,aU,aY,aV,aW){if(!aY||(aY+"").trim()==""){aW.push({attr:aU,message:aX.message||(" is required")})}},maxLength:function(aX,aU,aY,aV,aW){if(!aY||(aY+"").trim()==""){return}if(aY.trim().length>aX.max){aW.push({attr:aU,message:aX.message||String.format(" exceeds {0} characters",aX.max)})}},regex:function(aX,aU,aY,aV,aW){if(!aY||(aY+"").trim()==""){return}if(!aX.pattern.test(aY.trim())){aW.push({attr:aU,message:aX.message||(" is invalid")})}},custom:function(aX,aU,aZ,aV,aW){if(!aX.isValid){throw new Error("isValid missing for custom validation")}var aY=aX.isValid(aX,aU,aZ,aV);if(aY===true){return}if(aY===false){aW.push({attr:aU,message:aX.message});return}if(_.isString(aY)){aW.push({attr:aU,message:aY});return}throw new Error("validity not supported.")}},isValid:function(){if(!this.validations){return true}var aV=[];for(var aU in this.attributes){if(!this.attributes.hasOwnProperty(aU)){continue}if(!this.validations[aU]){continue}var aX=this.validations[aU];for(var aW in aX){if(!aX.hasOwnProperty(aW)){continue}if(!this._validators[aW]){throw new Error("Validation "+aW+" not supported.")}this._validators[aW](aX[aW],aU,this.attributes[aU],this.attributes,aV)}}if(aV.length>0){this.trigger("validation-error",this,aV);return false}else{return true}}});var aL=Backbone.Model.extend({defaults:{ready:false,error:null}});var e=Backbone.Model.extend({collection:Backbone.Collection,listName:"",url:"",initialize:function(){this._loading=false;this._loaded=false;this._list=new this.collection()},getList:function(){if(!this._loaded){this._load()}return this._list},_load:function(){var aU=this;if(!this._loading){this._list.state.set({ready:false,error:null});this._loading=true;var aV=this.url;if(_.isFunction(aV)){aV=aV.call(this)}a.ajax({url:aV,dataType:"json",cache:true,type:"GET",success:function(aX,aY,aW){aU._list.reset(aX.data);aU._list.state.set({ready:true,error:null});aU._loaded=true},error:function(aX,aY,aW){aU._list.state.set({error:String.format("Error retrieving {0} list.",aU.listName)})},complete:function(aW,aX){aU._loading=false}})}}});var m=Backbone.Model.extend({initialize:function(){this.provinceCache=new ai(null,{countryId:this.id})}});var l=Backbone.Collection.extend({model:m,initialize:function(){this.state=new aL()}});var n=e.extend({collection:l,listName:"country",url:function(){return aQ.countries},getCountries:function(){return this.getList()}});var ah=Backbone.Model.extend({});var aj=Backbone.Collection.extend({model:ah,initialize:function(){this.state=new aL()}});var ai=e.extend({collection:aj,listName:"province",url:function(){return aQ.provinces.replace(":id",this._countryId)},initialize:function(aU,aV){e.prototype.initialize.call(this,aU,aV);this._countryId=aV.countryId},getProvinces:function(){return this.getList()}});var H=Backbone.Model.extend({});var L=Backbone.Collection.extend({model:H,initialize:function(){this.state=new aL()}});var I=e.extend({collection:L,listName:"member status",url:function(){return aQ.memberStatuses},getMemberStatuses:function(){return this.getList()}});var f=Backbone.Model.extend({});var j=Backbone.Collection.extend({model:f,initialize:function(){this.state=new aL()}});var g=e.extend({collection:j,listName:"career level",url:function(){return aQ.careerLevels},getCareerLevels:function(){return this.getList()}});var y=c.extend({defaults:{state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null},setError:function(aU){this.set({state:"error",error:aU})},setUploading:function(aU){this.set({state:"uploading"})},setFile:function(aV,aU){this.set({state:"uploaded",token:aV,fileName:aU})},setIdle:function(aV,aU){this.set({state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null})},setFileSize:function(aU){if(aU===0){this.set({fileSize:"? KB"})}else{if(aU>1024*1024){this.set({fileSize:(Math.round(aU*100/(1024*1024))/100).toString()+"MB"})}else{this.set({fileSize:(Math.round(aU*100/1024)/100).toString()+"KB"})}}},isUploaded:function(){return this.get("state")==="uploaded"},isUploading:function(){return this.get("state")==="uploading"},sendUrl:null,sendName:null,fetchUrl:null,send:function(aW,aU){var aV=new FormData();aV.append(this.sendName,aW);var aX=new XMLHttpRequest();aX.upload.addEventListener("progress",aU.progress,false);aX.addEventListener("load",aU.load,false);aX.addEventListener("error",aU.error,false);aX.addEventListener("abort",aU.abort,false);aX.open("POST",this.sendUrl());aX.setRequestHeader("Accept","application/json");aX.send(aV)},fetch:function(aX,aV,aU,aW){aW||(aW={});var aY=this;a.ajax({url:this.fetchUrl(),contentType:"application/json",data:JSON.stringify({url:aV,accessToken:aU,source:aX}),dataType:"json",type:"POST",success:function(a0,a1,aZ){if(aW.success){aW.success(aY,a0)}},error:function(a0,a2,aZ){if(a0.status===400){var a1=JSON.parse(a0.responseText);if(aW.error){aW.error(aY,a1.message);return}}if(aW.error){aW.error(aY,"Error connecting to the server.")}}})}});var T=y.extend({maxFileSize:5,fileTypes:["png","jpg"],fileTypeMessage:"Only PNG and JPG file types allowed.",sendUrl:function(){return aQ.photos},sendName:"file",fetchUrl:function(){return aQ.fetchPhoto},includeDropbox:true,includeWeb:true});var aB=y.extend({maxFileSize:1,fileTypes:["docx","doc","rtf","pdf","txt"],fileTypeMessage:"Only Word, Plain Text, PDF, RTF file types allowed.",sendUrl:function(){return aQ.resumes},sendName:"file",fetchUrl:function(){return aQ.fetchResume},includeDropbox:true,includeWeb:false});var G=c.extend({initialize:function(){this._loading=false;this.state=new aL();this.photo=new R();this.photo.jobseeker=this;this.relocations=new av();this.relocations.jobseeker=this;this.educations=new v();this.educations.jobseeker=this;this.positions=new aa();this.positions.jobseeker=this;this.skills=new aI();this.skills.jobseeker=this;this.resume=new ay();this.resume.jobseeker=this;this.on("change:published",this.onPublishedChange,this)},onPublishedChange:function(){if(this.previous("published")===undefined){return}if(this.get("published")&&!this.previous("published")&&window.dataLayer){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobseekerProfilePublish",eventLabel:undefined,nonInteraction:false})}},url:function(){return aQ.jobseekers.replace(":id",this.id)},parse:function(aV,aU){this.photo.setPhotoUrl(aV.photoUrl);delete aV.photoUrl;this.relocations.reset(aV.relocations);delete aV.relocations;this.educations.reset(aV.educations);delete aV.educations;this.positions.reset(aV.positions);delete aV.positions;this.skills.reset(aV.skills);delete aV.skills;this.resume.set({url:aV.resumeUrl,fileType:aV.resumeFileType});delete aV.resumeUrl;delete aV.resumeFileType;return aV},fetch:function(aU){aU||(aU={});var aV=this;if(this._loading){return}this.state.set({ready:false,error:null});this._loading=true;a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(aX,aY,aW){aV.set(aV.parse(aX));aV.state.set({ready:true,error:null});if(aU.success){aU.success(aV,aX)}},error:function(aY,aZ,aX){var aW=aY.status===400?JSON.parse(aY.responseText).message:"Error retrieving profile.";aV.state.set({error:aW});if(aU.error){aU.error(aV,aW)}},complete:function(aW,aX){aV._loading=false}})},save:function(aU,aV){aV||(aV={});var aW=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aU),dataType:"json",type:"PUT",success:function(aY,aZ,aX){delete aY.photoUrl;delete aY.educations;delete aY.positions;delete aY.skills;delete aY.resumeUrl;delete aY.resumeFileType;aW.set(aY);if(aV.success){aV.success(aW,aY)}},error:function(aY,a0,aX){if(aY.status===400){var aZ=JSON.parse(aY.responseText);if(aV.error){aV.error(aW,aZ.message);return}}if(aV.error){aV.error(aW,"Error connecting to the server.")}}})}});var R=c.extend({defaults:{photoUrl:null},initialize:function(){this.file=new T()},url:function(){return aQ.jobseekers.replace(":id",this.jobseeker.id)},getDisplayUrl:function(){if(this.get("photoUrl")&&this.get("photoUrl").get("url")){return this.get("photoUrl").get("url")}else{return"/images/profile_missing.png"}},setPhotoUrl:function(aU){this.set({photoUrl:new U({url:aU,previous:this.get("photoUrl")})})},replace:function(aU){this.save(JSON.stringify({photoToken:this.file.get("token")}),aU)},"delete":function(aU){this.save(JSON.stringify({photoUrl:""}),aU)},save:function(aU,aV){aV||(aV={});var aW=this;a.ajax({url:this.url(),contentType:"application/json",data:aU,dataType:"json",type:"PUT",success:function(aY,aZ,aX){aW.setPhotoUrl(aY.photoUrl);if(aV.success){aV.success(aW,aY)}},error:function(aY,a0,aX){if(aY.status===400){var aZ=JSON.parse(aY.responseText);if(aV.error){aV.error(aW,aZ.message);return}}if(aV.error){aV.error(aW,"Error connecting to the server.")}}})},undo:function(aU){aU||(aU={});var aV=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({photoUrl:this.get("photoUrl").get("previous").get("url")}),dataType:"json",type:"PUT",success:function(aX,aY,aW){aV.set({photoUrl:aV.get("photoUrl").get("previous")});if(aU.success){aU.success(aV,aX)}},error:function(aX,aZ,aW){if(aX.status===400){var aY=JSON.parse(aX.responseText);if(aU.error){aU.error(aV,aY.message);return}}if(aU.error){aU.error(aV,"Error connecting to the server.")}}})}});var U=Backbone.Model.extend({});var ak=c.extend({save:function(aU,aV){var aW=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aU),dataType:"json",type:this.isNew()?"POST":"PUT",success:function(aY,aZ,aX){aW.set(aY);if(aV.success){aV.success(aW,aY)}},error:function(aY,a0,aX){if(aY.status===400){var aZ=JSON.parse(aY.responseText);if(aV.error){aV.error(aW,aZ.message);return}}if(aV.error){aV.error(aW,"Error connecting to the server.")}}})},"delete":function(aU){var aV=this;a.ajax({url:this.url(),contentType:"application/json",dataType:"json",type:"DELETE",success:function(aX,aY,aW){aV.set(aX);if(aU.success){aU.success(aV,aX)}},error:function(aX,aZ,aW){if(aX.status===400){var aY=JSON.parse(aX.responseText);if(aU.error){aU.error(aV,aY.message);return}}if(aU.error){aU.error(aV,"Error connecting to the server.")}}})}});var aq=ak.extend({defaults:{location:null},isNew:function(){return !this.get("location")||!this.get("location").id},url:function(){if(this.isNew()){return aQ.relocations.replace(":id",this.collection.jobseeker.id)}else{return aQ.relocations.replace(":id",this.collection.jobseeker.id)+"/"+this.get("location").id}}});var av=Backbone.Collection.extend({model:aq});var r=ak.extend({defaults:{school:"",degree:null,fieldOfStudy:"",startYear:null,endYear:null},url:function(){if(this.isNew()){return aQ.educations.replace(":id",this.collection.jobseeker.id)}else{return aQ.educations.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var v=Backbone.Collection.extend({model:r});var W=ak.extend({defaults:{title:"",company:"",start:null,end:null,duration:""},url:function(){if(this.isNew()){return aQ.positions.replace(":id",this.collection.jobseeker.id)}else{return aQ.positions.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var aa=Backbone.Collection.extend({model:W});var aE=ak.extend({defaults:{type:"",proficiency:null,experience:null},url:function(){if(this.isNew()){return aQ.jobseekerSkills.replace(":id",this.collection.jobseeker.id)}else{return aQ.jobseekerSkills.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var aI=Backbone.Collection.extend({model:aE});var ay=c.extend({initialize:function(){this.file=new aB()},url:function(){return aQ.jobseekers.replace(":id",this.jobseeker.id)},replace:function(aU){aU||(aU={});var aV=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({resumeToken:this.file.get("token")}),dataType:"json",type:"PUT",success:function(aX,aY,aW){aV.set({url:aX.resumeUrl,fileType:aX.resumeFileType});if(aU.success){aU.success(aV,aX)}},error:function(aX,aZ,aW){if(aX.status===400){var aY=JSON.parse(aX.responseText);if(aU.error){aU.error(aV,aY.message);return}}if(aU.error){aU.error(aV,"Error connecting to the server.")}}})}});var d=function(aU){this.parent=null;this.children=[];Backbone.View.apply(this,[aU])};_.extend(d.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error").html()),loaderClass:"flex-loader",renderState:function(aU){if(aU.get("error")){a(this.el).html(this.errorTemplate({error:aU.get("error")}));return true}if(!aU.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(aU){var aV=document.createElement("div");aV.className=this.loaderClass;a(aU).empty().append(aV)},hideSavingState:function(){this.$el.children().removeClass("invisible").end().find(".flex-loader-mini").remove()},showSavingState:function(){this.$el.children().addClass("invisible").end().prepend('<div class="flex-loader-mini"></div>')},addChildren:function(aU){var aV,aW=this;if(_.isArray(aU)){aV=aU}else{aV=_.toArray(arguments)}_.each(aV,function(aX){aW.children.push(aX);aX.parent=aW});if(aV.length===1){return aV[0]}else{return aV}},disposeChildren:function(aU){if(!aU){return}var aW=this;var aV=_.isArray(aU)?aU:_.toArray(arguments);_.each(aV,function(aX){aX.dispose()})},disposeAllChildren:function(){var aU=this.children.slice(0);_.each(aU,function(aV){aV.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(aU){var aV=_.indexOf(this.children,aU);if(aV!==-1){this.children.splice(aV,1)}}});d.extend=Backbone.View.extend;var b=function(aU){d.apply(this,[aU]);this.listenTo(this.model,"validation-error",this.onValidationError,this);if(this.model.state){this.listenTo(this.model.state,"change",this.render)}if(aU.countries){this._currentProvinces=null;this.listenTo(aU.countries.state,"change",this.render)}};_.extend(b.prototype,d.prototype,{_validatable:false,events:{submit:"onSubmit","keyup input,textarea":"onKeyup","change select,input":"onChange",validate:"validateIfReady"},onSaveSuccess:function(aU,aV){},onSaveError:function(aV,aU){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aU).show()},onValidationError:function(aY,aW){var aU=this.$('[data-element="alert_danger_server"]');aU.html("");for(var aX=aW.length;aX--;){var aV=aW[aX];if(_.isString(aV)){aU.html(aV).show()}else{this.$("input[name="+aV.attr+"],textarea[name="+aV.attr+"],select[name="+aV.attr+"]").each(function(){if(this.tagName==="SELECT"){a(this).siblings(".select2-container").addClass("error")}else{a(this).addClass("error")}}).closest(".form-group").find(".form-error").html(aV.message).show()}}this.onSaveError()},onSubmit:function(aV){aV.preventDefault();this._validatable=true;var aU=this.getFormValues();if(this.isValid(aU)){this.save(aU)}},save:function(aU){this.showSavingState();this.model.save(aU,{success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},getFormValues:function(){var aV=this;var aU={};this.$("input,textarea,select").each(function(){if(this.name&&!this.disabled){if(this.type==="radio"&&!this.checked){return}if(this.type==="checkbox"&&!this.checked){return}aU[this.name]=aU[this.name]?aU[this.name]+","+a(this).val():a(this).val()}});this.formPreProcess(aU);return aU},isValid:function(aU){this.$(".error").removeClass("error");this.$(".form-error").hide();return this.model.isValid(aU)},formPreProcess:function(aU){},onKeyup:function(aU){if(aU.which===13){return}this.validateIfReady()},onChange:function(aV){var aU=a(aV.currentTarget);if(aU.attr("name")==="country.id"){this.onCountryChange()}this.validateIfReady()},validateIfReady:function(){if(this._validatable){this.isValid(this.getFormValues())}},onCountryChange:function(){var aW=this.$('select[name="country.id"]').val();if(aW){var aV=this.options.countries.get(aW);var aX=aV.provinceCache.getProvinces();this._currentProvinces=aX;if(!aX.state.get("ready")){var aU=this.$('select[name="province.id"]').closest('[data-element="province_input_section"]');if(aU.find(".select2-container").length){aU.append('<span data-element="loader" class="flex-loader-mini"></span>').find(".select2-container").css("visibility","hidden")}this.listenTo(aX.state,"change",this.renderProvinces);return}this.renderProvinces(aX.state)}},renderProvinces:function(aW){if(this._currentProvinces.state!==aW){return}var aX=this;var aU=this.$('select[name="province.id"]');aU.closest('[data-element="province_input_section"]').find('[data-element="loader"]').remove().end().find(".select2-container").css("visibility","visible");if(aW.get("error")){JOBCENTRE.alertFloater.show({summary:aW.get("error"),isError:true,duration:5000});return}if(!aW.get("ready")){throw new Error("Provinces not ready.")}var aV=[];aV.push('<option value=""></option>');this._currentProvinces.each(function(aY){aV.push(String.format('<option value="{0}"{1}>{2}</option>',aY.id,(aX.model.get("province")&&aX.model.get("province").id==aY.id)?' selected="selected"':"",aY.get("name")))});aU.html(aV.join("")).trigger("change")},renderCountries:function(){var aV=this,aU=[];aU.push('<option value=""></option>');this.options.countries.each(function(aW){aU.push(String.format('<option value="{0}"{1}>{2}</option>',aW.id,(aV.model.get("country")&&(aV.model.get("country").id==aW.id))?' selected="selected"':"",aW.get("name")))});this.$('select[name="country.id"]').html(aU.join("")).change()},bindSelect2:function(){var aV=this;var aU=function(){aV.$("select").select2({allowClear:true})};if(!a.contains(document.documentElement,this.el)){setTimeout(aU,10)}else{aU()}}});b.extend=d.extend;var aP=d.extend({validate:function(aW,aV){if(aW>this.model.maxFileSize*1024*1024){return String.format("File exceeds {0} MB.",this.model.maxFileSize)}var aU=_.last(aV.split(".")).toLowerCase();if(!_.contains(this.model.fileTypes,aU)){return this.model.fileTypeMessage}}});var z=aP.extend({source:null,template:_.template(a("#file_upload").html()),events:{'change [data-element="file_input"]':"initializeUpload"},initializeUpload:function(){this.model.setUploading();this.uploadFile()},render:function(){this.$el.html(this.template({file:this.model,viewId:this.cid}));return this}},{create:function(aU){if(window.FormData){return new aT(aU)}else{return new F(aU)}}});var aT=z.extend({uploadFile:function(){var aU=this.$('[data-element="file_input"]')[0].files[0];if(!aU){this.model.setError("File could not be selected.");return}if(this.validate(aU.size,aU.name)){this.model.setError(this.validate(aU.size,aU.name));return}this.model.set({fileName:aU.name});this.model.setFileSize(aU.size);this.model.send(aU,{progress:_.bind(this.progress,this),load:_.bind(this.load,this),error:_.bind(this.error,this),abort:_.bind(this.abort,this)})},progress:function(aU){if(!aU.lengthComputable){return}var aV=Math.round(aU.loaded*100/aU.total);this.model.set({progress:aV})},load:function(aU){var aV=JSON.parse(aU.target.responseText);if(aU.target.status!==200){this.model.setError(aV.message);return}this.model.setFile(aV.token,aV.name)},error:function(){this.model.setError("Upload failed.")},abort:function(){this.model.setError("Upload cancelled.")}});var F=z.extend({uploadFile:function(){window[this.options.callback]=_.bind(this.load,this);document.getElementById(this.options.iframeId).onload=_.bind(this.load,this);this.trigger("submit-file")},load:function(aU,aV){if(!aV){try{aV=window.frames[this.options.iframeId].document.getElementsByTagName("body")[0].innerHTML;aV=JSON.parse(aV)}catch(aU){this.model.setError("Upload failed.");return}}if(aV.success){this.model.setFile(aV.data.token,aV.data.name)}else{this.model.setError(aV.data.message)}}});var q=aP.extend({source:"Dropbox",template:_.template(a("#dropbox_upload").html()),events:{"click a":"onClick"},onClick:function(aU){var aV=this;aU.preventDefault();Dropbox.choose({linkType:"direct",success:function(aW){if(aW.length<1){aV.model.setError("File could not be selected.");return}if(aV.validate(aW[0].bytes,aW[0].name)){aV.model.setError(aV.validate(aW[0].bytes,aW[0].name));return}aV.model.setUploading();aV.model.set({fileName:aW[0].name});aV.model.setFileSize(aW[0].bytes);aV.model.fetch("Dropbox",aW[0].link,null,{success:_.bind(aV.success,aV),error:_.bind(aV.error,aV)})},cancel:function(){}})},success:function(aU,aV){this.model.setFile(aV.token,aV.name)},error:function(aU,aV){this.model.setError(aV)},onScriptLoaded:function(){if(Dropbox.isBrowserSupported()){this.$el.html(this.template(this.model))}},render:function(){JOBCENTRE.lazyLoad.js("https://www.dropbox.com/static/api/1/dropins.js",_.bind(this.onScriptLoaded,this),{id:"dropboxjs","data-app-key":p});return this}});var aS=aP.extend({source:"Web",template:_.template(a("#web_upload").html()),events:{"submit form":"onSubmit"},onSubmit:function(aU){aU.preventDefault();if(!this.$("[name=web_upload]").val().trim()){return}this.model.setUploading();this.model.fetch("Web",this.$("[name=web_upload]").val(),null,{success:_.bind(this.success,this),error:_.bind(this.error,this)})},success:function(aU,aV){this.model.setFile(aV.token,aV.name)},error:function(aU,aV){this.model.setError(aV)},render:function(){this.$el.html(this.template(this.model));return this}});var aD=d.extend({initialize:function(){this.content=null},events:{'click [data-action="edit"]':"renderEdit",'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){var aU=this;if(this.model.isNew()){this.model.collection.remove(this.model);this.$el.fadeOut("fast",function(){aU.dispose()})}else{this.renderDetails()}},renderDetails:function(){var aU=this;if(this.content){this.content.$el.fadeOut("fast",function(){aU.disposeChildren(aU.content);aU.content=aU.addChildren(aU.detailsView());aU.content.on("render-deleted",aU.renderDeleted,aU);aU.content.$el.hide();aU.$el.append(aU.content.render().el);aU.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.detailsView());this.content.on("render-deleted",aU.renderDeleted,aU);this.$el.append(this.content.render().el)}},renderEdit:function(){var aU=this;if(this.content){this.content.$el.fadeOut("fast",function(){aU.disposeChildren(aU.content);aU.content=aU.addChildren(aU.editView());aU.content.on("render-details",aU.renderDetails,aU);aU.content.on("render-deleted",aU.renderDeleted,aU);aU.content.$el.hide();aU.$el.append(aU.content.render().el);aU.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.editView());this.content.on("render-details",this.renderDetails,aU);this.content.on("render-deleted",aU.renderDeleted,aU);this.content.$el.hide();this.$el.append(this.content.render().el);this.content.$el.fadeIn("fast")}},renderDeleted:function(){var aU=this;this.content.$el.fadeOut("fast",function(){aU.disposeChildren(aU.content);aU.content=aU.addChildren(aU.removedView());aU.content.on("render-details",aU.renderDetails,aU);aU.content.$el.hide();aU.$el.append(aU.content.render().el);aU.content.$el.fadeIn("fast")})},removedView:function(){throw new Error("Not Implemented.")},render:function(){if(this.model.isNew()){this.renderEdit()}else{this.renderDetails()}return this}});var N=d.extend({className:"clearfix flex-relative",initialize:function(aU){this.listenTo(this.model.state,"change",this.render)},render:function(){if(this.renderState(this.model.state)){return this}this.$el.empty();if(this.options.enabled.headline_text||this.options.enabled.headline_publish){this.$el.append(this.addChildren(new D({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}if(this.options.enabled.status){this.$el.append(this.addChildren(new aO({model:this.model,requireVerification:this.options.requireVerification})).render().el)}if(this.options.enabled.identity){this.$el.append(this.addChildren(new E({model:this.model,countries:this.options.countries})).render().el);this.$el.append("<hr />")}if(this.options.enabled.memberStatus){this.$el.append(this.addChildren(new M({model:this.model,memberStatuses:this.options.memberStatuses})).render().el)}if(this.options.enabled.careerLevel){this.$el.append(this.addChildren(new k({model:this.model,careerLevels:this.options.careerLevels})).render().el)}if(this.options.enabled.positionTypes){this.$el.append(this.addChildren(new af({model:this.model})).render().el)}if(this.options.enabled.relocations){this.$el.append(this.addChildren(new aw({collection:this.model.relocations})).render().el)}if(this.options.enabled.educations){this.$el.append(this.addChildren(new w({collection:this.model.educations})).render().el)}if(this.options.enabled.positions){this.$el.append(this.addChildren(new ab({collection:this.model.positions})).render().el)}if(this.options.enabled.skills){this.$el.append(this.addChildren(new aJ({collection:this.model.skills})).render().el)}if(this.options.enabled.resume){this.$el.append(this.addChildren(new aC({model:this.model.resume})).render().el)}return this}});var D=d.extend({className:"alert alert-info text-center clearfix",render:function(){if(this.options.enabled.headline_text){this.$el.append(this.addChildren(new C()).render().el)}if(this.options.enabled.headline_publish){this.$el.append(this.addChildren(new B({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}return this}});var C=d.extend({template:_.template(a("#headline_text").html()),render:function(){this.$el.html(this.template());return this}});var B=b.extend({template:_.template(a("#headline_publish").html()),templateCtaOnPublish:_.template(a("#cta_on_publish").html()),className:"editor-cta",initialize:function(){this.listenTo(this.model,"change:published",this.render)},events:{"click [data-action=publish-now]":"onPublishNowClick"},onPublishNowClick:function(aU){if(!this.options.requireVerification){this.save({published:true});return}var aV=this;var aW=this.addChildren(new aR());aW.on("verified",function(){aV.disposeAllChildren();aV.save({published:true})});a("body").append(aW.render().el)},renderPrivate:function(){this.$el.html(this.template({enabled:this.options.enabled}))},renderPublished:function(){this.$el.empty();if(this.options.enabled.cta_on_publish){this.$el.html(this.templateCtaOnPublish())}},render:function(){if(this.model.get("published")){this.renderPublished()}else{this.renderPrivate()}return this}});var o=d.extend({render:function(){return this}});var aO=aD.extend({className:"editor-status-wrapper",initialize:function(aU){aD.prototype.initialize.call(this,aU);this.listenTo(this.model,"change:published",this.render);this.listenTo(this.model,"change:confidential",this.render)},detailsView:function(){return new aM({model:this.model})},editView:function(){return new aN({model:this.model,requireVerification:this.options.requireVerification})}});var aM=d.extend({template:_.template(a("#status_details").html()),className:"flex-relative flex-p10",render:function(){this.$el.html(this.template(this.model.toJSON()));var aU="alert alert-warning";if(this.model.get("published")){if(this.model.get("confidential")){aU="alert alert-info"}else{if(this.model.get("blockRecruiters")){aU="alert alert-info"}else{aU="alert alert-success"}}}this.$el.addClass(aU);return this}});var aN=b.extend({template:_.template(a("#status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",onSaveSuccess:function(aU,aV){this.trigger("render-details")},formPreProcess:function(aU){switch(aU.jobseeker_profile_status){case"visible":aU.published=true;aU.confidential=false;aU.blockRecruiters=false;break;case"blockRecruiters":aU.published=true;aU.confidential=false;aU.blockRecruiters=true;break;case"confidential":aU.published=true;aU.confidential=true;aU.blockRecruiters=false;break;case"private":aU.published=false;aU.confidential=false;aU.blockRecruiters=false;break;default:throw new Error()}delete aU.jobseeker_profile_status},onSubmit:function(aU){if(!this.options.requireVerification){b.prototype.onSubmit.call(this,aU);return}var aV=this;aU.preventDefault();switch(a("[name=jobseeker_profile_status]:checked").val()){case"visible":case"blockRecruiters":case"confidential":var aW=this.addChildren(new aR());aW.on("verified",function(){aV.disposeAllChildren();b.prototype.onSubmit.call(aV,aU)});a("body").append(aW.render().el);return;case"private":b.prototype.onSubmit.call(this,aU);return;default:throw new Error()}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aR=d.extend({template:_.template(a("#verification").html()),events:{"change input":"onInputChange","click [data-action=cancel]":"onCancelClick"},onCancelClick:function(){this.dispose()},onInputChange:function(){if(this.$("[name=verification]").prop("checked")){this.trigger("verified")}},render:function(){this.$el.html(this.template());return this}});var E=d.extend({template:_.template(a("#identity").html()),className:"clearfix flex-mv10",render:function(){this.$el.html(this.template());this.$('[data-outlet="photo"]').append(this.addChildren(new V({model:this.model.photo})).render().el);this.addChildren(new Q({el:this.$('[data-outlet="personal_info"]')[0],model:this.model,countries:this.options.countries})).render();return this}});var Q=aD.extend({detailsView:function(){return new O({model:this.model})},editView:function(){return new P({model:this.model,countries:this.options.countries})}});var O=d.extend({template:_.template(a("#personal_info_details").html()),className:"flex-p10 flex-m0 clearfix",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var P=b.extend({template:_.template(a("#personal_info_edit").html()),className:"container-muted flex-p10 flex-m0 flex-relative clearfix flex-minheight200",onCountryChange:function(){b.prototype.onCountryChange.call(this);this.$('[data-outlet="legal_right"]').toggle(this.$('select[name="country.id"]').val()!="124")},onSaveSuccess:function(aU,aV){this.trigger("render-details")},formPreProcess:function(aU){aU.country={id:aU["country.id"]};delete aU["country.id"];aU.province={id:aU["province.id"]};delete aU["province.id"]},render:function(){if(this.renderState(this.options.countries.state)){return this}this.$el.html(this.template(this.model.toJSON()));this.renderCountries();this.bindSelect2();return this}});var M=aD.extend({className:"clearfix",detailsView:function(){return new J({model:this.model})},editView:function(){return new K({model:this.model,memberStatuses:this.options.memberStatuses})}});var J=d.extend({template:_.template(a("#member_status_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({memberStatus:this.model.get("memberStatus")}));return this}});var K=b.extend({template:_.template(a("#member_status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aU){this.listenTo(aU.memberStatuses.state,"change",this.render)},onSaveSuccess:function(aU,aV){this.trigger("render-details")},formPreProcess:function(aU){aU.memberStatus={id:aU["memberStatus.id"]};delete aU["memberStatus.id"]},renderMemberStatuses:function(){if(this.model.get("memberStatus")&&this.model.get("memberStatus").id==3){throw new Error("PSI student cannot change member status.")}var aV=this,aU=[];aU.push('<option value=""></option>');this.options.memberStatuses.each(function(aW){if(aW.id==3){return}aU.push(String.format('<option value="{0}"{1}>{2}</option>',aW.id,aV.model.get("memberStatus")&&aV.model.get("memberStatus").id==aW.id?' selected="selected"':"",aW.get("name")))});this.$('select[name="memberStatus.id"]').html(aU.join("")).change()},render:function(){if(this.renderState(this.options.memberStatuses.state)){return this}this.$el.html(this.template({memberStatus:this.model.get("memberStatus")}));this.renderMemberStatuses();this.bindSelect2();return this}});var k=aD.extend({className:"clearfix",detailsView:function(){return new h({model:this.model})},editView:function(){return new i({model:this.model,careerLevels:this.options.careerLevels})}});var h=d.extend({template:_.template(a("#career_level_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));return this}});var i=b.extend({template:_.template(a("#career_level_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aU){this.listenTo(aU.careerLevels.state,"change",this.render)},onSaveSuccess:function(aU,aV){this.trigger("render-details")},formPreProcess:function(aU){aU.careerLevel={id:aU["careerLevel.id"]};delete aU["careerLevel.id"]},renderCareerLevels:function(){var aV=this,aU=[];aU.push('<option value=""></option>');this.options.careerLevels.each(function(aW){aU.push(String.format('<option value="{0}"{1}>{2}</option>',aW.id,aV.model.get("careerLevel")&&aV.model.get("careerLevel").id==aW.id?' selected="selected"':"",aW.get("name")))});this.$('select[name="careerLevel.id"]').html(aU.join("")).change()},render:function(){if(this.renderState(this.options.careerLevels.state)){return this}this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));this.renderCareerLevels();this.bindSelect2();return this}});var af=d.extend({className:"clearfix",template:_.template(a("#position_types_wrapper").html()),render:function(){this.$el.html(this.template());this.addChildren(new ae({el:this.$('[data-outlet="position_types"]')[0],model:this.model})).render();return this}});var ae=aD.extend({detailsView:function(){return new ac({model:this.model})},editView:function(){return new ad({model:this.model})}});var ac=d.extend({template:_.template(a("#position_types_details").html()),className:"clearfix flex-relative",render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var ad=b.extend({template:_.template(a("#position_types_edit").html()),className:"container-muted flex-p10 clearfix flex-relative",onSaveSuccess:function(aU,aV){this.trigger("render-details")},formPreProcess:function(aU){aU.positionTypes=_.map(aU.positionTypes.split(","),function(aV){return{id:aV}})},render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var ao=d.extend({events:{'click [data-action="add_new"]':"onAddNew"},onAddNew:function(){var aU=this.newModel();this.collection.add(aU);this.renderItem(aU)},renderItems:function(){var aU=this;this.collection.each(function(aV){aU.renderItem(aV)})},renderItem:function(aU){var aV=this.addChildren(this.newView(aU));this.$('[data-outlet="qualifications"]').append(aV.render().el);return aV},render:function(){this.$el.html(this.template());this.renderItems();return this}});var aw=ao.extend({className:"clearfix",newModel:function(){return new aq()},newView:function(aU){return new ax({model:aU})},template:_.template(a("#relocations").html())});var w=ao.extend({newModel:function(){return new r()},newView:function(aU){return new x({model:aU})},template:_.template(a("#educations").html())});var ab=ao.extend({newModel:function(){return new W()},newView:function(aU){return new ag({model:aU})},template:_.template(a("#positions").html())});var aJ=ao.extend({newModel:function(){return new aE()},newView:function(aU){return new aK({model:aU})},template:_.template(a("#skills").html())});var ap=aD.extend({});var ax=ap.extend({detailsView:function(){return new ar({model:this.model})},editView:function(){return new at({model:this.model})},removedView:function(){return new au({model:this.model})}});var x=ap.extend({detailsView:function(){return new s({model:this.model})},editView:function(){return new t({model:this.model})},removedView:function(){return new u({model:this.model})}});var ag=ap.extend({detailsView:function(){return new X({model:this.model})},editView:function(){return new Y({model:this.model})},removedView:function(){return new Z({model:this.model})}});var aK=ap.extend({detailsView:function(){return new aF({model:this.model})},editView:function(){return new aG({model:this.model})},removedView:function(){return new aH({model:this.model})}});var al=d.extend({className:"flex-relative",events:{'click [data-action="remove"]':"delete"},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aU,aV){this.trigger("render-deleted")},onDeleteError:function(aV,aU){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aU).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var ar=al.extend({template:_.template(a("#relocation_details").html())});var s=al.extend({template:_.template(a("#education_details").html())});var X=al.extend({template:_.template(a("#position_details").html())});var aF=al.extend({template:_.template(a("#skill_details").html()),className:"flex-relative flex-p5"});var am=b.extend({className:"container-muted flex-p10 flex-mt5 flex-mb15 clearfix flex-relative",events:function(){return _.extend({},b.prototype.events,{'click [data-action="remove"]':"delete"})},onSaveSuccess:function(aU,aV){this.trigger("render-details")},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aU,aV){this.trigger("render-deleted")},onDeleteError:function(aV,aU){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aU).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.isNew()){this.$el.addClass("new")}this.bindSelect2();return this}});var at=am.extend({template:_.template(a("#relocation_edit").html()),formPreProcess:function(aU){aU.location={description:aU["location.description"]};delete aU["location.description"]},render:function(){var aV=this;am.prototype.render.call(this);var aU=function(){aV.$('input[name="location.description"]').jsonSuggest({url:aQ.locations,textPropertyName:"description",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aU,10)}else{aU()}return this}});var t=am.extend({template:_.template(a("#education_edit").html()),formPreProcess:function(aU){aU.degree={id:aU["degree.id"]};delete aU["degree.id"]}});var Y=am.extend({template:_.template(a("#position_edit").html()),events:function(){return _.extend({},am.prototype.events(),{"change [name=isCurrent]":"onIsCurrentChange"})},onIsCurrentChange:function(aU){this.$('[data-outlet="end_date"]').fadeToggle("fast")},formPreProcess:function(aU){aU.start=aU.startMonth&&aU.startYear?aU.startYear+"-"+aU.startMonth+"-01":"";aU.end=aU.endMonth&&aU.endYear&&!aU.isCurrent?aU.endYear+"-"+aU.endMonth+"-01":"";delete aU.startMonth;delete aU.startYear;delete aU.endMonth;delete aU.endYear;delete aU.isCurrent}});var aG=am.extend({template:_.template(a("#skill_edit").html()),formPreProcess:function(aU){aU.proficiency={id:aU["proficiency.id"]};aU.experience={id:aU["experience.id"]};delete aU["proficiency.id"];delete aU["experience.id"]},render:function(){var aV=this;am.prototype.render.call(this);var aU=function(){aV.$('input[name="type"]').jsonSuggest({url:aQ.skills,textPropertyName:"name",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aU,10)}else{aU()}return this}});var an=d.extend({className:"flex-p10 flex-mv15 container-warning flex-relative",events:{'click [data-action="undo"]':"onUndoClick"},onUndoClick:function(){this.model.set("id",null);this.showSavingState();this.model.save(this.model.toJSON(),{success:_.bind(this.onUndoSuccess,this),error:_.bind(this.onUndoError,this)})},onUndoSuccess:function(aU,aV){this.trigger("render-details")},onUndoError:function(aV,aU){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aU).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var au=an.extend({template:_.template(a("#relocation_removed").html()),onUndoClick:function(){this.model.set("location",{description:this.model.get("location").description});an.prototype.onUndoClick.call(this)}});var u=an.extend({template:_.template(a("#education_removed").html())});var Z=an.extend({template:_.template(a("#position_removed").html())});var aH=an.extend({template:_.template(a("#skill_removed").html())});var A=d.extend({template:_.template(""),uploadingTemplate:_.template(a("#file_uploading").html()),progressTemplate:_.template(a("#file_progress").html()),errorTemplate:_.template(a("#file_error").html()),initialize:function(){this.fileUploadView=null;this.listenTo(this.model.file,"change:state",this.onStateChange);this.listenTo(this.model.file,"change:progress",this.onProgressChange);this.listenTo(this.model.file,"change:token",this.onTokenChange)},renderButton:function(){this.renderUploadButton();if(this.model.file.includeDropbox){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new q({model:this.model.file})).render().el)}if(this.model.file.includeWeb){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new aS({model:this.model.file})).render().el)}this.onStateChange(this.model.file,this.model.file.get("state"))},onSubmitFile:function(){this.$("form").submit()},showButton:function(){this.$('[data-element="upload_title"]').show();this.$('[data-outlet="file_uploaders"]').show();this.disposeChildren(this.fileUploadView);this.renderUploadButton()},renderUploadButton:function(){this.fileUploadView=this.addChildren(z.create({model:this.model.file,callback:this.$("input[name=callback]").val(),iframeId:this.$("iframe")[0].id}));this.fileUploadView.on("submit-file",this.onSubmitFile,this);this.$('[data-outlet="file_uploaders"]').prepend(this.fileUploadView.render().el)},hideButton:function(){this.$('[data-outlet="file_uploaders"]').hide();this.$('[data-element="upload_title"]').hide()},onStateChange:function(aU,aV){switch(aV){case"idle":return;case"uploading":this.$('[data-element="error_message"]').html("").hide();this.$('[data-element="upload_progress"]').html(this.uploadingTemplate(this.model.file.toJSON())).show();this.hideButton();return;case"uploaded":return;case"error":this.$('[data-element="error_message"]').html(this.errorTemplate(this.model.file.toJSON())).show();this.$('[data-element="upload_progress"]').html("").hide();this.showButton();return;default:throw new Error(String.format("State {0} not supported.",aV))}},onProgressChange:function(aU,aV){if(aV){this.$('[data-element="upload_progress"]').html(this.progressTemplate(this.model.file.toJSON())).show()}},onTokenChange:function(){if(!this.model.file.get("token")){return}this.model.replace({success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},onSaveSuccess:function(aU,aV){},onSaveError:function(aV,aU){this.model.file.setError(aU)},render:function(){this.$el.html(this.template(this.model.file));this.renderButton();return this}});var V=d.extend({template:_.template(a("#photo").html()),initialize:function(){this.listenTo(this.model,"change:photoUrl",this.onPhotoUrlChange)},onPhotoUrlChange:function(){this.disposeAllChildren();this.render()},events:{'click [data-action="replace"]':"onReplaceClick",'click [data-action="remove"]':"onDeleteClick","click [data-action=undo]":"onUndoClick"},onReplaceClick:function(){this.model.file.setIdle();this.$el.append(this.addChildren(new S({model:this.model})).render().el)},onDeleteClick:function(){this.showSavingState();this.model["delete"]({error:_.bind(this.onError,this)})},onUndoClick:function(){this.showSavingState();this.model.undo({error:_.bind(this.onError,this)})},onError:function(aV,aU){this.hideSavingState()},render:function(){this.$el.html(this.template(this.model));return this}});var S=A.extend({template:_.template(a("#photo_edit").html()),events:{'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){this.dispose()}});var aC=d.extend({initialize:function(){this.content=null},renderDetails:function(){this.disposeChildren(this.content);this.content=this.addChildren(new az({model:this.model}));this.content.on("edit",this.renderEdit,this);this.$el.append(this.content.render().el)},renderEdit:function(){this.disposeChildren(this.content);this.content=this.addChildren(new aA({model:this.model}));this.content.on("render-details",this.renderDetails,this);this.$el.append(this.content.render().el)},render:function(){if(this.model.get("url")){this.renderDetails()}else{this.renderEdit()}return this}});var az=d.extend({template:_.template(a("#resume_details").html()),events:{'click [data-action="replace"]':"onReplaceClick"},onReplaceClick:function(){this.trigger("edit")},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aA=A.extend({template:_.template(a("#resume_edit").html()),onSaveSuccess:function(aU,aV){this.trigger("render-details")}});a.ajaxSetup({statusCode:{}});a.ajaxPrefilter(function(aV,aW,aU){aV.statusCode=_.extend(aV.statusCode||{},{401:function(aY,aZ,aX){window.location.reload(true)}})});return{init:function(aY){p=aY.dropboxAppKey;aQ(aY.restPath);var aW=new G({id:aY.jobseekerId});var aV=new n();var aU=new g();var aX=new I();var aZ=new N({model:aW,countries:aV.getCountries(),careerLevels:aU.getCareerLevels(),memberStatuses:aX.getMemberStatuses(),requireVerification:aY.requireVerification,enabled:aY.enabled});a('[data-outlet="container"]').append(aZ.render().el);aW.fetch()}}}(jQuery));