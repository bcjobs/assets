var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobseekerProfile=(function(a){var p;var aL=function(aP){aL={linkedInAuthorization:"/com/portals/auth/linkedin_resume_authorize?callback=:callback",jobseekers:"/api/v1.1/resumes/:id",relocations:"/api/v1.1/resumes/:id/relocations",educations:"/api/v1.1/resumes/:id/educations",positions:"/api/v1.1/resumes/:id/positions",jobseekerSkills:"/api/v1.1/resumes/:id/skills",photos:aP+"files",formPhoto:aP+"files/form",fetchPhoto:aP+"files/fetch",resumes:aP+"resumes",formResume:aP+"resumes/form",fetchResume:aP+"resumes/fetch",countries:"/api/v1.1/countries",provinces:"/api/v1.1/provinces?countryId=:id",careerLevels:"/api/v1.1/careerlevels",locations:"/api/v1.1/locations?pageSize=7&types=town%2Cprovince%2Ccountry",skills:"/api/v1.1/skills?pageSize=7"}};var c=Backbone.Model.extend({_validators:{required:function(aS,aP,aT,aQ,aR){if(!aT||(aT+"").trim()==""){aR.push({attr:aP,message:aS.message||(" is required")})}},maxLength:function(aS,aP,aT,aQ,aR){if(!aT||(aT+"").trim()==""){return}if(aT.trim().length>aS.max){aR.push({attr:aP,message:aS.message||String.format(" exceeds {0} characters",aS.max)})}},regex:function(aS,aP,aT,aQ,aR){if(!aT||(aT+"").trim()==""){return}if(!aS.pattern.test(aT.trim())){aR.push({attr:aP,message:aS.message||(" is invalid")})}},custom:function(aS,aP,aU,aQ,aR){if(!aS.isValid){throw new Error("isValid missing for custom validation")}var aT=aS.isValid(aS,aP,aU,aQ);if(aT===true){return}if(aT===false){aR.push({attr:aP,message:aS.message});return}if(_.isString(aT)){aR.push({attr:aP,message:aT});return}throw new Error("validity not supported.")}},isValid:function(){if(!this.validations){return true}var aQ=[];for(var aP in this.attributes){if(!this.attributes.hasOwnProperty(aP)){continue}if(!this.validations[aP]){continue}var aS=this.validations[aP];for(var aR in aS){if(!aS.hasOwnProperty(aR)){continue}if(!this._validators[aR]){throw new Error("Validation "+aR+" not supported.")}this._validators[aR](aS[aR],aP,this.attributes[aP],this.attributes,aQ)}}if(aQ.length>0){this.trigger("validation-error",this,aQ);return false}else{return true}}});var aG=Backbone.Model.extend({defaults:{ready:false,error:null}});var e=Backbone.Model.extend({collection:Backbone.Collection,listName:"",url:"",initialize:function(){this._loading=false;this._loaded=false;this._list=new this.collection()},getList:function(){if(!this._loaded){this._load()}return this._list},_load:function(){var aP=this;if(!this._loading){this._list.state.set({ready:false,error:null});this._loading=true;var aQ=this.url;if(_.isFunction(aQ)){aQ=aQ.call(this)}a.ajax({url:aQ,dataType:"json",cache:true,type:"GET",success:function(aS,aT,aR){aP._list.reset(aS.data);aP._list.state.set({ready:true,error:null});aP._loaded=true},error:function(aS,aT,aR){aP._list.state.set({error:String.format("Error retrieving {0} list.",aP.listName)})},complete:function(aR,aS){aP._loading=false}})}}});var m=Backbone.Model.extend({initialize:function(){this.provinceCache=new ad(null,{countryId:this.id})}});var l=Backbone.Collection.extend({model:m,initialize:function(){this.state=new aG()}});var n=e.extend({collection:l,listName:"country",url:function(){return aL.countries},getCountries:function(){return this.getList()}});var ac=Backbone.Model.extend({});var ae=Backbone.Collection.extend({model:ac,initialize:function(){this.state=new aG()}});var ad=e.extend({collection:ae,listName:"province",url:function(){return aL.provinces.replace(":id",this._countryId)},initialize:function(aP,aQ){e.prototype.initialize.call(this,aP,aQ);this._countryId=aQ.countryId},getProvinces:function(){return this.getList()}});var f=Backbone.Model.extend({});var j=Backbone.Collection.extend({model:f,initialize:function(){this.state=new aG()}});var g=e.extend({collection:j,listName:"career level",url:function(){return aL.careerLevels},getCareerLevels:function(){return this.getList()}});var y=c.extend({defaults:{state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null},setError:function(aP){this.set({state:"error",error:aP})},setUploading:function(aP){this.set({state:"uploading"})},setFile:function(aQ,aP){this.set({state:"uploaded",token:aQ,fileName:aP})},setIdle:function(aQ,aP){this.set({state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null})},setFileSize:function(aP){if(aP===0){this.set({fileSize:"? KB"})}else{if(aP>1024*1024){this.set({fileSize:(Math.round(aP*100/(1024*1024))/100).toString()+"MB"})}else{this.set({fileSize:(Math.round(aP*100/1024)/100).toString()+"KB"})}}},isUploaded:function(){return this.get("state")==="uploaded"},isUploading:function(){return this.get("state")==="uploading"},sendUrl:null,sendName:null,fetchUrl:null,send:function(aR,aP){var aQ=new FormData();aQ.append(this.sendName,aR);var aS=new XMLHttpRequest();aS.upload.addEventListener("progress",aP.progress,false);aS.addEventListener("load",aP.load,false);aS.addEventListener("error",aP.error,false);aS.addEventListener("abort",aP.abort,false);aS.open("POST",this.sendUrl());aS.setRequestHeader("Accept","application/json");aS.send(aQ)},fetch:function(aS,aQ,aP,aR){aR||(aR={});var aT=this;a.ajax({url:this.fetchUrl(),contentType:"application/json",data:JSON.stringify({url:aQ,accessToken:aP,source:aS}),dataType:"json",type:"POST",success:function(aV,aW,aU){if(aR.success){aR.success(aT,aV)}},error:function(aV,aX,aU){if(aV.status>=400&&aV.status<500){var aW=JSON.parse(aV.responseText);if(aR.error){aR.error(aT,aW.message);return}}if(aR.error){aR.error(aT,"Error connecting to the server.")}}})}});var O=y.extend({maxFileSize:5,fileTypes:["png","jpg"],fileTypeMessage:"Only PNG and JPG file types allowed.",sendUrl:function(){return aL.photos},sendName:"file",fetchUrl:function(){return aL.fetchPhoto},includeDropbox:true,includeLinkedIn:false,includeWeb:true});var aw=y.extend({maxFileSize:1,fileTypes:["docx","doc","rtf","pdf","txt"],fileTypeMessage:"Only Word, Plain Text, PDF, RTF file types allowed.",sendUrl:function(){return aL.resumes},sendName:"file",fetchUrl:function(){return aL.fetchResume},includeDropbox:true,includeLinkedIn:true,includeWeb:false});var G=c.extend({initialize:function(){this._loading=false;this.state=new aG();this.photo=new M();this.photo.jobseeker=this;this.relocations=new ap();this.relocations.jobseeker=this;this.educations=new v();this.educations.jobseeker=this;this.positions=new V();this.positions.jobseeker=this;this.skills=new aD();this.skills.jobseeker=this;this.resume=new at();this.resume.jobseeker=this;this.on("change:published",this.onPublishedChange,this)},onPublishedChange:function(){if(this.previous("published")===undefined){return}if(this.get("published")&&!this.previous("published")&&window.dataLayer){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobseekerProfilePublish",eventLabel:undefined,nonInteraction:false})}},url:function(){return aL.jobseekers.replace(":id",this.id)},parse:function(aQ,aP){this.photo.setPhotoUrl(aQ.photoUrl);delete aQ.photoUrl;this.relocations.reset(aQ.relocations);delete aQ.relocations;this.educations.reset(aQ.educations);delete aQ.educations;this.positions.reset(aQ.positions);delete aQ.positions;this.skills.reset(aQ.skills);delete aQ.skills;this.resume.set({url:aQ.fileUrl,fileType:aQ.fileType});delete aQ.fileUrl;delete aQ.fileType;return aQ},fetch:function(aP){aP||(aP={});var aQ=this;if(this._loading){return}this.state.set({ready:false,error:null});this._loading=true;a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(aS,aT,aR){aQ.set(aQ.parse(aS));aQ.state.set({ready:true,error:null});if(aP.success){aP.success(aQ,aS)}},error:function(aT,aU,aS){var aR=aT.status>=400&&aT.status<500?JSON.parse(aT.responseText).message:"Error retrieving profile.";aQ.state.set({error:aR});if(aP.error){aP.error(aQ,aR)}},complete:function(aR,aS){aQ._loading=false}})},save:function(aP,aQ){aQ||(aQ={});var aR=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aP),dataType:"json",type:"PUT",success:function(aT,aU,aS){delete aT.photoUrl;delete aT.educations;delete aT.positions;delete aT.skills;delete aT.fileUrl;delete aT.fileType;aR.set(aT);if(aQ.success){aQ.success(aR,aT)}},error:function(aT,aV,aS){if(aT.status>=400&&aT.status<500){var aU=JSON.parse(aT.responseText);if(aQ.error){aQ.error(aR,aU.message);return}}if(aQ.error){aQ.error(aR,"Error connecting to the server.")}}})}});var M=c.extend({defaults:{photoUrl:null},initialize:function(){this.file=new O()},url:function(){return aL.jobseekers.replace(":id",this.jobseeker.id)},getDisplayUrl:function(){if(this.get("photoUrl")&&this.get("photoUrl").get("url")){return this.get("photoUrl").get("url")}else{return"/images/profile_missing.png"}},setPhotoUrl:function(aP){this.set({photoUrl:new P({url:aP,previous:this.get("photoUrl")})})},replace:function(aP){this.save(JSON.stringify({photoToken:this.file.get("token")}),aP)},"delete":function(aP){this.save(JSON.stringify({photoUrl:""}),aP)},save:function(aP,aQ){aQ||(aQ={});var aR=this;a.ajax({url:this.url(),contentType:"application/json",data:aP,dataType:"json",type:"PUT",success:function(aT,aU,aS){aR.setPhotoUrl(aT.photoUrl);if(aQ.success){aQ.success(aR,aT)}},error:function(aT,aV,aS){if(aT.status>=400&&aT.status<500){var aU=JSON.parse(aT.responseText);if(aQ.error){aQ.error(aR,aU.message);return}}if(aQ.error){aQ.error(aR,"Error connecting to the server.")}}})},undo:function(aP){aP||(aP={});var aQ=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({photoUrl:this.get("photoUrl").get("previous").get("url")}),dataType:"json",type:"PUT",success:function(aS,aT,aR){aQ.set({photoUrl:aQ.get("photoUrl").get("previous")});if(aP.success){aP.success(aQ,aS)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})}});var P=Backbone.Model.extend({});var af=c.extend({save:function(aP,aQ){var aR=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aP),dataType:"json",type:this.isNew()?"POST":"PUT",success:function(aT,aU,aS){aR.set(aT);if(aQ.success){aQ.success(aR,aT)}},error:function(aT,aV,aS){if(aT.status>=400&&aT.status<500){var aU=JSON.parse(aT.responseText);if(aQ.error){aQ.error(aR,aU.message);return}}if(aQ.error){aQ.error(aR,"Error connecting to the server.")}}})},"delete":function(aP){var aQ=this;a.ajax({url:this.url(),contentType:"application/json",dataType:"json",type:"DELETE",success:function(aS,aT,aR){if(aP.success){aP.success(aQ)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})}});var al=af.extend({url:function(){if(this.isNew()){return aL.relocations.replace(":id",this.collection.jobseeker.id)}else{return aL.relocations.replace(":id",this.collection.jobseeker.id)+"/"+this.get("id")}}});var ap=Backbone.Collection.extend({model:al});var r=af.extend({defaults:{school:"",degree:null,fieldOfStudy:"",startYear:null,endYear:null},url:function(){if(this.isNew()){return aL.educations.replace(":id",this.collection.jobseeker.id)}else{return aL.educations.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var v=Backbone.Collection.extend({model:r});var R=af.extend({defaults:{title:"",company:"",start:null,end:null,duration:""},url:function(){if(this.isNew()){return aL.positions.replace(":id",this.collection.jobseeker.id)}else{return aL.positions.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var V=Backbone.Collection.extend({model:R});var az=af.extend({defaults:{type:"",proficiency:null,experience:null},url:function(){if(this.isNew()){return aL.jobseekerSkills.replace(":id",this.collection.jobseeker.id)}else{return aL.jobseekerSkills.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var aD=Backbone.Collection.extend({model:az});var at=c.extend({initialize:function(){this.file=new aw()},url:function(){return aL.jobseekers.replace(":id",this.jobseeker.id)},replace:function(aP){aP||(aP={});var aQ=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({fileToken:this.file.get("token")}),dataType:"json",type:"PUT",success:function(aS,aT,aR){aQ.set({url:aS.fileUrl,fileType:aS.fileType});if(aP.success){aP.success(aQ,aS)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})}});var d=function(aP){this.parent=null;this.children=[];Backbone.View.apply(this,[aP])};_.extend(d.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error").html()),loaderClass:"flex-loader",renderState:function(aP){if(aP.get("error")){a(this.el).html(this.errorTemplate({error:aP.get("error")}));return true}if(!aP.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(aP){var aQ=document.createElement("div");aQ.className=this.loaderClass;a(aP).empty().append(aQ)},hideSavingState:function(){this.$el.children().removeClass("invisible").end().find(".flex-loader-mini").remove()},showSavingState:function(){this.$el.children().addClass("invisible").end().prepend('<div class="flex-loader-mini"></div>')},addChildren:function(aP){var aQ,aR=this;if(_.isArray(aP)){aQ=aP}else{aQ=_.toArray(arguments)}_.each(aQ,function(aS){aR.children.push(aS);aS.parent=aR});if(aQ.length===1){return aQ[0]}else{return aQ}},disposeChildren:function(aP){if(!aP){return}var aR=this;var aQ=_.isArray(aP)?aP:_.toArray(arguments);_.each(aQ,function(aS){aS.dispose()})},disposeAllChildren:function(){var aP=this.children.slice(0);_.each(aP,function(aQ){aQ.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(aP){var aQ=_.indexOf(this.children,aP);if(aQ!==-1){this.children.splice(aQ,1)}}});d.extend=Backbone.View.extend;var b=function(aP){d.apply(this,[aP]);this.listenTo(this.model,"validation-error",this.onValidationError,this);if(this.model.state){this.listenTo(this.model.state,"change",this.render)}if(aP.countries){this._currentProvinces=null;this.listenTo(aP.countries.state,"change",this.render)}};_.extend(b.prototype,d.prototype,{_validatable:false,events:{submit:"onSubmit","keyup input,textarea":"onKeyup","change select,input":"onChange",validate:"validateIfReady"},onSaveSuccess:function(aP,aQ){},onSaveError:function(aQ,aP){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aP).show()},onValidationError:function(aT,aR){var aP=this.$('[data-element="alert_danger_server"]');aP.html("");for(var aS=aR.length;aS--;){var aQ=aR[aS];if(_.isString(aQ)){aP.html(aQ).show()}else{this.$("input[name="+aQ.attr+"],textarea[name="+aQ.attr+"],select[name="+aQ.attr+"]").each(function(){if(this.tagName==="SELECT"){a(this).siblings(".select2-container").addClass("error")}else{a(this).addClass("error")}}).closest(".form-group").find(".form-error").html(aQ.message).show()}}this.onSaveError()},onSubmit:function(aQ){aQ.preventDefault();this._validatable=true;var aP=this.getFormValues();if(this.isValid(aP)){this.save(aP)}},save:function(aP){this.showSavingState();this.model.save(aP,{success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},getFormValues:function(){var aQ=this;var aP={};this.$("input,textarea,select").each(function(){if(this.name&&!this.disabled){if(this.type==="radio"&&!this.checked){return}if(this.type==="checkbox"&&!this.checked){return}aP[this.name]=aP[this.name]?aP[this.name]+","+a(this).val():a(this).val()}});this.formPreProcess(aP);return aP},isValid:function(aP){this.$(".error").removeClass("error");this.$(".form-error").hide();return this.model.isValid(aP)},formPreProcess:function(aP){},onKeyup:function(aP){if(aP.which===13){return}this.validateIfReady()},onChange:function(aQ){var aP=a(aQ.currentTarget);if(aP.attr("name")==="country.id"){this.onCountryChange()}this.validateIfReady()},validateIfReady:function(){if(this._validatable){this.isValid(this.getFormValues())}},onCountryChange:function(){var aR=this.$('select[name="country.id"]').val();if(aR){var aQ=this.options.countries.get(aR);var aS=aQ.provinceCache.getProvinces();this._currentProvinces=aS;if(!aS.state.get("ready")){var aP=this.$('select[name="province.id"]').closest('[data-element="province_input_section"]');if(aP.find(".select2-container").length){aP.append('<span data-element="loader" class="flex-loader-mini"></span>').find(".select2-container").css("visibility","hidden")}this.listenTo(aS.state,"change",this.renderProvinces);return}this.renderProvinces(aS.state)}},renderProvinces:function(aR){if(this._currentProvinces.state!==aR){return}var aS=this;var aP=this.$('select[name="province.id"]');aP.closest('[data-element="province_input_section"]').find('[data-element="loader"]').remove().end().find(".select2-container").css("visibility","visible");if(aR.get("error")){JOBCENTRE.alertFloater.show({summary:aR.get("error"),isError:true,duration:5000});return}if(!aR.get("ready")){throw new Error("Provinces not ready.")}var aQ=[];aQ.push('<option value=""></option>');this._currentProvinces.each(function(aT){aQ.push(String.format('<option value="{0}"{1}>{2}</option>',aT.id,(aS.model.get("province")&&aS.model.get("province").id==aT.id)?' selected="selected"':"",aT.get("name")))});aP.html(aQ.join("")).trigger("change")},renderCountries:function(){var aQ=this,aP=[];aP.push('<option value=""></option>');this.options.countries.each(function(aR){aP.push(String.format('<option value="{0}"{1}>{2}</option>',aR.id,(aQ.model.get("country")&&(aQ.model.get("country").id==aR.id))?' selected="selected"':"",aR.get("name")))});this.$('select[name="country.id"]').html(aP.join("")).change()},bindSelect2:function(){var aQ=this;var aP=function(){aQ.$("select").select2({allowClear:true})};if(!a.contains(document.documentElement,this.el)){setTimeout(aP,10)}else{aP()}}});b.extend=d.extend;var aK=d.extend({validate:function(aR,aQ){if(aR>this.model.maxFileSize*1024*1024){return String.format("File exceeds {0} MB.",this.model.maxFileSize)}var aP=_.last(aQ.split(".")).toLowerCase();if(!_.contains(this.model.fileTypes,aP)){return this.model.fileTypeMessage}}});var z=aK.extend({source:null,template:_.template(a("#file_upload").html()),events:{'change [data-element="file_input"]':"initializeUpload"},initializeUpload:function(){this.model.setUploading();this.uploadFile()},render:function(){this.$el.html(this.template({file:this.model,viewId:this.cid}));return this}},{create:function(aP){if(window.FormData){return new aO(aP)}else{return new F(aP)}}});var aO=z.extend({uploadFile:function(){var aP=this.$('[data-element="file_input"]')[0].files[0];if(!aP){this.model.setError("File could not be selected.");return}if(this.validate(aP.size,aP.name)){this.model.setError(this.validate(aP.size,aP.name));return}this.model.set({fileName:aP.name});this.model.setFileSize(aP.size);this.model.send(aP,{progress:_.bind(this.progress,this),load:_.bind(this.load,this),error:_.bind(this.error,this),abort:_.bind(this.abort,this)})},progress:function(aP){if(!aP.lengthComputable){return}var aQ=Math.round(aP.loaded*100/aP.total);this.model.set({progress:aQ})},load:function(aP){var aQ=JSON.parse(aP.target.responseText);if(aP.target.status!==200){this.model.setError(aQ.message);return}this.model.setFile(aQ.file.token,aQ.file.name)},error:function(){this.model.setError("Upload failed.")},abort:function(){this.model.setError("Upload cancelled.")}});var F=z.extend({uploadFile:function(){window[this.options.callback]=_.bind(this.load,this);document.getElementById(this.options.iframeId).onload=_.bind(this.load,this);this.trigger("submit-file")},load:function(aP,aQ){if(!aQ){try{aQ=window.frames[this.options.iframeId].document.getElementsByTagName("body")[0].innerHTML;aQ=JSON.parse(aQ)}catch(aP){this.model.setError("Upload failed.");return}}if(aQ.success){this.model.setFile(aQ.data.file.token,aQ.data.file.name)}else{this.model.setError(aQ.data.message)}}});var q=aK.extend({source:"Dropbox",template:_.template(a("#dropbox_upload").html()),events:{"click a":"onClick"},onClick:function(aP){var aQ=this;aP.preventDefault();Dropbox.choose({linkType:"direct",success:function(aR){if(aR.length<1){aQ.model.setError("File could not be selected.");return}if(aQ.validate(aR[0].bytes,aR[0].name)){aQ.model.setError(aQ.validate(aR[0].bytes,aR[0].name));return}aQ.model.setUploading();aQ.model.set({fileName:aR[0].name});aQ.model.setFileSize(aR[0].bytes);aQ.model.fetch("Dropbox",aR[0].link,null,{success:_.bind(aQ.success,aQ),error:_.bind(aQ.error,aQ)})},cancel:function(){}})},success:function(aP,aQ){this.model.setFile(aQ.file.token,aQ.file.name)},error:function(aP,aQ){this.model.setError(aQ)},onScriptLoaded:function(){if(Dropbox.isBrowserSupported()){this.$el.html(this.template(this.model))}},render:function(){JOBCENTRE.lazyLoad.js("https://www.dropbox.com/static/api/1/dropins.js",_.bind(this.onScriptLoaded,this),{id:"dropboxjs","data-app-key":p});return this}});var H=aK.extend({source:"LinkedIn",template:_.template(a("#linkedin_upload").html()),events:{"click a":"onClick"},onClick:function(aQ){aQ.preventDefault();var aR=this;var aP="linkedInAuthorizationCallback"+new Date().getTime();window[aP]=function(aT){var aU=JSON.parse(aT);try{delete window[aP]}catch(aS){window[aP]=undefined}if(aU.success){aR.success(aU.data)}else{aR.error(aU.error)}};window.open(aL.linkedInAuthorization.replace(":callback",aP),new Date().getTime(),"height=600,width=800,resizable=yes,scrollbars=yes,toolbar=no,menubar=no")},success:function(aP){this.model.setFile(aP.file.token,aP.file.name)},error:function(aP){this.model.setError(aP)},render:function(){this.$el.html(this.template(this.model));return this}});var aN=aK.extend({source:"Web",template:_.template(a("#web_upload").html()),events:{"submit form":"onSubmit"},onSubmit:function(aP){aP.preventDefault();if(!this.$("[name=web_upload]").val().trim()){return}this.model.setUploading();this.model.fetch("Web",this.$("[name=web_upload]").val(),null,{success:_.bind(this.success,this),error:_.bind(this.error,this)})},success:function(aP,aQ){this.model.setFile(aQ.file.token,aQ.file.name)},error:function(aP,aQ){this.model.setError(aQ)},render:function(){this.$el.html(this.template(this.model));return this}});var ay=d.extend({initialize:function(){this.content=null},events:{'click [data-action="edit"]':"renderEdit",'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){var aP=this;if(this.model.isNew()){this.model.collection.remove(this.model);this.$el.fadeOut("fast",function(){aP.dispose()})}else{this.renderDetails()}},renderDetails:function(){var aP=this;if(this.content){this.content.$el.fadeOut("fast",function(){aP.disposeChildren(aP.content);aP.content=aP.addChildren(aP.detailsView());aP.content.on("render-deleted",aP.renderDeleted,aP);aP.content.$el.hide();aP.$el.append(aP.content.render().el);aP.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.detailsView());this.content.on("render-deleted",aP.renderDeleted,aP);this.$el.append(this.content.render().el)}},renderEdit:function(){var aP=this;if(this.content){this.content.$el.fadeOut("fast",function(){aP.disposeChildren(aP.content);aP.content=aP.addChildren(aP.editView());aP.content.on("render-details",aP.renderDetails,aP);aP.content.on("render-deleted",aP.renderDeleted,aP);aP.content.$el.hide();aP.$el.append(aP.content.render().el);aP.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.editView());this.content.on("render-details",this.renderDetails,aP);this.content.on("render-deleted",aP.renderDeleted,aP);this.content.$el.hide();this.$el.append(this.content.render().el);this.content.$el.fadeIn("fast")}},renderDeleted:function(){var aP=this;this.content.$el.fadeOut("fast",function(){aP.disposeChildren(aP.content);aP.content=aP.addChildren(aP.removedView());aP.content.on("render-details",aP.renderDetails,aP);aP.content.$el.hide();aP.$el.append(aP.content.render().el);aP.content.$el.fadeIn("fast")})},removedView:function(){throw new Error("Not Implemented.")},render:function(){if(this.model.isNew()){this.renderEdit()}else{this.renderDetails()}return this}});var I=d.extend({className:"clearfix flex-relative",initialize:function(aP){this.listenTo(this.model.state,"change",this.render)},render:function(){if(this.renderState(this.model.state)){return this}this.$el.empty();if(this.options.enabled.headline_text||this.options.enabled.headline_publish){this.$el.append(this.addChildren(new D({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}if(this.options.enabled.status){this.$el.append(this.addChildren(new aJ({model:this.model,requireVerification:this.options.requireVerification})).render().el)}if(this.options.enabled.identity){this.$el.append(this.addChildren(new E({model:this.model,countries:this.options.countries})).render().el);this.$el.append("<hr />")}if(this.options.enabled.careerLevel){this.$el.append(this.addChildren(new k({model:this.model,careerLevels:this.options.careerLevels})).render().el)}if(this.options.enabled.positionTypes){this.$el.append(this.addChildren(new aa({model:this.model})).render().el)}if(this.options.enabled.relocations){this.$el.append(this.addChildren(new aq({collection:this.model.relocations})).render().el)}if(this.options.enabled.educations){this.$el.append(this.addChildren(new w({collection:this.model.educations})).render().el)}if(this.options.enabled.positions){this.$el.append(this.addChildren(new W({collection:this.model.positions})).render().el)}if(this.options.enabled.skills){this.$el.append(this.addChildren(new aE({collection:this.model.skills})).render().el)}if(this.options.enabled.resume){this.$el.append(this.addChildren(new ax({model:this.model.resume})).render().el)}return this}});var D=d.extend({className:"alert alert-info text-center clearfix",render:function(){if(this.options.enabled.headline_text){this.$el.append(this.addChildren(new C()).render().el)}if(this.options.enabled.headline_publish){this.$el.append(this.addChildren(new B({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}return this}});var C=d.extend({template:_.template(a("#headline_text").html()),render:function(){this.$el.html(this.template());return this}});var B=b.extend({template:_.template(a("#headline_publish").html()),templateCtaOnPublish:_.template(a("#cta_on_publish").html()),className:"editor-cta",initialize:function(){this.listenTo(this.model,"change:published",this.render)},events:{"click [data-action=publish-now]":"onPublishNowClick"},onPublishNowClick:function(aP){if(!this.options.requireVerification){this.save({published:true});return}var aQ=this;var aR=this.addChildren(new aM());aR.on("verified",function(){aQ.disposeAllChildren();aQ.save({published:true})});a("body").append(aR.render().el)},renderPrivate:function(){this.$el.html(this.template({enabled:this.options.enabled}))},renderPublished:function(){this.$el.empty();if(this.options.enabled.cta_on_publish){this.$el.html(this.templateCtaOnPublish())}},render:function(){if(this.model.get("published")){this.renderPublished()}else{this.renderPrivate()}return this}});var o=d.extend({render:function(){return this}});var aJ=ay.extend({className:"editor-status-wrapper",initialize:function(aP){ay.prototype.initialize.call(this,aP);this.listenTo(this.model,"change:published",this.render);this.listenTo(this.model,"change:confidential",this.render)},detailsView:function(){return new aH({model:this.model})},editView:function(){return new aI({model:this.model,requireVerification:this.options.requireVerification})}});var aH=d.extend({template:_.template(a("#status_details").html()),className:"flex-relative flex-p10",render:function(){this.$el.html(this.template(this.model.toJSON()));var aP="alert alert-warning";if(this.model.get("published")){if(this.model.get("confidential")){aP="alert alert-info"}else{if(this.model.get("blockRecruiters")){aP="alert alert-info"}else{aP="alert alert-success"}}}this.$el.addClass(aP);return this}});var aI=b.extend({template:_.template(a("#status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",onSaveSuccess:function(aP,aQ){this.trigger("render-details")},formPreProcess:function(aP){switch(aP.jobseeker_profile_status){case"visible":aP.published=true;aP.confidential=false;aP.blockRecruiters=false;break;case"blockRecruiters":aP.published=true;aP.confidential=false;aP.blockRecruiters=true;break;case"confidential":aP.published=true;aP.confidential=true;aP.blockRecruiters=false;break;case"private":aP.published=false;aP.confidential=false;aP.blockRecruiters=false;break;default:throw new Error()}delete aP.jobseeker_profile_status},onSubmit:function(aP){if(!this.options.requireVerification){b.prototype.onSubmit.call(this,aP);return}var aQ=this;aP.preventDefault();switch(a("[name=jobseeker_profile_status]:checked").val()){case"visible":case"blockRecruiters":case"confidential":var aR=this.addChildren(new aM());aR.on("verified",function(){aQ.disposeAllChildren();b.prototype.onSubmit.call(aQ,aP)});a("body").append(aR.render().el);return;case"private":b.prototype.onSubmit.call(this,aP);return;default:throw new Error()}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aM=d.extend({template:_.template(a("#verification").html()),events:{"change input":"onInputChange","click [data-action=cancel]":"onCancelClick"},onCancelClick:function(){this.dispose()},onInputChange:function(){if(this.$("[name=verification]").prop("checked")){this.trigger("verified")}},render:function(){this.$el.html(this.template());return this}});var E=d.extend({template:_.template(a("#identity").html()),className:"clearfix flex-mv10",render:function(){this.$el.html(this.template());this.$('[data-outlet="photo"]').append(this.addChildren(new Q({model:this.model.photo})).render().el);this.addChildren(new L({el:this.$('[data-outlet="personal_info"]')[0],model:this.model,countries:this.options.countries})).render();return this}});var L=ay.extend({detailsView:function(){return new J({model:this.model})},editView:function(){return new K({model:this.model,countries:this.options.countries})}});var J=d.extend({template:_.template(a("#personal_info_details").html()),className:"flex-p10 flex-m0 clearfix",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var K=b.extend({template:_.template(a("#personal_info_edit").html()),className:"container-muted flex-p10 flex-m0 flex-relative clearfix flex-minheight200",onCountryChange:function(){b.prototype.onCountryChange.call(this);this.$('[data-outlet="legal_right"]').toggle(this.$('select[name="country.id"]').val()!="124")},onSaveSuccess:function(aP,aQ){this.trigger("render-details")},formPreProcess:function(aP){aP.country={id:aP["country.id"]};delete aP["country.id"];aP.province={id:aP["province.id"]};delete aP["province.id"]},render:function(){if(this.renderState(this.options.countries.state)){return this}this.$el.html(this.template(this.model.toJSON()));this.renderCountries();this.bindSelect2();return this}});var k=ay.extend({className:"clearfix",detailsView:function(){return new h({model:this.model})},editView:function(){return new i({model:this.model,careerLevels:this.options.careerLevels})}});var h=d.extend({template:_.template(a("#career_level_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));return this}});var i=b.extend({template:_.template(a("#career_level_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aP){this.listenTo(aP.careerLevels.state,"change",this.render)},onSaveSuccess:function(aP,aQ){this.trigger("render-details")},formPreProcess:function(aP){aP.careerLevel={id:aP["careerLevel.id"]};delete aP["careerLevel.id"]},renderCareerLevels:function(){var aQ=this,aP=[];aP.push('<option value=""></option>');this.options.careerLevels.each(function(aR){aP.push(String.format('<option value="{0}"{1}>{2}</option>',aR.id,aQ.model.get("careerLevel")&&aQ.model.get("careerLevel").id==aR.id?' selected="selected"':"",aR.get("name")))});this.$('select[name="careerLevel.id"]').html(aP.join("")).change()},render:function(){if(this.renderState(this.options.careerLevels.state)){return this}this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));this.renderCareerLevels();this.bindSelect2();return this}});var aa=d.extend({className:"clearfix",template:_.template(a("#position_types_wrapper").html()),render:function(){this.$el.html(this.template());this.addChildren(new Z({el:this.$('[data-outlet="position_types"]')[0],model:this.model})).render();return this}});var Z=ay.extend({detailsView:function(){return new X({model:this.model})},editView:function(){return new Y({model:this.model})}});var X=d.extend({template:_.template(a("#position_types_details").html()),className:"clearfix flex-relative",render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var Y=b.extend({template:_.template(a("#position_types_edit").html()),className:"container-muted flex-p10 clearfix flex-relative",onSaveSuccess:function(aP,aQ){this.trigger("render-details")},formPreProcess:function(aP){aP.positionTypes=aP.positionTypes?_.map(aP.positionTypes.split(","),function(aQ){return{id:aQ}}):[]},render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var aj=d.extend({events:{'click [data-action="add_new"]':"onAddNew"},onAddNew:function(){var aP=this.newModel();this.collection.add(aP);this.renderItem(aP)},renderItems:function(){var aP=this;this.collection.each(function(aQ){aP.renderItem(aQ)})},renderItem:function(aP){var aQ=this.addChildren(this.newView(aP));this.$('[data-outlet="qualifications"]').append(aQ.render().el);return aQ},render:function(){this.$el.html(this.template());this.renderItems();return this}});var aq=aj.extend({className:"clearfix",newModel:function(){return new al()},newView:function(aP){return new ar({model:aP})},template:_.template(a("#relocations").html())});var w=aj.extend({newModel:function(){return new r()},newView:function(aP){return new x({model:aP})},template:_.template(a("#educations").html())});var W=aj.extend({newModel:function(){return new R()},newView:function(aP){return new ab({model:aP})},template:_.template(a("#positions").html())});var aE=aj.extend({newModel:function(){return new az()},newView:function(aP){return new aF({model:aP})},template:_.template(a("#skills").html())});var ak=ay.extend({});var ar=ak.extend({detailsView:function(){return new am({model:this.model})},editView:function(){return new an({model:this.model})},removedView:function(){return new ao({model:this.model})}});var x=ak.extend({detailsView:function(){return new s({model:this.model})},editView:function(){return new t({model:this.model})},removedView:function(){return new u({model:this.model})}});var ab=ak.extend({detailsView:function(){return new S({model:this.model})},editView:function(){return new T({model:this.model})},removedView:function(){return new U({model:this.model})}});var aF=ak.extend({detailsView:function(){return new aA({model:this.model})},editView:function(){return new aB({model:this.model})},removedView:function(){return new aC({model:this.model})}});var ag=d.extend({className:"flex-relative",events:{'click [data-action="remove"]':"delete"},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aP){this.trigger("render-deleted")},onDeleteError:function(aQ,aP){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aP).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var am=ag.extend({template:_.template(a("#relocation_details").html())});var s=ag.extend({template:_.template(a("#education_details").html())});var S=ag.extend({template:_.template(a("#position_details").html())});var aA=ag.extend({template:_.template(a("#skill_details").html()),className:"flex-relative flex-p5"});var ah=b.extend({className:"container-muted flex-p10 flex-mt5 flex-mb15 clearfix flex-relative",events:function(){return _.extend({},b.prototype.events,{'click [data-action="remove"]':"delete"})},onSaveSuccess:function(aP,aQ){this.trigger("render-details")},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aP){this.trigger("render-deleted")},onDeleteError:function(aQ,aP){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aP).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.isNew()){this.$el.addClass("new")}this.bindSelect2();return this}});var an=ah.extend({template:_.template(a("#relocation_edit").html()),render:function(){var aQ=this;ah.prototype.render.call(this);var aP=function(){aQ.$('input[name="description"]').jsonSuggest({url:aL.locations,textPropertyName:"description",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aP,10)}else{aP()}return this}});var t=ah.extend({template:_.template(a("#education_edit").html()),formPreProcess:function(aP){aP.degree={id:aP["degree.id"]};delete aP["degree.id"]}});var T=ah.extend({template:_.template(a("#position_edit").html()),events:function(){return _.extend({},ah.prototype.events(),{"change [name=isCurrent]":"onIsCurrentChange"})},onIsCurrentChange:function(aP){this.$('[data-outlet="end_date"]').fadeToggle("fast")},formPreProcess:function(aP){aP.start=aP.startMonth&&aP.startYear?aP.startYear+"-"+aP.startMonth+"-01":null;aP.end=aP.endMonth&&aP.endYear&&!aP.isCurrent?aP.endYear+"-"+aP.endMonth+"-01":null;delete aP.startMonth;delete aP.startYear;delete aP.endMonth;delete aP.endYear;delete aP.isCurrent}});var aB=ah.extend({template:_.template(a("#skill_edit").html()),formPreProcess:function(aP){aP.proficiency={id:aP["proficiency.id"]};aP.experience={id:aP["experience.id"]};delete aP["proficiency.id"];delete aP["experience.id"]},render:function(){var aQ=this;ah.prototype.render.call(this);var aP=function(){aQ.$('input[name="type"]').jsonSuggest({url:aL.skills,textPropertyName:"name",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aP,10)}else{aP()}return this}});var ai=d.extend({className:"flex-p10 flex-mv15 container-warning flex-relative",events:{'click [data-action="undo"]':"onUndoClick"},onUndoClick:function(){this.model.set("id",undefined);this.showSavingState();this.model.save(this.model.toJSON(),{success:_.bind(this.onUndoSuccess,this),error:_.bind(this.onUndoError,this)})},onUndoSuccess:function(aP,aQ){this.trigger("render-details")},onUndoError:function(aQ,aP){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aP).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var ao=ai.extend({template:_.template(a("#relocation_removed").html())});var u=ai.extend({template:_.template(a("#education_removed").html())});var U=ai.extend({template:_.template(a("#position_removed").html())});var aC=ai.extend({template:_.template(a("#skill_removed").html())});var A=d.extend({template:_.template(""),uploadingTemplate:_.template(a("#file_uploading").html()),progressTemplate:_.template(a("#file_progress").html()),errorTemplate:_.template(a("#file_error").html()),initialize:function(){this.fileUploadView=null;this.listenTo(this.model.file,"change:state",this.onStateChange);this.listenTo(this.model.file,"change:progress",this.onProgressChange);this.listenTo(this.model.file,"change:token",this.onTokenChange)},renderButton:function(){this.renderUploadButton();if(this.model.file.includeDropbox){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new q({model:this.model.file})).render().el)}if(this.model.file.includeLinkedIn){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new H({model:this.model.file})).render().el)}if(this.model.file.includeWeb){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new aN({model:this.model.file})).render().el)}this.onStateChange(this.model.file,this.model.file.get("state"))},onSubmitFile:function(){this.$("form").submit()},showButton:function(){this.$('[data-element="upload_title"]').show();this.$('[data-outlet="file_uploaders"]').show();this.disposeChildren(this.fileUploadView);this.renderUploadButton()},renderUploadButton:function(){this.fileUploadView=this.addChildren(z.create({model:this.model.file,callback:this.$("input[name=callback]").val(),iframeId:this.$("iframe")[0].id}));this.fileUploadView.on("submit-file",this.onSubmitFile,this);this.$('[data-outlet="file_uploaders"]').prepend(this.fileUploadView.render().el)},hideButton:function(){this.$('[data-outlet="file_uploaders"]').hide();this.$('[data-element="upload_title"]').hide()},onStateChange:function(aP,aQ){switch(aQ){case"idle":return;case"uploading":this.$('[data-element="error_message"]').html("").hide();this.$('[data-element="upload_progress"]').html(this.uploadingTemplate(this.model.file.toJSON())).show();this.hideButton();return;case"uploaded":return;case"error":this.$('[data-element="error_message"]').html(this.errorTemplate(this.model.file.toJSON())).show();this.$('[data-element="upload_progress"]').html("").hide();this.showButton();return;default:throw new Error(String.format("State {0} not supported.",aQ))}},onProgressChange:function(aP,aQ){if(aQ){this.$('[data-element="upload_progress"]').html(this.progressTemplate(this.model.file.toJSON())).show()}},onTokenChange:function(){if(!this.model.file.get("token")){return}this.model.replace({success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},onSaveSuccess:function(aP,aQ){},onSaveError:function(aQ,aP){this.model.file.setError(aP)},render:function(){this.$el.html(this.template(this.model.file));this.renderButton();return this}});var Q=d.extend({template:_.template(a("#photo").html()),initialize:function(){this.listenTo(this.model,"change:photoUrl",this.onPhotoUrlChange)},onPhotoUrlChange:function(){this.disposeAllChildren();this.render()},events:{'click [data-action="replace"]':"onReplaceClick",'click [data-action="remove"]':"onDeleteClick","click [data-action=undo]":"onUndoClick"},onReplaceClick:function(){this.model.file.setIdle();this.$el.append(this.addChildren(new N({model:this.model})).render().el)},onDeleteClick:function(){this.showSavingState();this.model["delete"]({error:_.bind(this.onError,this)})},onUndoClick:function(){this.showSavingState();this.model.undo({error:_.bind(this.onError,this)})},onError:function(aQ,aP){this.hideSavingState()},render:function(){this.$el.html(this.template(this.model));return this}});var N=A.extend({template:_.template(a("#photo_edit").html()),events:{'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){this.dispose()}});var ax=d.extend({initialize:function(){this.content=null},renderDetails:function(){this.disposeChildren(this.content);this.content=this.addChildren(new au({model:this.model}));this.content.on("edit",this.renderEdit,this);this.$el.append(this.content.render().el)},renderEdit:function(){this.disposeChildren(this.content);this.content=this.addChildren(new av({model:this.model}));this.content.on("render-details",this.renderDetails,this);this.$el.append(this.content.render().el)},render:function(){if(this.model.get("url")){this.renderDetails()}else{this.renderEdit()}return this}});var au=d.extend({template:_.template(a("#resume_details").html()),events:{'click [data-action="replace"]':"onReplaceClick"},onReplaceClick:function(){this.trigger("edit")},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var av=A.extend({template:_.template(a("#resume_edit").html()),onSaveSuccess:function(aP,aQ){this.trigger("render-details")}});a.ajaxSetup({statusCode:{}});a.ajaxPrefilter(function(aQ,aR,aP){aQ.statusCode=_.extend(aQ.statusCode||{},{401:function(aT,aU,aS){window.location.reload(true)}})});return{init:function(aS){p=aS.dropboxAppKey;aL(aS.restPath);var aR=new G({id:aS.jobseekerId});var aQ=new n();var aP=new g();var aT=new I({model:aR,countries:aQ.getCountries(),careerLevels:aP.getCareerLevels(),requireVerification:aS.requireVerification,enabled:aS.enabled});a('[data-outlet="container"]').append(aT.render().el);aR.fetch()}}}(jQuery));