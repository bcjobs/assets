var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobseekerProfile=(function(a){var o;var aN=function(aR){aN={jobseekers:aR+"jobseekers/:id",relocations:aR+"jobseekers/:id/relocations",educations:aR+"jobseekers/:id/educations",positions:aR+"jobseekers/:id/positions",jobseekerSkills:aR+"jobseekers/:id/skills",photos:aR+"files",formPhoto:aR+"files/form",fetchPhoto:aR+"files/fetch",resumes:aR+"resumes",formResume:aR+"resumes/form",fetchResume:aR+"resumes/fetch",countries:"/api/v1.0/countries",provinces:"/api/v1.0/provinces?countryId=:id",memberStatuses:"/api/v1.0/memberstatuses",careerLevels:"/api/v1.0/careerlevels",locations:aR+"locations?pageSize=7&types=town%2Cprovince%2Ccountry",skills:aR+"skills?pageSize=7"}};var c=Backbone.Model.extend({_validators:{required:function(aU,aR,aV,aS,aT){if(!aV||(aV+"").trim()==""){aT.push({attr:aR,message:aU.message||(" is required")})}},maxLength:function(aU,aR,aV,aS,aT){if(!aV||(aV+"").trim()==""){return}if(aV.trim().length>aU.max){aT.push({attr:aR,message:aU.message||String.format(" exceeds {0} characters",aU.max)})}},regex:function(aU,aR,aV,aS,aT){if(!aV||(aV+"").trim()==""){return}if(!aU.pattern.test(aV.trim())){aT.push({attr:aR,message:aU.message||(" is invalid")})}},custom:function(aU,aR,aW,aS,aT){if(!aU.isValid){throw new Error("isValid missing for custom validation")}var aV=aU.isValid(aU,aR,aW,aS);if(aV===true){return}if(aV===false){aT.push({attr:aR,message:aU.message});return}if(_.isString(aV)){aT.push({attr:aR,message:aV});return}throw new Error("validity not supported.")}},isValid:function(){if(!this.validations){return true}var aS=[];for(var aR in this.attributes){if(!this.attributes.hasOwnProperty(aR)){continue}if(!this.validations[aR]){continue}var aU=this.validations[aR];for(var aT in aU){if(!aU.hasOwnProperty(aT)){continue}if(!this._validators[aT]){throw new Error("Validation "+aT+" not supported.")}this._validators[aT](aU[aT],aR,this.attributes[aR],this.attributes,aS)}}if(aS.length>0){this.trigger("validation-error",this,aS);return false}else{return true}}});var aI=Backbone.Model.extend({defaults:{ready:false,error:null}});var e=Backbone.Model.extend({collection:Backbone.Collection,listName:"",url:"",initialize:function(){this._loading=false;this._loaded=false;this._list=new this.collection()},getList:function(){if(!this._loaded){this._load()}return this._list},_load:function(){var aR=this;if(!this._loading){this._list.state.set({ready:false,error:null});this._loading=true;var aS=this.url;if(_.isFunction(aS)){aS=aS.call(this)}a.ajax({url:aS,dataType:"json",cache:true,type:"GET",success:function(aU,aV,aT){aR._list.reset(aU.data);aR._list.state.set({ready:true,error:null});aR._loaded=true},error:function(aU,aV,aT){aR._list.state.set({error:String.format("Error retrieving {0} list.",aR.listName)})},complete:function(aT,aU){aR._loading=false}})}}});var m=Backbone.Model.extend({initialize:function(){this.provinceCache=new ae(null,{countryId:this.id})}});var l=Backbone.Collection.extend({model:m,initialize:function(){this.state=new aI()}});var n=e.extend({collection:l,listName:"country",url:function(){return aN.countries},getCountries:function(){return this.getList()}});var ad=Backbone.Model.extend({});var af=Backbone.Collection.extend({model:ad,initialize:function(){this.state=new aI()}});var ae=e.extend({collection:af,listName:"province",url:function(){return aN.provinces.replace(":id",this._countryId)},initialize:function(aR,aS){e.prototype.initialize.call(this,aR,aS);this._countryId=aS.countryId},getProvinces:function(){return this.getList()}});var D=Backbone.Model.extend({});var H=Backbone.Collection.extend({model:D,initialize:function(){this.state=new aI()}});var E=e.extend({collection:H,listName:"member status",url:function(){return aN.memberStatuses},getMemberStatuses:function(){return this.getList()}});var f=Backbone.Model.extend({});var j=Backbone.Collection.extend({model:f,initialize:function(){this.state=new aI()}});var g=e.extend({collection:j,listName:"career level",url:function(){return aN.careerLevels},getCareerLevels:function(){return this.getList()}});var x=c.extend({defaults:{state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null},setError:function(aR){this.set({state:"error",error:aR})},setUploading:function(aR){this.set({state:"uploading"})},setFile:function(aS,aR){this.set({state:"uploaded",token:aS,fileName:aR})},setIdle:function(aS,aR){this.set({state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null})},setFileSize:function(aR){if(aR===0){this.set({fileSize:"? KB"})}else{if(aR>1024*1024){this.set({fileSize:(Math.round(aR*100/(1024*1024))/100).toString()+"MB"})}else{this.set({fileSize:(Math.round(aR*100/1024)/100).toString()+"KB"})}}},isUploaded:function(){return this.get("state")==="uploaded"},isUploading:function(){return this.get("state")==="uploading"},sendUrl:null,sendName:null,fetchUrl:null,send:function(aT,aR){var aS=new FormData();aS.append(this.sendName,aT);var aU=new XMLHttpRequest();aU.upload.addEventListener("progress",aR.progress,false);aU.addEventListener("load",aR.load,false);aU.addEventListener("error",aR.error,false);aU.addEventListener("abort",aR.abort,false);aU.open("POST",this.sendUrl());aU.setRequestHeader("Accept","application/json");aU.send(aS)},fetch:function(aU,aS,aR,aT){aT||(aT={});var aV=this;a.ajax({url:this.fetchUrl(),contentType:"application/json",data:JSON.stringify({url:aS,accessToken:aR,source:aU}),dataType:"json",type:"POST",success:function(aX,aY,aW){if(aT.success){aT.success(aV,aX)}},error:function(aX,aZ,aW){if(aX.status===400){var aY=JSON.parse(aX.responseText);if(aT.error){aT.error(aV,aY.message);return}}if(aT.error){aT.error(aV,"Error connecting to the server.")}}})}});var P=x.extend({maxFileSize:5,fileTypes:["png","jpg"],fileTypeMessage:"Only PNG and JPG file types allowed.",sendUrl:function(){return aN.photos},sendName:"file",fetchUrl:function(){return aN.fetchPhoto},includeDropbox:true,includeWeb:true});var ay=x.extend({maxFileSize:1,fileTypes:["docx","doc","rtf","pdf","txt"],fileTypeMessage:"Only Word, Plain Text, PDF, RTF file types allowed.",sendUrl:function(){return aN.resumes},sendName:"file",fetchUrl:function(){return aN.fetchResume},includeDropbox:true,includeWeb:false});var C=c.extend({initialize:function(){this._loading=false;this.state=new aI();this.photo=new N();this.photo.jobseeker=this;this.relocations=new ar();this.relocations.jobseeker=this;this.educations=new u();this.educations.jobseeker=this;this.positions=new W();this.positions.jobseeker=this;this.skills=new aF();this.skills.jobseeker=this;this.resume=new av();this.resume.jobseeker=this;this.on("change:published",this.onPublishedChange,this)},onPublishedChange:function(){if(this.previous("published")===undefined){return}if(this.get("published")&&!this.previous("published")&&window.dataLayer){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobseekerProfilePublish",eventLabel:undefined,nonInteraction:false})}},url:function(){return aN.jobseekers.replace(":id",this.id)},parse:function(aS,aR){this.photo.setPhotoUrl(aS.photoUrl);delete aS.photoUrl;this.relocations.reset(aS.relocations);delete aS.relocations;this.educations.reset(aS.educations);delete aS.educations;this.positions.reset(aS.positions);delete aS.positions;this.skills.reset(aS.skills);delete aS.skills;this.resume.set({url:aS.resumeUrl,fileType:aS.resumeFileType});delete aS.resumeUrl;delete aS.resumeFileType;return aS},fetch:function(aR){aR||(aR={});var aS=this;if(this._loading){return}this.state.set({ready:false,error:null});this._loading=true;a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(aU,aV,aT){aS.set(aS.parse(aU));aS.state.set({ready:true,error:null});if(aR.success){aR.success(aS,aU)}},error:function(aV,aW,aU){var aT=aV.status===400?JSON.parse(aV.responseText).message:"Error retrieving profile.";aS.state.set({error:aT});if(aR.error){aR.error(aS,aT)}},complete:function(aT,aU){aS._loading=false}})},save:function(aR,aS){aS||(aS={});var aT=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aR),dataType:"json",type:"PUT",success:function(aV,aW,aU){delete aV.photoUrl;delete aV.educations;delete aV.positions;delete aV.skills;delete aV.resumeUrl;delete aV.resumeFileType;aT.set(aV);if(aS.success){aS.success(aT,aV)}},error:function(aV,aX,aU){if(aV.status===400){var aW=JSON.parse(aV.responseText);if(aS.error){aS.error(aT,aW.message);return}}if(aS.error){aS.error(aT,"Error connecting to the server.")}}})}});var N=c.extend({defaults:{photoUrl:null},initialize:function(){this.file=new P()},url:function(){return aN.jobseekers.replace(":id",this.jobseeker.id)},getDisplayUrl:function(){if(this.get("photoUrl")&&this.get("photoUrl").get("url")){return this.get("photoUrl").get("url")}else{return"/images/profile_missing.png"}},setPhotoUrl:function(aR){this.set({photoUrl:new Q({url:aR,previous:this.get("photoUrl")})})},replace:function(aR){this.save(JSON.stringify({photoToken:this.file.get("token")}),aR)},"delete":function(aR){this.save(JSON.stringify({photoUrl:""}),aR)},save:function(aR,aS){aS||(aS={});var aT=this;a.ajax({url:this.url(),contentType:"application/json",data:aR,dataType:"json",type:"PUT",success:function(aV,aW,aU){aT.setPhotoUrl(aV.photoUrl);if(aS.success){aS.success(aT,aV)}},error:function(aV,aX,aU){if(aV.status===400){var aW=JSON.parse(aV.responseText);if(aS.error){aS.error(aT,aW.message);return}}if(aS.error){aS.error(aT,"Error connecting to the server.")}}})},undo:function(aR){aR||(aR={});var aS=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({photoUrl:this.get("photoUrl").get("previous").get("url")}),dataType:"json",type:"PUT",success:function(aU,aV,aT){aS.set({photoUrl:aS.get("photoUrl").get("previous")});if(aR.success){aR.success(aS,aU)}},error:function(aU,aW,aT){if(aU.status===400){var aV=JSON.parse(aU.responseText);if(aR.error){aR.error(aS,aV.message);return}}if(aR.error){aR.error(aS,"Error connecting to the server.")}}})}});var Q=Backbone.Model.extend({});var ah=c.extend({save:function(aR,aS){var aT=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aR),dataType:"json",type:this.isNew()?"POST":"PUT",success:function(aV,aW,aU){aT.set(aV);if(aS.success){aS.success(aT,aV)}},error:function(aV,aX,aU){if(aV.status===400){var aW=JSON.parse(aV.responseText);if(aS.error){aS.error(aT,aW.message);return}}if(aS.error){aS.error(aT,"Error connecting to the server.")}}})},"delete":function(aR){var aS=this;a.ajax({url:this.url(),contentType:"application/json",dataType:"json",type:"DELETE",success:function(aU,aV,aT){aS.set(aU);if(aR.success){aR.success(aS,aU)}},error:function(aU,aW,aT){if(aU.status===400){var aV=JSON.parse(aU.responseText);if(aR.error){aR.error(aS,aV.message);return}}if(aR.error){aR.error(aS,"Error connecting to the server.")}}})}});var an=ah.extend({defaults:{location:null},isNew:function(){return !this.get("location")||!this.get("location").id},url:function(){if(this.isNew()){return aN.relocations.replace(":id",this.collection.jobseeker.id)}else{return aN.relocations.replace(":id",this.collection.jobseeker.id)+"/"+this.get("location").id}}});var ar=Backbone.Collection.extend({model:an});var q=ah.extend({defaults:{school:"",degree:null,fieldOfStudy:"",startYear:null,endYear:null},url:function(){if(this.isNew()){return aN.educations.replace(":id",this.collection.jobseeker.id)}else{return aN.educations.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var u=Backbone.Collection.extend({model:q});var S=ah.extend({defaults:{title:"",company:"",start:null,end:null,duration:""},url:function(){if(this.isNew()){return aN.positions.replace(":id",this.collection.jobseeker.id)}else{return aN.positions.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var W=Backbone.Collection.extend({model:S});var aB=ah.extend({defaults:{type:"",proficiency:null,experience:null},url:function(){if(this.isNew()){return aN.jobseekerSkills.replace(":id",this.collection.jobseeker.id)}else{return aN.jobseekerSkills.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var aF=Backbone.Collection.extend({model:aB});var av=c.extend({initialize:function(){this.file=new ay()},url:function(){return aN.jobseekers.replace(":id",this.jobseeker.id)},replace:function(aR){aR||(aR={});var aS=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({resumeToken:this.file.get("token")}),dataType:"json",type:"PUT",success:function(aU,aV,aT){aS.set({url:aU.resumeUrl,fileType:aU.resumeFileType});if(aR.success){aR.success(aS,aU)}},error:function(aU,aW,aT){if(aU.status===400){var aV=JSON.parse(aU.responseText);if(aR.error){aR.error(aS,aV.message);return}}if(aR.error){aR.error(aS,"Error connecting to the server.")}}})}});var d=function(aR){this.parent=null;this.children=[];Backbone.View.apply(this,[aR])};_.extend(d.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error").html()),loaderClass:"flex-loader",renderState:function(aR){if(aR.get("error")){a(this.el).html(this.errorTemplate({error:aR.get("error")}));return true}if(!aR.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(aR){var aS=document.createElement("div");aS.className=this.loaderClass;a(aR).empty().append(aS)},hideSavingState:function(){this.$el.children().removeClass("invisible").end().find(".flex-loader-mini").remove()},showSavingState:function(){this.$el.children().addClass("invisible").end().prepend('<div class="flex-loader-mini"></div>')},addChildren:function(aR){var aS,aT=this;if(_.isArray(aR)){aS=aR}else{aS=_.toArray(arguments)}_.each(aS,function(aU){aT.children.push(aU);aU.parent=aT});if(aS.length===1){return aS[0]}else{return aS}},disposeChildren:function(aR){if(!aR){return}var aT=this;var aS=_.isArray(aR)?aR:_.toArray(arguments);_.each(aS,function(aU){aU.dispose()})},disposeAllChildren:function(){var aR=this.children.slice(0);_.each(aR,function(aS){aS.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(aR){var aS=_.indexOf(this.children,aR);if(aS!==-1){this.children.splice(aS,1)}}});d.extend=Backbone.View.extend;var b=function(aR){d.apply(this,[aR]);this.listenTo(this.model,"validation-error",this.onValidationError,this);if(this.model.state){this.listenTo(this.model.state,"change",this.render)}if(aR.countries){this._currentProvinces=null;this.listenTo(aR.countries.state,"change",this.render)}};_.extend(b.prototype,d.prototype,{_validatable:false,events:{submit:"onSubmit","keyup input,textarea":"onKeyup","change select,input":"onChange",validate:"validateIfReady"},onSaveSuccess:function(aR,aS){},onSaveError:function(aS,aR){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aR).show()},onValidationError:function(aV,aT){var aR=this.$('[data-element="alert_danger_server"]');aR.html("");for(var aU=aT.length;aU--;){var aS=aT[aU];if(_.isString(aS)){aR.html(aS).show()}else{this.$("input[name="+aS.attr+"],textarea[name="+aS.attr+"],select[name="+aS.attr+"]").each(function(){if(this.tagName==="SELECT"){a(this).siblings(".select2-container").addClass("error")}else{a(this).addClass("error")}}).closest(".form-group").find(".form-error").html(aS.message).show()}}this.onSaveError()},onSubmit:function(aS){aS.preventDefault();this._validatable=true;var aR=this.getFormValues();if(this.isValid(aR)){this.save(aR)}},save:function(aR){this.showSavingState();this.model.save(aR,{success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},getFormValues:function(){var aS=this;var aR={};this.$("input,textarea,select").each(function(){if(this.name&&!this.disabled){if(this.type==="radio"&&!this.checked){return}if(this.type==="checkbox"&&!this.checked){return}aR[this.name]=aR[this.name]?aR[this.name]+","+a(this).val():a(this).val()}});this.formPreProcess(aR);return aR},isValid:function(aR){this.$(".error").removeClass("error");this.$(".form-error").hide();return this.model.isValid(aR)},formPreProcess:function(aR){},onKeyup:function(aR){if(aR.which===13){return}this.validateIfReady()},onChange:function(aS){var aR=a(aS.currentTarget);if(aR.attr("name")==="country.id"){this.onCountryChange()}this.validateIfReady()},validateIfReady:function(){if(this._validatable){this.isValid(this.getFormValues())}},onCountryChange:function(){var aT=this.$('select[name="country.id"]').val();if(aT){var aS=this.options.countries.get(aT);var aU=aS.provinceCache.getProvinces();this._currentProvinces=aU;if(!aU.state.get("ready")){var aR=this.$('select[name="province.id"]').closest('[data-element="province_input_section"]');if(aR.find(".select2-container").length){aR.append('<span data-element="loader" class="flex-loader-mini"></span>').find(".select2-container").css("visibility","hidden")}this.listenTo(aU.state,"change",this.renderProvinces);return}this.renderProvinces(aU.state)}},renderProvinces:function(aT){if(this._currentProvinces.state!==aT){return}var aU=this;var aR=this.$('select[name="province.id"]');aR.closest('[data-element="province_input_section"]').find('[data-element="loader"]').remove().end().find(".select2-container").css("visibility","visible");if(aT.get("error")){JOBCENTRE.alertFloater.show({summary:aT.get("error"),isError:true,duration:5000});return}if(!aT.get("ready")){throw new Error("Provinces not ready.")}var aS=[];aS.push('<option value=""></option>');this._currentProvinces.each(function(aV){aS.push(String.format('<option value="{0}"{1}>{2}</option>',aV.id,(aU.model.get("province")&&aU.model.get("province").id==aV.id)?' selected="selected"':"",aV.get("name")))});aR.html(aS.join("")).trigger("change")},renderCountries:function(){var aS=this,aR=[];aR.push('<option value=""></option>');this.options.countries.each(function(aT){aR.push(String.format('<option value="{0}"{1}>{2}</option>',aT.id,(aS.model.get("country")&&(aS.model.get("country").id==aT.id))?' selected="selected"':"",aT.get("name")))});this.$('select[name="country.id"]').html(aR.join("")).change()},bindSelect2:function(){var aS=this;var aR=function(){aS.$("select").select2({allowClear:true})};if(!a.contains(document.documentElement,this.el)){setTimeout(aR,10)}else{aR()}}});b.extend=d.extend;var aM=d.extend({validate:function(aT,aS){if(aT>this.model.maxFileSize*1024*1024){return String.format("File exceeds {0} MB.",this.model.maxFileSize)}var aR=_.last(aS.split(".")).toLowerCase();if(!_.contains(this.model.fileTypes,aR)){return this.model.fileTypeMessage}}});var y=aM.extend({source:null,template:_.template(a("#file_upload").html()),events:{'change [data-element="file_input"]':"initializeUpload"},initializeUpload:function(){this.model.setUploading();this.uploadFile()},render:function(){this.$el.html(this.template({file:this.model,viewId:this.cid}));return this}},{create:function(aR){if(window.FormData){return new aQ(aR)}else{return new B(aR)}}});var aQ=y.extend({uploadFile:function(){var aR=this.$('[data-element="file_input"]')[0].files[0];if(!aR){this.model.setError("File could not be selected.");return}if(this.validate(aR.size,aR.name)){this.model.setError(this.validate(aR.size,aR.name));return}this.model.set({fileName:aR.name});this.model.setFileSize(aR.size);this.model.send(aR,{progress:_.bind(this.progress,this),load:_.bind(this.load,this),error:_.bind(this.error,this),abort:_.bind(this.abort,this)})},progress:function(aR){if(!aR.lengthComputable){return}var aS=Math.round(aR.loaded*100/aR.total);this.model.set({progress:aS})},load:function(aR){var aS=JSON.parse(aR.target.responseText);if(aR.target.status!==200){this.model.setError(aS.message);return}this.model.setFile(aS.token,aS.name)},error:function(){this.model.setError("Upload failed.")},abort:function(){this.model.setError("Upload cancelled.")}});var B=y.extend({uploadFile:function(){window[this.options.callback]=_.bind(this.load,this);document.getElementById(this.options.iframeId).onload=_.bind(this.load,this);this.trigger("submit-file")},load:function(aR,aS){if(!aS){try{aS=window.frames[this.options.iframeId].document.getElementsByTagName("body")[0].innerHTML;aS=JSON.parse(aS)}catch(aR){this.model.setError("Upload failed.");return}}if(aS.success){this.model.setFile(aS.data.token,aS.data.name)}else{this.model.setError(aS.data.message)}}});var p=aM.extend({source:"Dropbox",template:_.template(a("#dropbox_upload").html()),events:{"click a":"onClick"},onClick:function(aR){var aS=this;aR.preventDefault();Dropbox.choose({linkType:"direct",success:function(aT){if(aT.length<1){aS.model.setError("File could not be selected.");return}if(aS.validate(aT[0].bytes,aT[0].name)){aS.model.setError(aS.validate(aT[0].bytes,aT[0].name));return}aS.model.setUploading();aS.model.set({fileName:aT[0].name});aS.model.setFileSize(aT[0].bytes);aS.model.fetch("Dropbox",aT[0].link,null,{success:_.bind(aS.success,aS),error:_.bind(aS.error,aS)})},cancel:function(){}})},success:function(aR,aS){this.model.setFile(aS.token,aS.name)},error:function(aR,aS){this.model.setError(aS)},onScriptLoaded:function(){if(Dropbox.isBrowserSupported()){this.$el.html(this.template(this.model))}},render:function(){JOBCENTRE.lazyLoad.js("https://www.dropbox.com/static/api/1/dropins.js",_.bind(this.onScriptLoaded,this),{id:"dropboxjs","data-app-key":o});return this}});var aP=aM.extend({source:"Web",template:_.template(a("#web_upload").html()),events:{"submit form":"onSubmit"},onSubmit:function(aR){aR.preventDefault();if(!this.$("[name=web_upload]").val().trim()){return}this.model.setUploading();this.model.fetch("Web",this.$("[name=web_upload]").val(),null,{success:_.bind(this.success,this),error:_.bind(this.error,this)})},success:function(aR,aS){this.model.setFile(aS.token,aS.name)},error:function(aR,aS){this.model.setError(aS)},render:function(){this.$el.html(this.template(this.model));return this}});var aA=d.extend({initialize:function(){this.content=null},events:{'click [data-action="edit"]':"renderEdit",'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){var aR=this;if(this.model.isNew()){this.model.collection.remove(this.model);this.$el.fadeOut("fast",function(){aR.dispose()})}else{this.renderDetails()}},renderDetails:function(){var aR=this;if(this.content){this.content.$el.fadeOut("fast",function(){aR.disposeChildren(aR.content);aR.content=aR.addChildren(aR.detailsView());aR.content.on("render-deleted",aR.renderDeleted,aR);aR.content.$el.hide();aR.$el.append(aR.content.render().el);aR.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.detailsView());this.content.on("render-deleted",aR.renderDeleted,aR);this.$el.append(this.content.render().el)}},renderEdit:function(){var aR=this;if(this.content){this.content.$el.fadeOut("fast",function(){aR.disposeChildren(aR.content);aR.content=aR.addChildren(aR.editView());aR.content.on("render-details",aR.renderDetails,aR);aR.content.on("render-deleted",aR.renderDeleted,aR);aR.content.$el.hide();aR.$el.append(aR.content.render().el);aR.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.editView());this.content.on("render-details",this.renderDetails,aR);this.content.on("render-deleted",aR.renderDeleted,aR);this.content.$el.hide();this.$el.append(this.content.render().el);this.content.$el.fadeIn("fast")}},renderDeleted:function(){var aR=this;this.content.$el.fadeOut("fast",function(){aR.disposeChildren(aR.content);aR.content=aR.addChildren(aR.removedView());aR.content.on("render-details",aR.renderDetails,aR);aR.content.$el.hide();aR.$el.append(aR.content.render().el);aR.content.$el.fadeIn("fast")})},removedView:function(){throw new Error("Not Implemented.")},render:function(){if(this.model.isNew()){this.renderEdit()}else{this.renderDetails()}return this}});var J=d.extend({className:"clearfix",initialize:function(aR){this.listenTo(this.model.state,"change",this.render)},render:function(){if(this.renderState(this.model.state)){return this}this.$el.empty();this.$el.append(this.addChildren(new A({model:this.model,requireVerification:this.options.requireVerification,countries:this.options.countries,memberStatuses:this.options.memberStatuses,careerLevels:this.options.careerLevels,enabled:this.options.enabled})).render().el);this.$el.append(this.addChildren(new v({collection:this.model.educations})).render().el);this.$el.append(this.addChildren(new X({collection:this.model.positions})).render().el);this.$el.append(this.addChildren(new aG({collection:this.model.skills})).render().el);this.$el.append(this.addChildren(new az({model:this.model.resume})).render().el);return this}});var A=d.extend({template:_.template(a("#headline").html()),className:"clearfix",render:function(){this.$el.html(this.template());this.addChildren(new ag({el:this.$('[data-outlet="publish_cta"]')[0],model:this.model,requireVerification:this.options.requireVerification})).render();this.addChildren(new aL({el:this.$('[data-outlet="status"]')[0],model:this.model,requireVerification:this.options.requireVerification})).render();this.$('[data-outlet="photo"]').append(this.addChildren(new R({model:this.model.photo})).render().el);this.addChildren(new M({el:this.$('[data-outlet="personal_info"]')[0],model:this.model,countries:this.options.countries})).render();if(this.options.enabled.memberStatus){this.addChildren(new I({el:this.$('[data-outlet="member_status"]')[0],model:this.model,memberStatuses:this.options.memberStatuses})).render()}if(this.options.enabled.careerLevel){this.addChildren(new k({el:this.$('[data-outlet="career_level"]')[0],model:this.model,careerLevels:this.options.careerLevels})).render()}this.addChildren(new ab({el:this.$('[data-outlet="position_types_wrapper"]')[0],model:this.model})).render();this.addChildren(new at({el:this.$('[data-outlet="relocations"]')[0],collection:this.model.relocations})).render();return this}});var ag=b.extend({template:_.template(a("#publish_cta").html()),initialize:function(){this.listenTo(this.model,"change:published",this.render)},events:{"click [data-action=publish-now]":"onPublishNowClick"},onPublishNowClick:function(aR){if(!this.options.requireVerification){this.save({published:true});return}var aS=this;var aT=this.addChildren(new aO());aT.on("verified",function(){aS.disposeAllChildren();aS.save({published:true})});a("body").append(aT.render().el)},onPublishedChange:function(){if(this.model.get("published")){this.$el.slideUp()}},render:function(){if(this.model.get("published")){this.$el.hide()}else{this.$el.html(this.template(this.model.toJSON())).show()}return this}});var aL=aA.extend({initialize:function(aR){aA.prototype.initialize.call(this,aR);this.listenTo(this.model,"change:published",this.render);this.listenTo(this.model,"change:confidential",this.render)},detailsView:function(){return new aJ({model:this.model})},editView:function(){return new aK({model:this.model,requireVerification:this.options.requireVerification})}});var aJ=d.extend({template:_.template(a("#status_details").html()),className:"flex-relative flex-p10 flex-mv10",render:function(){this.$el.html(this.template(this.model.toJSON()));var aR="alert alert-warning";if(this.model.get("published")){if(this.model.get("confidential")){aR="alert alert-info"}else{if(this.model.get("blockRecruiters")){aR="alert alert-info"}else{aR="alert alert-success"}}}this.$el.addClass(aR);return this}});var aK=b.extend({template:_.template(a("#status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",onSaveSuccess:function(aR,aS){this.trigger("render-details")},formPreProcess:function(aR){switch(aR.jobseeker_profile_status){case"visible":aR.published=true;aR.confidential=false;aR.blockRecruiters=false;break;case"blockRecruiters":aR.published=true;aR.confidential=false;aR.blockRecruiters=true;break;case"confidential":aR.published=true;aR.confidential=true;aR.blockRecruiters=false;break;case"private":aR.published=false;aR.confidential=false;aR.blockRecruiters=false;break;default:throw new Error()}delete aR.jobseeker_profile_status},onSubmit:function(aR){if(!this.options.requireVerification){b.prototype.onSubmit.call(this,aR);return}var aS=this;aR.preventDefault();switch(a("[name=jobseeker_profile_status]:checked").val()){case"visible":case"blockRecruiters":case"confidential":var aT=this.addChildren(new aO());aT.on("verified",function(){aS.disposeAllChildren();b.prototype.onSubmit.call(aS,aR)});a("body").append(aT.render().el);return;case"private":b.prototype.onSubmit.call(this,aR);return;default:throw new Error()}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aO=d.extend({template:_.template(a("#verification").html()),events:{"change input":"onInputChange","click [data-action=cancel]":"onCancelClick"},onCancelClick:function(){this.dispose()},onInputChange:function(){if(this.$("[name=verification]").prop("checked")){this.trigger("verified")}},render:function(){this.$el.html(this.template());return this}});var M=aA.extend({detailsView:function(){return new K({model:this.model})},editView:function(){return new L({model:this.model,countries:this.options.countries})}});var K=d.extend({template:_.template(a("#personal_info_details").html()),className:"flex-p10 flex-m0 clearfix",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var L=b.extend({template:_.template(a("#personal_info_edit").html()),className:"container-muted flex-p10 flex-m0 flex-relative clearfix flex-minheight200",onCountryChange:function(){b.prototype.onCountryChange.call(this);this.$('[data-outlet="legal_right"]').toggle(this.$('select[name="country.id"]').val()!="124")},onSaveSuccess:function(aR,aS){this.trigger("render-details")},formPreProcess:function(aR){aR.country={id:aR["country.id"]};delete aR["country.id"];aR.province={id:aR["province.id"]};delete aR["province.id"]},render:function(){if(this.renderState(this.options.countries.state)){return this}this.$el.html(this.template(this.model.toJSON()));this.renderCountries();this.bindSelect2();return this}});var I=aA.extend({detailsView:function(){return new F({model:this.model})},editView:function(){return new G({model:this.model,memberStatuses:this.options.memberStatuses})}});var F=d.extend({template:_.template(a("#member_status_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({memberStatus:this.model.get("memberStatus")}));return this}});var G=b.extend({template:_.template(a("#member_status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aR){this.listenTo(aR.memberStatuses.state,"change",this.render)},onSaveSuccess:function(aR,aS){this.trigger("render-details")},formPreProcess:function(aR){aR.memberStatus={id:aR["memberStatus.id"]};delete aR["memberStatus.id"]},renderMemberStatuses:function(){if(this.model.get("memberStatus")&&this.model.get("memberStatus").id==3){throw new Error("PSI student cannot change member status.")}var aS=this,aR=[];aR.push('<option value=""></option>');this.options.memberStatuses.each(function(aT){if(aT.id==3){return}aR.push(String.format('<option value="{0}"{1}>{2}</option>',aT.id,aS.model.get("memberStatus")&&aS.model.get("memberStatus").id==aT.id?' selected="selected"':"",aT.get("name")))});this.$('select[name="memberStatus.id"]').html(aR.join("")).change()},render:function(){if(this.renderState(this.options.memberStatuses.state)){return this}this.$el.html(this.template({memberStatus:this.model.get("memberStatus")}));this.renderMemberStatuses();this.bindSelect2();return this}});var k=aA.extend({detailsView:function(){return new h({model:this.model})},editView:function(){return new i({model:this.model,careerLevels:this.options.careerLevels})}});var h=d.extend({template:_.template(a("#career_level_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));return this}});var i=b.extend({template:_.template(a("#career_level_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aR){this.listenTo(aR.careerLevels.state,"change",this.render)},onSaveSuccess:function(aR,aS){this.trigger("render-details")},formPreProcess:function(aR){aR.careerLevel={id:aR["careerLevel.id"]};delete aR["careerLevel.id"]},renderCareerLevels:function(){var aS=this,aR=[];aR.push('<option value=""></option>');this.options.careerLevels.each(function(aT){aR.push(String.format('<option value="{0}"{1}>{2}</option>',aT.id,aS.model.get("careerLevel")&&aS.model.get("careerLevel").id==aT.id?' selected="selected"':"",aT.get("name")))});this.$('select[name="careerLevel.id"]').html(aR.join("")).change()},render:function(){if(this.renderState(this.options.careerLevels.state)){return this}this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));this.renderCareerLevels();this.bindSelect2();return this}});var ab=d.extend({template:_.template(a("#position_types_wrapper").html()),render:function(){this.$el.html(this.template());this.addChildren(new aa({el:this.$('[data-outlet="position_types"]')[0],model:this.model})).render();return}});var aa=aA.extend({detailsView:function(){return new Y({model:this.model})},editView:function(){return new Z({model:this.model})}});var Y=d.extend({template:_.template(a("#position_types_details").html()),className:"clearfix flex-relative",render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var Z=b.extend({template:_.template(a("#position_types_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",onSaveSuccess:function(aR,aS){this.trigger("render-details")},formPreProcess:function(aR){aR.positionTypes=_.map(aR.positionTypes.split(","),function(aS){return{id:aS}})},render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var al=d.extend({events:{'click [data-action="add_new"]':"onAddNew"},onAddNew:function(){var aR=this.newModel();this.collection.add(aR);this.renderItem(aR)},renderItems:function(){var aR=this;this.collection.each(function(aS){aR.renderItem(aS)})},renderItem:function(aR){var aS=this.addChildren(this.newView(aR));this.$('[data-outlet="qualifications"]').append(aS.render().el);return aS},render:function(){this.$el.html(this.template());this.renderItems();return this}});var at=al.extend({newModel:function(){return new an()},newView:function(aR){return new au({model:aR})},template:_.template(a("#relocations").html())});var v=al.extend({newModel:function(){return new q()},newView:function(aR){return new w({model:aR})},template:_.template(a("#educations").html())});var X=al.extend({newModel:function(){return new S()},newView:function(aR){return new ac({model:aR})},template:_.template(a("#positions").html())});var aG=al.extend({newModel:function(){return new aB()},newView:function(aR){return new aH({model:aR})},template:_.template(a("#skills").html())});var am=aA.extend({});var au=am.extend({detailsView:function(){return new ao({model:this.model})},editView:function(){return new ap({model:this.model})},removedView:function(){return new aq({model:this.model})}});var w=am.extend({detailsView:function(){return new r({model:this.model})},editView:function(){return new s({model:this.model})},removedView:function(){return new t({model:this.model})}});var ac=am.extend({detailsView:function(){return new T({model:this.model})},editView:function(){return new U({model:this.model})},removedView:function(){return new V({model:this.model})}});var aH=am.extend({detailsView:function(){return new aC({model:this.model})},editView:function(){return new aD({model:this.model})},removedView:function(){return new aE({model:this.model})}});var ai=d.extend({className:"flex-relative",events:{'click [data-action="remove"]':"delete"},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aR,aS){this.trigger("render-deleted")},onDeleteError:function(aS,aR){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aR).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var ao=ai.extend({template:_.template(a("#relocation_details").html())});var r=ai.extend({template:_.template(a("#education_details").html())});var T=ai.extend({template:_.template(a("#position_details").html())});var aC=ai.extend({template:_.template(a("#skill_details").html()),className:"flex-relative flex-p5"});var aj=b.extend({className:"container-muted flex-p10 flex-mt5 flex-mb15 clearfix flex-relative",events:function(){return _.extend({},b.prototype.events,{'click [data-action="remove"]':"delete"})},onSaveSuccess:function(aR,aS){this.trigger("render-details")},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aR,aS){this.trigger("render-deleted")},onDeleteError:function(aS,aR){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aR).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.isNew()){this.$el.addClass("new")}this.bindSelect2();return this}});var ap=aj.extend({template:_.template(a("#relocation_edit").html()),formPreProcess:function(aR){aR.location={description:aR["location.description"]};delete aR["location.description"]},render:function(){var aS=this;aj.prototype.render.call(this);var aR=function(){aS.$('input[name="location.description"]').jsonSuggest({url:aN.locations,textPropertyName:"description",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aR,10)}else{aR()}return this}});var s=aj.extend({template:_.template(a("#education_edit").html()),formPreProcess:function(aR){aR.degree={id:aR["degree.id"]};delete aR["degree.id"]}});var U=aj.extend({template:_.template(a("#position_edit").html()),events:function(){return _.extend({},aj.prototype.events(),{"change [name=isCurrent]":"onIsCurrentChange"})},onIsCurrentChange:function(aR){this.$('[data-outlet="end_date"]').fadeToggle("fast")},formPreProcess:function(aR){aR.start=aR.startMonth&&aR.startYear?aR.startYear+"-"+aR.startMonth+"-01":"";aR.end=aR.endMonth&&aR.endYear&&!aR.isCurrent?aR.endYear+"-"+aR.endMonth+"-01":"";delete aR.startMonth;delete aR.startYear;delete aR.endMonth;delete aR.endYear;delete aR.isCurrent}});var aD=aj.extend({template:_.template(a("#skill_edit").html()),formPreProcess:function(aR){aR.proficiency={id:aR["proficiency.id"]};aR.experience={id:aR["experience.id"]};delete aR["proficiency.id"];delete aR["experience.id"]},render:function(){var aS=this;aj.prototype.render.call(this);var aR=function(){aS.$('input[name="type"]').jsonSuggest({url:aN.skills,textPropertyName:"name",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aR,10)}else{aR()}return this}});var ak=d.extend({className:"flex-p10 flex-mv15 container-warning flex-relative",events:{'click [data-action="undo"]':"onUndoClick"},onUndoClick:function(){this.model.set("id",null);this.showSavingState();this.model.save(this.model.toJSON(),{success:_.bind(this.onUndoSuccess,this),error:_.bind(this.onUndoError,this)})},onUndoSuccess:function(aR,aS){this.trigger("render-details")},onUndoError:function(aS,aR){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aR).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aq=ak.extend({template:_.template(a("#relocation_removed").html()),onUndoClick:function(){this.model.set("location",{description:this.model.get("location").description});ak.prototype.onUndoClick.call(this)}});var t=ak.extend({template:_.template(a("#education_removed").html())});var V=ak.extend({template:_.template(a("#position_removed").html())});var aE=ak.extend({template:_.template(a("#skill_removed").html())});var z=d.extend({template:_.template(""),uploadingTemplate:_.template(a("#file_uploading").html()),progressTemplate:_.template(a("#file_progress").html()),errorTemplate:_.template(a("#file_error").html()),initialize:function(){this.fileUploadView=null;this.listenTo(this.model.file,"change:state",this.onStateChange);this.listenTo(this.model.file,"change:progress",this.onProgressChange);this.listenTo(this.model.file,"change:token",this.onTokenChange)},renderButton:function(){this.renderUploadButton();if(this.model.file.includeDropbox){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new p({model:this.model.file})).render().el)}if(this.model.file.includeWeb){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new aP({model:this.model.file})).render().el)}this.onStateChange(this.model.file,this.model.file.get("state"))},onSubmitFile:function(){this.$("form").submit()},showButton:function(){this.$('[data-element="upload_title"]').show();this.$('[data-outlet="file_uploaders"]').show();this.disposeChildren(this.fileUploadView);this.renderUploadButton()},renderUploadButton:function(){this.fileUploadView=this.addChildren(y.create({model:this.model.file,callback:this.$("input[name=callback]").val(),iframeId:this.$("iframe")[0].id}));this.fileUploadView.on("submit-file",this.onSubmitFile,this);this.$('[data-outlet="file_uploaders"]').prepend(this.fileUploadView.render().el)},hideButton:function(){this.$('[data-outlet="file_uploaders"]').hide();this.$('[data-element="upload_title"]').hide()},onStateChange:function(aR,aS){switch(aS){case"idle":return;case"uploading":this.$('[data-element="error_message"]').html("").hide();this.$('[data-element="upload_progress"]').html(this.uploadingTemplate(this.model.file.toJSON())).show();this.hideButton();return;case"uploaded":return;case"error":this.$('[data-element="error_message"]').html(this.errorTemplate(this.model.file.toJSON())).show();this.$('[data-element="upload_progress"]').html("").hide();this.showButton();return;default:throw new Error(String.format("State {0} not supported.",aS))}},onProgressChange:function(aR,aS){if(aS){this.$('[data-element="upload_progress"]').html(this.progressTemplate(this.model.file.toJSON())).show()}},onTokenChange:function(){if(!this.model.file.get("token")){return}this.model.replace({success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},onSaveSuccess:function(aR,aS){},onSaveError:function(aS,aR){this.model.file.setError(aR)},render:function(){this.$el.html(this.template(this.model.file));this.renderButton();return this}});var R=d.extend({template:_.template(a("#photo").html()),initialize:function(){this.listenTo(this.model,"change:photoUrl",this.onPhotoUrlChange)},onPhotoUrlChange:function(){this.disposeAllChildren();this.render()},events:{'click [data-action="replace"]':"onReplaceClick",'click [data-action="remove"]':"onDeleteClick","click [data-action=undo]":"onUndoClick"},onReplaceClick:function(){this.model.file.setIdle();this.$el.append(this.addChildren(new O({model:this.model})).render().el)},onDeleteClick:function(){this.showSavingState();this.model["delete"]({error:_.bind(this.onError,this)})},onUndoClick:function(){this.showSavingState();this.model.undo({error:_.bind(this.onError,this)})},onError:function(aS,aR){this.hideSavingState()},render:function(){this.$el.html(this.template(this.model));return this}});var O=z.extend({template:_.template(a("#photo_edit").html()),events:{'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){this.dispose()}});var az=d.extend({initialize:function(){this.content=null},renderDetails:function(){this.disposeChildren(this.content);this.content=this.addChildren(new aw({model:this.model}));this.content.on("edit",this.renderEdit,this);this.$el.append(this.content.render().el)},renderEdit:function(){this.disposeChildren(this.content);this.content=this.addChildren(new ax({model:this.model}));this.content.on("render-details",this.renderDetails,this);this.$el.append(this.content.render().el)},render:function(){if(this.model.get("url")){this.renderDetails()}else{this.renderEdit()}return this}});var aw=d.extend({template:_.template(a("#resume_details").html()),events:{'click [data-action="replace"]':"onReplaceClick"},onReplaceClick:function(){this.trigger("edit")},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var ax=z.extend({template:_.template(a("#resume_edit").html()),onSaveSuccess:function(aR,aS){this.trigger("render-details")}});a.ajaxSetup({statusCode:{}});a.ajaxPrefilter(function(aS,aT,aR){aS.statusCode=_.extend(aS.statusCode||{},{401:function(aV,aW,aU){window.location.reload(true)}})});return{init:function(aV){o=aV.dropboxAppKey;aN(aV.restPath);var aT=new C({id:aV.jobseekerId});var aS=new n();var aR=new g();var aU=new E();var aW=new J({model:aT,countries:aS.getCountries(),careerLevels:aR.getCareerLevels(),memberStatuses:aU.getMemberStatuses(),requireVerification:aV.requireVerification,enabled:aV.enabled});a('[data-outlet="container"]').append(aW.render().el);aT.fetch()}}}(jQuery));