var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobseekerProfile=(function(a){var p;var aK=function(aO){aK={jobseekers:"/api/v1.0/resumes/:id",relocations:"/api/v1.0/resumes/:id/relocations",educations:"/api/v1.0/resumes/:id/educations",positions:"/api/v1.0/resumes/:id/positions",jobseekerSkills:"/api/v1.0/resumes/:id/skills",photos:aO+"files",formPhoto:aO+"files/form",fetchPhoto:aO+"files/fetch",resumes:aO+"resumes",formResume:aO+"resumes/form",fetchResume:aO+"resumes/fetch",countries:"/api/v1.0/countries",provinces:"/api/v1.0/provinces?countryId=:id",careerLevels:"/api/v1.0/careerlevels",locations:"/api/v1.0/locations?pageSize=7&types=town%2Cprovince%2Ccountry",skills:"/api/v1.0/skills?pageSize=7"}};var c=Backbone.Model.extend({_validators:{required:function(aR,aO,aS,aP,aQ){if(!aS||(aS+"").trim()==""){aQ.push({attr:aO,message:aR.message||(" is required")})}},maxLength:function(aR,aO,aS,aP,aQ){if(!aS||(aS+"").trim()==""){return}if(aS.trim().length>aR.max){aQ.push({attr:aO,message:aR.message||String.format(" exceeds {0} characters",aR.max)})}},regex:function(aR,aO,aS,aP,aQ){if(!aS||(aS+"").trim()==""){return}if(!aR.pattern.test(aS.trim())){aQ.push({attr:aO,message:aR.message||(" is invalid")})}},custom:function(aR,aO,aT,aP,aQ){if(!aR.isValid){throw new Error("isValid missing for custom validation")}var aS=aR.isValid(aR,aO,aT,aP);if(aS===true){return}if(aS===false){aQ.push({attr:aO,message:aR.message});return}if(_.isString(aS)){aQ.push({attr:aO,message:aS});return}throw new Error("validity not supported.")}},isValid:function(){if(!this.validations){return true}var aP=[];for(var aO in this.attributes){if(!this.attributes.hasOwnProperty(aO)){continue}if(!this.validations[aO]){continue}var aR=this.validations[aO];for(var aQ in aR){if(!aR.hasOwnProperty(aQ)){continue}if(!this._validators[aQ]){throw new Error("Validation "+aQ+" not supported.")}this._validators[aQ](aR[aQ],aO,this.attributes[aO],this.attributes,aP)}}if(aP.length>0){this.trigger("validation-error",this,aP);return false}else{return true}}});var aF=Backbone.Model.extend({defaults:{ready:false,error:null}});var e=Backbone.Model.extend({collection:Backbone.Collection,listName:"",url:"",initialize:function(){this._loading=false;this._loaded=false;this._list=new this.collection()},getList:function(){if(!this._loaded){this._load()}return this._list},_load:function(){var aO=this;if(!this._loading){this._list.state.set({ready:false,error:null});this._loading=true;var aP=this.url;if(_.isFunction(aP)){aP=aP.call(this)}a.ajax({url:aP,dataType:"json",cache:true,type:"GET",success:function(aR,aS,aQ){aO._list.reset(aR.data);aO._list.state.set({ready:true,error:null});aO._loaded=true},error:function(aR,aS,aQ){aO._list.state.set({error:String.format("Error retrieving {0} list.",aO.listName)})},complete:function(aQ,aR){aO._loading=false}})}}});var m=Backbone.Model.extend({initialize:function(){this.provinceCache=new ac(null,{countryId:this.id})}});var l=Backbone.Collection.extend({model:m,initialize:function(){this.state=new aF()}});var n=e.extend({collection:l,listName:"country",url:function(){return aK.countries},getCountries:function(){return this.getList()}});var ab=Backbone.Model.extend({});var ad=Backbone.Collection.extend({model:ab,initialize:function(){this.state=new aF()}});var ac=e.extend({collection:ad,listName:"province",url:function(){return aK.provinces.replace(":id",this._countryId)},initialize:function(aO,aP){e.prototype.initialize.call(this,aO,aP);this._countryId=aP.countryId},getProvinces:function(){return this.getList()}});var f=Backbone.Model.extend({});var j=Backbone.Collection.extend({model:f,initialize:function(){this.state=new aF()}});var g=e.extend({collection:j,listName:"career level",url:function(){return aK.careerLevels},getCareerLevels:function(){return this.getList()}});var y=c.extend({defaults:{state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null},setError:function(aO){this.set({state:"error",error:aO})},setUploading:function(aO){this.set({state:"uploading"})},setFile:function(aP,aO){this.set({state:"uploaded",token:aP,fileName:aO})},setIdle:function(aP,aO){this.set({state:"idle",fileName:"",fileSize:0,token:null,progress:0,error:null})},setFileSize:function(aO){if(aO===0){this.set({fileSize:"? KB"})}else{if(aO>1024*1024){this.set({fileSize:(Math.round(aO*100/(1024*1024))/100).toString()+"MB"})}else{this.set({fileSize:(Math.round(aO*100/1024)/100).toString()+"KB"})}}},isUploaded:function(){return this.get("state")==="uploaded"},isUploading:function(){return this.get("state")==="uploading"},sendUrl:null,sendName:null,fetchUrl:null,send:function(aQ,aO){var aP=new FormData();aP.append(this.sendName,aQ);var aR=new XMLHttpRequest();aR.upload.addEventListener("progress",aO.progress,false);aR.addEventListener("load",aO.load,false);aR.addEventListener("error",aO.error,false);aR.addEventListener("abort",aO.abort,false);aR.open("POST",this.sendUrl());aR.setRequestHeader("Accept","application/json");aR.send(aP)},fetch:function(aR,aP,aO,aQ){aQ||(aQ={});var aS=this;a.ajax({url:this.fetchUrl(),contentType:"application/json",data:JSON.stringify({url:aP,accessToken:aO,source:aR}),dataType:"json",type:"POST",success:function(aU,aV,aT){if(aQ.success){aQ.success(aS,aU)}},error:function(aU,aW,aT){if(aU.status>=400&&aU.status<500){var aV=JSON.parse(aU.responseText);if(aQ.error){aQ.error(aS,aV.message);return}}if(aQ.error){aQ.error(aS,"Error connecting to the server.")}}})}});var N=y.extend({maxFileSize:5,fileTypes:["png","jpg"],fileTypeMessage:"Only PNG and JPG file types allowed.",sendUrl:function(){return aK.photos},sendName:"file",fetchUrl:function(){return aK.fetchPhoto},includeDropbox:true,includeWeb:true});var av=y.extend({maxFileSize:1,fileTypes:["docx","doc","rtf","pdf","txt"],fileTypeMessage:"Only Word, Plain Text, PDF, RTF file types allowed.",sendUrl:function(){return aK.resumes},sendName:"file",fetchUrl:function(){return aK.fetchResume},includeDropbox:true,includeWeb:false});var G=c.extend({initialize:function(){this._loading=false;this.state=new aF();this.photo=new L();this.photo.jobseeker=this;this.relocations=new ao();this.relocations.jobseeker=this;this.educations=new v();this.educations.jobseeker=this;this.positions=new U();this.positions.jobseeker=this;this.skills=new aC();this.skills.jobseeker=this;this.resume=new ar();this.resume.jobseeker=this;this.on("change:published",this.onPublishedChange,this)},onPublishedChange:function(){if(this.previous("published")===undefined){return}if(this.get("published")&&!this.previous("published")&&window.dataLayer){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobseekerProfilePublish",eventLabel:undefined,nonInteraction:false})}},url:function(){return aK.jobseekers.replace(":id",this.id)},parse:function(aP,aO){this.photo.setPhotoUrl(aP.photoUrl);delete aP.photoUrl;this.relocations.reset(aP.relocations);delete aP.relocations;this.educations.reset(aP.educations);delete aP.educations;this.positions.reset(aP.positions);delete aP.positions;this.skills.reset(aP.skills);delete aP.skills;this.resume.set({url:aP.fileUrl,fileType:aP.fileType});delete aP.fileUrl;delete aP.fileType;return aP},fetch:function(aO){aO||(aO={});var aP=this;if(this._loading){return}this.state.set({ready:false,error:null});this._loading=true;a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(aR,aS,aQ){aP.set(aP.parse(aR));aP.state.set({ready:true,error:null});if(aO.success){aO.success(aP,aR)}},error:function(aS,aT,aR){var aQ=aS.status>=400&&aS.status<500?JSON.parse(aS.responseText).message:"Error retrieving profile.";aP.state.set({error:aQ});if(aO.error){aO.error(aP,aQ)}},complete:function(aQ,aR){aP._loading=false}})},save:function(aO,aP){aP||(aP={});var aQ=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aO),dataType:"json",type:"PUT",success:function(aS,aT,aR){delete aS.photoUrl;delete aS.educations;delete aS.positions;delete aS.skills;delete aS.fileUrl;delete aS.fileType;aQ.set(aS);if(aP.success){aP.success(aQ,aS)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})}});var L=c.extend({defaults:{photoUrl:null},initialize:function(){this.file=new N()},url:function(){return aK.jobseekers.replace(":id",this.jobseeker.id)},getDisplayUrl:function(){if(this.get("photoUrl")&&this.get("photoUrl").get("url")){return this.get("photoUrl").get("url")}else{return"/images/profile_missing.png"}},setPhotoUrl:function(aO){this.set({photoUrl:new O({url:aO,previous:this.get("photoUrl")})})},replace:function(aO){this.save(JSON.stringify({photoToken:this.file.get("token")}),aO)},"delete":function(aO){this.save(JSON.stringify({photoUrl:""}),aO)},save:function(aO,aP){aP||(aP={});var aQ=this;a.ajax({url:this.url(),contentType:"application/json",data:aO,dataType:"json",type:"PUT",success:function(aS,aT,aR){aQ.setPhotoUrl(aS.photoUrl);if(aP.success){aP.success(aQ,aS)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})},undo:function(aO){aO||(aO={});var aP=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({photoUrl:this.get("photoUrl").get("previous").get("url")}),dataType:"json",type:"PUT",success:function(aR,aS,aQ){aP.set({photoUrl:aP.get("photoUrl").get("previous")});if(aO.success){aO.success(aP,aR)}},error:function(aR,aT,aQ){if(aR.status>=400&&aR.status<500){var aS=JSON.parse(aR.responseText);if(aO.error){aO.error(aP,aS.message);return}}if(aO.error){aO.error(aP,"Error connecting to the server.")}}})}});var O=Backbone.Model.extend({});var ae=c.extend({save:function(aO,aP){var aQ=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify(aO),dataType:"json",type:this.isNew()?"POST":"PUT",success:function(aS,aT,aR){aQ.set(aS);if(aP.success){aP.success(aQ,aS)}},error:function(aS,aU,aR){if(aS.status>=400&&aS.status<500){var aT=JSON.parse(aS.responseText);if(aP.error){aP.error(aQ,aT.message);return}}if(aP.error){aP.error(aQ,"Error connecting to the server.")}}})},"delete":function(aO){var aP=this;a.ajax({url:this.url(),contentType:"application/json",dataType:"json",type:"DELETE",success:function(aR,aS,aQ){if(aO.success){aO.success(aP)}},error:function(aR,aT,aQ){if(aR.status>=400&&aR.status<500){var aS=JSON.parse(aR.responseText);if(aO.error){aO.error(aP,aS.message);return}}if(aO.error){aO.error(aP,"Error connecting to the server.")}}})}});var ak=ae.extend({url:function(){if(this.isNew()){return aK.relocations.replace(":id",this.collection.jobseeker.id)}else{return aK.relocations.replace(":id",this.collection.jobseeker.id)+"/"+this.get("id")}}});var ao=Backbone.Collection.extend({model:ak});var r=ae.extend({defaults:{school:"",degree:null,fieldOfStudy:"",startYear:null,endYear:null},url:function(){if(this.isNew()){return aK.educations.replace(":id",this.collection.jobseeker.id)}else{return aK.educations.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var v=Backbone.Collection.extend({model:r});var Q=ae.extend({defaults:{title:"",company:"",start:null,end:null,duration:""},url:function(){if(this.isNew()){return aK.positions.replace(":id",this.collection.jobseeker.id)}else{return aK.positions.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var U=Backbone.Collection.extend({model:Q});var ay=ae.extend({defaults:{type:"",proficiency:null,experience:null},url:function(){if(this.isNew()){return aK.jobseekerSkills.replace(":id",this.collection.jobseeker.id)}else{return aK.jobseekerSkills.replace(":id",this.collection.jobseeker.id)+"/"+this.id}}});var aC=Backbone.Collection.extend({model:ay});var ar=c.extend({initialize:function(){this.file=new av()},url:function(){return aK.jobseekers.replace(":id",this.jobseeker.id)},replace:function(aO){aO||(aO={});var aP=this;a.ajax({url:this.url(),contentType:"application/json",data:JSON.stringify({fileToken:this.file.get("token")}),dataType:"json",type:"PUT",success:function(aR,aS,aQ){aP.set({url:aR.fileUrl,fileType:aR.fileType});if(aO.success){aO.success(aP,aR)}},error:function(aR,aT,aQ){if(aR.status>=400&&aR.status<500){var aS=JSON.parse(aR.responseText);if(aO.error){aO.error(aP,aS.message);return}}if(aO.error){aO.error(aP,"Error connecting to the server.")}}})}});var d=function(aO){this.parent=null;this.children=[];Backbone.View.apply(this,[aO])};_.extend(d.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error").html()),loaderClass:"flex-loader",renderState:function(aO){if(aO.get("error")){a(this.el).html(this.errorTemplate({error:aO.get("error")}));return true}if(!aO.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(aO){var aP=document.createElement("div");aP.className=this.loaderClass;a(aO).empty().append(aP)},hideSavingState:function(){this.$el.children().removeClass("invisible").end().find(".flex-loader-mini").remove()},showSavingState:function(){this.$el.children().addClass("invisible").end().prepend('<div class="flex-loader-mini"></div>')},addChildren:function(aO){var aP,aQ=this;if(_.isArray(aO)){aP=aO}else{aP=_.toArray(arguments)}_.each(aP,function(aR){aQ.children.push(aR);aR.parent=aQ});if(aP.length===1){return aP[0]}else{return aP}},disposeChildren:function(aO){if(!aO){return}var aQ=this;var aP=_.isArray(aO)?aO:_.toArray(arguments);_.each(aP,function(aR){aR.dispose()})},disposeAllChildren:function(){var aO=this.children.slice(0);_.each(aO,function(aP){aP.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(aO){var aP=_.indexOf(this.children,aO);if(aP!==-1){this.children.splice(aP,1)}}});d.extend=Backbone.View.extend;var b=function(aO){d.apply(this,[aO]);this.listenTo(this.model,"validation-error",this.onValidationError,this);if(this.model.state){this.listenTo(this.model.state,"change",this.render)}if(aO.countries){this._currentProvinces=null;this.listenTo(aO.countries.state,"change",this.render)}};_.extend(b.prototype,d.prototype,{_validatable:false,events:{submit:"onSubmit","keyup input,textarea":"onKeyup","change select,input":"onChange",validate:"validateIfReady"},onSaveSuccess:function(aO,aP){},onSaveError:function(aP,aO){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aO).show()},onValidationError:function(aS,aQ){var aO=this.$('[data-element="alert_danger_server"]');aO.html("");for(var aR=aQ.length;aR--;){var aP=aQ[aR];if(_.isString(aP)){aO.html(aP).show()}else{this.$("input[name="+aP.attr+"],textarea[name="+aP.attr+"],select[name="+aP.attr+"]").each(function(){if(this.tagName==="SELECT"){a(this).siblings(".select2-container").addClass("error")}else{a(this).addClass("error")}}).closest(".form-group").find(".form-error").html(aP.message).show()}}this.onSaveError()},onSubmit:function(aP){aP.preventDefault();this._validatable=true;var aO=this.getFormValues();if(this.isValid(aO)){this.save(aO)}},save:function(aO){this.showSavingState();this.model.save(aO,{success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},getFormValues:function(){var aP=this;var aO={};this.$("input,textarea,select").each(function(){if(this.name&&!this.disabled){if(this.type==="radio"&&!this.checked){return}if(this.type==="checkbox"&&!this.checked){return}aO[this.name]=aO[this.name]?aO[this.name]+","+a(this).val():a(this).val()}});this.formPreProcess(aO);return aO},isValid:function(aO){this.$(".error").removeClass("error");this.$(".form-error").hide();return this.model.isValid(aO)},formPreProcess:function(aO){},onKeyup:function(aO){if(aO.which===13){return}this.validateIfReady()},onChange:function(aP){var aO=a(aP.currentTarget);if(aO.attr("name")==="country.id"){this.onCountryChange()}this.validateIfReady()},validateIfReady:function(){if(this._validatable){this.isValid(this.getFormValues())}},onCountryChange:function(){var aQ=this.$('select[name="country.id"]').val();if(aQ){var aP=this.options.countries.get(aQ);var aR=aP.provinceCache.getProvinces();this._currentProvinces=aR;if(!aR.state.get("ready")){var aO=this.$('select[name="province.id"]').closest('[data-element="province_input_section"]');if(aO.find(".select2-container").length){aO.append('<span data-element="loader" class="flex-loader-mini"></span>').find(".select2-container").css("visibility","hidden")}this.listenTo(aR.state,"change",this.renderProvinces);return}this.renderProvinces(aR.state)}},renderProvinces:function(aQ){if(this._currentProvinces.state!==aQ){return}var aR=this;var aO=this.$('select[name="province.id"]');aO.closest('[data-element="province_input_section"]').find('[data-element="loader"]').remove().end().find(".select2-container").css("visibility","visible");if(aQ.get("error")){JOBCENTRE.alertFloater.show({summary:aQ.get("error"),isError:true,duration:5000});return}if(!aQ.get("ready")){throw new Error("Provinces not ready.")}var aP=[];aP.push('<option value=""></option>');this._currentProvinces.each(function(aS){aP.push(String.format('<option value="{0}"{1}>{2}</option>',aS.id,(aR.model.get("province")&&aR.model.get("province").id==aS.id)?' selected="selected"':"",aS.get("name")))});aO.html(aP.join("")).trigger("change")},renderCountries:function(){var aP=this,aO=[];aO.push('<option value=""></option>');this.options.countries.each(function(aQ){aO.push(String.format('<option value="{0}"{1}>{2}</option>',aQ.id,(aP.model.get("country")&&(aP.model.get("country").id==aQ.id))?' selected="selected"':"",aQ.get("name")))});this.$('select[name="country.id"]').html(aO.join("")).change()},bindSelect2:function(){var aP=this;var aO=function(){aP.$("select").select2({allowClear:true})};if(!a.contains(document.documentElement,this.el)){setTimeout(aO,10)}else{aO()}}});b.extend=d.extend;var aJ=d.extend({validate:function(aQ,aP){if(aQ>this.model.maxFileSize*1024*1024){return String.format("File exceeds {0} MB.",this.model.maxFileSize)}var aO=_.last(aP.split(".")).toLowerCase();if(!_.contains(this.model.fileTypes,aO)){return this.model.fileTypeMessage}}});var z=aJ.extend({source:null,template:_.template(a("#file_upload").html()),events:{'change [data-element="file_input"]':"initializeUpload"},initializeUpload:function(){this.model.setUploading();this.uploadFile()},render:function(){this.$el.html(this.template({file:this.model,viewId:this.cid}));return this}},{create:function(aO){if(window.FormData){return new aN(aO)}else{return new F(aO)}}});var aN=z.extend({uploadFile:function(){var aO=this.$('[data-element="file_input"]')[0].files[0];if(!aO){this.model.setError("File could not be selected.");return}if(this.validate(aO.size,aO.name)){this.model.setError(this.validate(aO.size,aO.name));return}this.model.set({fileName:aO.name});this.model.setFileSize(aO.size);this.model.send(aO,{progress:_.bind(this.progress,this),load:_.bind(this.load,this),error:_.bind(this.error,this),abort:_.bind(this.abort,this)})},progress:function(aO){if(!aO.lengthComputable){return}var aP=Math.round(aO.loaded*100/aO.total);this.model.set({progress:aP})},load:function(aO){var aP=JSON.parse(aO.target.responseText);if(aO.target.status!==200){this.model.setError(aP.message);return}this.model.setFile(aP.file.token,aP.file.name)},error:function(){this.model.setError("Upload failed.")},abort:function(){this.model.setError("Upload cancelled.")}});var F=z.extend({uploadFile:function(){window[this.options.callback]=_.bind(this.load,this);document.getElementById(this.options.iframeId).onload=_.bind(this.load,this);this.trigger("submit-file")},load:function(aO,aP){if(!aP){try{aP=window.frames[this.options.iframeId].document.getElementsByTagName("body")[0].innerHTML;aP=JSON.parse(aP)}catch(aO){this.model.setError("Upload failed.");return}}if(aP.success){this.model.setFile(aP.data.file.token,aP.data.file.name)}else{this.model.setError(aP.data.message)}}});var q=aJ.extend({source:"Dropbox",template:_.template(a("#dropbox_upload").html()),events:{"click a":"onClick"},onClick:function(aO){var aP=this;aO.preventDefault();Dropbox.choose({linkType:"direct",success:function(aQ){if(aQ.length<1){aP.model.setError("File could not be selected.");return}if(aP.validate(aQ[0].bytes,aQ[0].name)){aP.model.setError(aP.validate(aQ[0].bytes,aQ[0].name));return}aP.model.setUploading();aP.model.set({fileName:aQ[0].name});aP.model.setFileSize(aQ[0].bytes);aP.model.fetch("Dropbox",aQ[0].link,null,{success:_.bind(aP.success,aP),error:_.bind(aP.error,aP)})},cancel:function(){}})},success:function(aO,aP){this.model.setFile(aP.file.token,aP.file.name)},error:function(aO,aP){this.model.setError(aP)},onScriptLoaded:function(){if(Dropbox.isBrowserSupported()){this.$el.html(this.template(this.model))}},render:function(){JOBCENTRE.lazyLoad.js("https://www.dropbox.com/static/api/1/dropins.js",_.bind(this.onScriptLoaded,this),{id:"dropboxjs","data-app-key":p});return this}});var aM=aJ.extend({source:"Web",template:_.template(a("#web_upload").html()),events:{"submit form":"onSubmit"},onSubmit:function(aO){aO.preventDefault();if(!this.$("[name=web_upload]").val().trim()){return}this.model.setUploading();this.model.fetch("Web",this.$("[name=web_upload]").val(),null,{success:_.bind(this.success,this),error:_.bind(this.error,this)})},success:function(aO,aP){this.model.setFile(aP.file.token,aP.file.name)},error:function(aO,aP){this.model.setError(aP)},render:function(){this.$el.html(this.template(this.model));return this}});var ax=d.extend({initialize:function(){this.content=null},events:{'click [data-action="edit"]':"renderEdit",'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){var aO=this;if(this.model.isNew()){this.model.collection.remove(this.model);this.$el.fadeOut("fast",function(){aO.dispose()})}else{this.renderDetails()}},renderDetails:function(){var aO=this;if(this.content){this.content.$el.fadeOut("fast",function(){aO.disposeChildren(aO.content);aO.content=aO.addChildren(aO.detailsView());aO.content.on("render-deleted",aO.renderDeleted,aO);aO.content.$el.hide();aO.$el.append(aO.content.render().el);aO.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.detailsView());this.content.on("render-deleted",aO.renderDeleted,aO);this.$el.append(this.content.render().el)}},renderEdit:function(){var aO=this;if(this.content){this.content.$el.fadeOut("fast",function(){aO.disposeChildren(aO.content);aO.content=aO.addChildren(aO.editView());aO.content.on("render-details",aO.renderDetails,aO);aO.content.on("render-deleted",aO.renderDeleted,aO);aO.content.$el.hide();aO.$el.append(aO.content.render().el);aO.content.$el.fadeIn("fast")})}else{this.content=this.addChildren(this.editView());this.content.on("render-details",this.renderDetails,aO);this.content.on("render-deleted",aO.renderDeleted,aO);this.content.$el.hide();this.$el.append(this.content.render().el);this.content.$el.fadeIn("fast")}},renderDeleted:function(){var aO=this;this.content.$el.fadeOut("fast",function(){aO.disposeChildren(aO.content);aO.content=aO.addChildren(aO.removedView());aO.content.on("render-details",aO.renderDetails,aO);aO.content.$el.hide();aO.$el.append(aO.content.render().el);aO.content.$el.fadeIn("fast")})},removedView:function(){throw new Error("Not Implemented.")},render:function(){if(this.model.isNew()){this.renderEdit()}else{this.renderDetails()}return this}});var H=d.extend({className:"clearfix flex-relative",initialize:function(aO){this.listenTo(this.model.state,"change",this.render)},render:function(){if(this.renderState(this.model.state)){return this}this.$el.empty();if(this.options.enabled.headline_text||this.options.enabled.headline_publish){this.$el.append(this.addChildren(new D({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}if(this.options.enabled.status){this.$el.append(this.addChildren(new aI({model:this.model,requireVerification:this.options.requireVerification})).render().el)}if(this.options.enabled.identity){this.$el.append(this.addChildren(new E({model:this.model,countries:this.options.countries})).render().el);this.$el.append("<hr />")}if(this.options.enabled.careerLevel){this.$el.append(this.addChildren(new k({model:this.model,careerLevels:this.options.careerLevels})).render().el)}if(this.options.enabled.positionTypes){this.$el.append(this.addChildren(new Z({model:this.model})).render().el)}if(this.options.enabled.relocations){this.$el.append(this.addChildren(new ap({collection:this.model.relocations})).render().el)}if(this.options.enabled.educations){this.$el.append(this.addChildren(new w({collection:this.model.educations})).render().el)}if(this.options.enabled.positions){this.$el.append(this.addChildren(new V({collection:this.model.positions})).render().el)}if(this.options.enabled.skills){this.$el.append(this.addChildren(new aD({collection:this.model.skills})).render().el)}if(this.options.enabled.resume){this.$el.append(this.addChildren(new aw({model:this.model.resume})).render().el)}return this}});var D=d.extend({className:"alert alert-info text-center clearfix",render:function(){if(this.options.enabled.headline_text){this.$el.append(this.addChildren(new C()).render().el)}if(this.options.enabled.headline_publish){this.$el.append(this.addChildren(new B({model:this.model,requireVerification:this.options.requireVerification,enabled:this.options.enabled})).render().el)}return this}});var C=d.extend({template:_.template(a("#headline_text").html()),render:function(){this.$el.html(this.template());return this}});var B=b.extend({template:_.template(a("#headline_publish").html()),templateCtaOnPublish:_.template(a("#cta_on_publish").html()),className:"editor-cta",initialize:function(){this.listenTo(this.model,"change:published",this.render)},events:{"click [data-action=publish-now]":"onPublishNowClick"},onPublishNowClick:function(aO){if(!this.options.requireVerification){this.save({published:true});return}var aP=this;var aQ=this.addChildren(new aL());aQ.on("verified",function(){aP.disposeAllChildren();aP.save({published:true})});a("body").append(aQ.render().el)},renderPrivate:function(){this.$el.html(this.template({enabled:this.options.enabled}))},renderPublished:function(){this.$el.empty();if(this.options.enabled.cta_on_publish){this.$el.html(this.templateCtaOnPublish())}},render:function(){if(this.model.get("published")){this.renderPublished()}else{this.renderPrivate()}return this}});var o=d.extend({render:function(){return this}});var aI=ax.extend({className:"editor-status-wrapper",initialize:function(aO){ax.prototype.initialize.call(this,aO);this.listenTo(this.model,"change:published",this.render);this.listenTo(this.model,"change:confidential",this.render)},detailsView:function(){return new aG({model:this.model})},editView:function(){return new aH({model:this.model,requireVerification:this.options.requireVerification})}});var aG=d.extend({template:_.template(a("#status_details").html()),className:"flex-relative flex-p10",render:function(){this.$el.html(this.template(this.model.toJSON()));var aO="alert alert-warning";if(this.model.get("published")){if(this.model.get("confidential")){aO="alert alert-info"}else{if(this.model.get("blockRecruiters")){aO="alert alert-info"}else{aO="alert alert-success"}}}this.$el.addClass(aO);return this}});var aH=b.extend({template:_.template(a("#status_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",onSaveSuccess:function(aO,aP){this.trigger("render-details")},formPreProcess:function(aO){switch(aO.jobseeker_profile_status){case"visible":aO.published=true;aO.confidential=false;aO.blockRecruiters=false;break;case"blockRecruiters":aO.published=true;aO.confidential=false;aO.blockRecruiters=true;break;case"confidential":aO.published=true;aO.confidential=true;aO.blockRecruiters=false;break;case"private":aO.published=false;aO.confidential=false;aO.blockRecruiters=false;break;default:throw new Error()}delete aO.jobseeker_profile_status},onSubmit:function(aO){if(!this.options.requireVerification){b.prototype.onSubmit.call(this,aO);return}var aP=this;aO.preventDefault();switch(a("[name=jobseeker_profile_status]:checked").val()){case"visible":case"blockRecruiters":case"confidential":var aQ=this.addChildren(new aL());aQ.on("verified",function(){aP.disposeAllChildren();b.prototype.onSubmit.call(aP,aO)});a("body").append(aQ.render().el);return;case"private":b.prototype.onSubmit.call(this,aO);return;default:throw new Error()}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var aL=d.extend({template:_.template(a("#verification").html()),events:{"change input":"onInputChange","click [data-action=cancel]":"onCancelClick"},onCancelClick:function(){this.dispose()},onInputChange:function(){if(this.$("[name=verification]").prop("checked")){this.trigger("verified")}},render:function(){this.$el.html(this.template());return this}});var E=d.extend({template:_.template(a("#identity").html()),className:"clearfix flex-mv10",render:function(){this.$el.html(this.template());this.$('[data-outlet="photo"]').append(this.addChildren(new P({model:this.model.photo})).render().el);this.addChildren(new K({el:this.$('[data-outlet="personal_info"]')[0],model:this.model,countries:this.options.countries})).render();return this}});var K=ax.extend({detailsView:function(){return new I({model:this.model})},editView:function(){return new J({model:this.model,countries:this.options.countries})}});var I=d.extend({template:_.template(a("#personal_info_details").html()),className:"flex-p10 flex-m0 clearfix",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var J=b.extend({template:_.template(a("#personal_info_edit").html()),className:"container-muted flex-p10 flex-m0 flex-relative clearfix flex-minheight200",onCountryChange:function(){b.prototype.onCountryChange.call(this);this.$('[data-outlet="legal_right"]').toggle(this.$('select[name="country.id"]').val()!="124")},onSaveSuccess:function(aO,aP){this.trigger("render-details")},formPreProcess:function(aO){aO.country={id:aO["country.id"]};delete aO["country.id"];aO.province={id:aO["province.id"]};delete aO["province.id"]},render:function(){if(this.renderState(this.options.countries.state)){return this}this.$el.html(this.template(this.model.toJSON()));this.renderCountries();this.bindSelect2();return this}});var k=ax.extend({className:"clearfix",detailsView:function(){return new h({model:this.model})},editView:function(){return new i({model:this.model,careerLevels:this.options.careerLevels})}});var h=d.extend({template:_.template(a("#career_level_details").html()),className:"clearfix",render:function(){this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));return this}});var i=b.extend({template:_.template(a("#career_level_edit").html()),className:"container-muted flex-p10 flex-mv10 clearfix flex-relative",initialize:function(aO){this.listenTo(aO.careerLevels.state,"change",this.render)},onSaveSuccess:function(aO,aP){this.trigger("render-details")},formPreProcess:function(aO){aO.careerLevel={id:aO["careerLevel.id"]};delete aO["careerLevel.id"]},renderCareerLevels:function(){var aP=this,aO=[];aO.push('<option value=""></option>');this.options.careerLevels.each(function(aQ){aO.push(String.format('<option value="{0}"{1}>{2}</option>',aQ.id,aP.model.get("careerLevel")&&aP.model.get("careerLevel").id==aQ.id?' selected="selected"':"",aQ.get("name")))});this.$('select[name="careerLevel.id"]').html(aO.join("")).change()},render:function(){if(this.renderState(this.options.careerLevels.state)){return this}this.$el.html(this.template({careerLevel:this.model.get("careerLevel")}));this.renderCareerLevels();this.bindSelect2();return this}});var Z=d.extend({className:"clearfix",template:_.template(a("#position_types_wrapper").html()),render:function(){this.$el.html(this.template());this.addChildren(new Y({el:this.$('[data-outlet="position_types"]')[0],model:this.model})).render();return this}});var Y=ax.extend({detailsView:function(){return new W({model:this.model})},editView:function(){return new X({model:this.model})}});var W=d.extend({template:_.template(a("#position_types_details").html()),className:"clearfix flex-relative",render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var X=b.extend({template:_.template(a("#position_types_edit").html()),className:"container-muted flex-p10 clearfix flex-relative",onSaveSuccess:function(aO,aP){this.trigger("render-details")},formPreProcess:function(aO){aO.positionTypes=aO.positionTypes?_.map(aO.positionTypes.split(","),function(aP){return{id:aP}}):[]},render:function(){this.$el.html(this.template({positionTypes:this.model.get("positionTypes")}));return this}});var ai=d.extend({events:{'click [data-action="add_new"]':"onAddNew"},onAddNew:function(){var aO=this.newModel();this.collection.add(aO);this.renderItem(aO)},renderItems:function(){var aO=this;this.collection.each(function(aP){aO.renderItem(aP)})},renderItem:function(aO){var aP=this.addChildren(this.newView(aO));this.$('[data-outlet="qualifications"]').append(aP.render().el);return aP},render:function(){this.$el.html(this.template());this.renderItems();return this}});var ap=ai.extend({className:"clearfix",newModel:function(){return new ak()},newView:function(aO){return new aq({model:aO})},template:_.template(a("#relocations").html())});var w=ai.extend({newModel:function(){return new r()},newView:function(aO){return new x({model:aO})},template:_.template(a("#educations").html())});var V=ai.extend({newModel:function(){return new Q()},newView:function(aO){return new aa({model:aO})},template:_.template(a("#positions").html())});var aD=ai.extend({newModel:function(){return new ay()},newView:function(aO){return new aE({model:aO})},template:_.template(a("#skills").html())});var aj=ax.extend({});var aq=aj.extend({detailsView:function(){return new al({model:this.model})},editView:function(){return new am({model:this.model})},removedView:function(){return new an({model:this.model})}});var x=aj.extend({detailsView:function(){return new s({model:this.model})},editView:function(){return new t({model:this.model})},removedView:function(){return new u({model:this.model})}});var aa=aj.extend({detailsView:function(){return new R({model:this.model})},editView:function(){return new S({model:this.model})},removedView:function(){return new T({model:this.model})}});var aE=aj.extend({detailsView:function(){return new az({model:this.model})},editView:function(){return new aA({model:this.model})},removedView:function(){return new aB({model:this.model})}});var af=d.extend({className:"flex-relative",events:{'click [data-action="remove"]':"delete"},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aO){this.trigger("render-deleted")},onDeleteError:function(aP,aO){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aO).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var al=af.extend({template:_.template(a("#relocation_details").html())});var s=af.extend({template:_.template(a("#education_details").html())});var R=af.extend({template:_.template(a("#position_details").html())});var az=af.extend({template:_.template(a("#skill_details").html()),className:"flex-relative flex-p5"});var ag=b.extend({className:"container-muted flex-p10 flex-mt5 flex-mb15 clearfix flex-relative",events:function(){return _.extend({},b.prototype.events,{'click [data-action="remove"]':"delete"})},onSaveSuccess:function(aO,aP){this.trigger("render-details")},"delete":function(){this.showSavingState();this.model["delete"]({success:_.bind(this.onDeleteSuccess,this),error:_.bind(this.onDeleteError,this)})},onDeleteSuccess:function(aO){this.trigger("render-deleted")},onDeleteError:function(aP,aO){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aO).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));if(this.model.isNew()){this.$el.addClass("new")}this.bindSelect2();return this}});var am=ag.extend({template:_.template(a("#relocation_edit").html()),render:function(){var aP=this;ag.prototype.render.call(this);var aO=function(){aP.$('input[name="description"]').jsonSuggest({url:aK.locations,textPropertyName:"description",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aO,10)}else{aO()}return this}});var t=ag.extend({template:_.template(a("#education_edit").html()),formPreProcess:function(aO){aO.degree={id:aO["degree.id"]};delete aO["degree.id"]}});var S=ag.extend({template:_.template(a("#position_edit").html()),events:function(){return _.extend({},ag.prototype.events(),{"change [name=isCurrent]":"onIsCurrentChange"})},onIsCurrentChange:function(aO){this.$('[data-outlet="end_date"]').fadeToggle("fast")},formPreProcess:function(aO){aO.start=aO.startMonth&&aO.startYear?aO.startYear+"-"+aO.startMonth+"-01":"";aO.end=aO.endMonth&&aO.endYear&&!aO.isCurrent?aO.endYear+"-"+aO.endMonth+"-01":"";delete aO.startMonth;delete aO.startYear;delete aO.endMonth;delete aO.endYear;delete aO.isCurrent}});var aA=ag.extend({template:_.template(a("#skill_edit").html()),formPreProcess:function(aO){aO.proficiency={id:aO["proficiency.id"]};aO.experience={id:aO["experience.id"]};delete aO["proficiency.id"];delete aO["experience.id"]},render:function(){var aP=this;ag.prototype.render.call(this);var aO=function(){aP.$('input[name="type"]').jsonSuggest({url:aK.skills,textPropertyName:"name",minCharacters:3})};if(!a.contains(document.documentElement,this.el)){setTimeout(aO,10)}else{aO()}return this}});var ah=d.extend({className:"flex-p10 flex-mv15 container-warning flex-relative",events:{'click [data-action="undo"]':"onUndoClick"},onUndoClick:function(){this.model.set("id",undefined);this.showSavingState();this.model.save(this.model.toJSON(),{success:_.bind(this.onUndoSuccess,this),error:_.bind(this.onUndoError,this)})},onUndoSuccess:function(aO,aP){this.trigger("render-details")},onUndoError:function(aP,aO){this.hideSavingState();this.$('[data-element="alert_danger_server"]').text(aO).show()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var an=ah.extend({template:_.template(a("#relocation_removed").html())});var u=ah.extend({template:_.template(a("#education_removed").html())});var T=ah.extend({template:_.template(a("#position_removed").html())});var aB=ah.extend({template:_.template(a("#skill_removed").html())});var A=d.extend({template:_.template(""),uploadingTemplate:_.template(a("#file_uploading").html()),progressTemplate:_.template(a("#file_progress").html()),errorTemplate:_.template(a("#file_error").html()),initialize:function(){this.fileUploadView=null;this.listenTo(this.model.file,"change:state",this.onStateChange);this.listenTo(this.model.file,"change:progress",this.onProgressChange);this.listenTo(this.model.file,"change:token",this.onTokenChange)},renderButton:function(){this.renderUploadButton();if(this.model.file.includeDropbox){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new q({model:this.model.file})).render().el)}if(this.model.file.includeWeb){this.$('[data-outlet="file_uploaders"]').append(this.addChildren(new aM({model:this.model.file})).render().el)}this.onStateChange(this.model.file,this.model.file.get("state"))},onSubmitFile:function(){this.$("form").submit()},showButton:function(){this.$('[data-element="upload_title"]').show();this.$('[data-outlet="file_uploaders"]').show();this.disposeChildren(this.fileUploadView);this.renderUploadButton()},renderUploadButton:function(){this.fileUploadView=this.addChildren(z.create({model:this.model.file,callback:this.$("input[name=callback]").val(),iframeId:this.$("iframe")[0].id}));this.fileUploadView.on("submit-file",this.onSubmitFile,this);this.$('[data-outlet="file_uploaders"]').prepend(this.fileUploadView.render().el)},hideButton:function(){this.$('[data-outlet="file_uploaders"]').hide();this.$('[data-element="upload_title"]').hide()},onStateChange:function(aO,aP){switch(aP){case"idle":return;case"uploading":this.$('[data-element="error_message"]').html("").hide();this.$('[data-element="upload_progress"]').html(this.uploadingTemplate(this.model.file.toJSON())).show();this.hideButton();return;case"uploaded":return;case"error":this.$('[data-element="error_message"]').html(this.errorTemplate(this.model.file.toJSON())).show();this.$('[data-element="upload_progress"]').html("").hide();this.showButton();return;default:throw new Error(String.format("State {0} not supported.",aP))}},onProgressChange:function(aO,aP){if(aP){this.$('[data-element="upload_progress"]').html(this.progressTemplate(this.model.file.toJSON())).show()}},onTokenChange:function(){if(!this.model.file.get("token")){return}this.model.replace({success:_.bind(this.onSaveSuccess,this),error:_.bind(this.onSaveError,this)})},onSaveSuccess:function(aO,aP){},onSaveError:function(aP,aO){this.model.file.setError(aO)},render:function(){this.$el.html(this.template(this.model.file));this.renderButton();return this}});var P=d.extend({template:_.template(a("#photo").html()),initialize:function(){this.listenTo(this.model,"change:photoUrl",this.onPhotoUrlChange)},onPhotoUrlChange:function(){this.disposeAllChildren();this.render()},events:{'click [data-action="replace"]':"onReplaceClick",'click [data-action="remove"]':"onDeleteClick","click [data-action=undo]":"onUndoClick"},onReplaceClick:function(){this.model.file.setIdle();this.$el.append(this.addChildren(new M({model:this.model})).render().el)},onDeleteClick:function(){this.showSavingState();this.model["delete"]({error:_.bind(this.onError,this)})},onUndoClick:function(){this.showSavingState();this.model.undo({error:_.bind(this.onError,this)})},onError:function(aP,aO){this.hideSavingState()},render:function(){this.$el.html(this.template(this.model));return this}});var M=A.extend({template:_.template(a("#photo_edit").html()),events:{'click [data-action="cancel"]':"onCancelClick"},onCancelClick:function(){this.dispose()}});var aw=d.extend({initialize:function(){this.content=null},renderDetails:function(){this.disposeChildren(this.content);this.content=this.addChildren(new at({model:this.model}));this.content.on("edit",this.renderEdit,this);this.$el.append(this.content.render().el)},renderEdit:function(){this.disposeChildren(this.content);this.content=this.addChildren(new au({model:this.model}));this.content.on("render-details",this.renderDetails,this);this.$el.append(this.content.render().el)},render:function(){if(this.model.get("url")){this.renderDetails()}else{this.renderEdit()}return this}});var at=d.extend({template:_.template(a("#resume_details").html()),events:{'click [data-action="replace"]':"onReplaceClick"},onReplaceClick:function(){this.trigger("edit")},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var au=A.extend({template:_.template(a("#resume_edit").html()),onSaveSuccess:function(aO,aP){this.trigger("render-details")}});a.ajaxSetup({statusCode:{}});a.ajaxPrefilter(function(aP,aQ,aO){aP.statusCode=_.extend(aP.statusCode||{},{401:function(aS,aT,aR){window.location.reload(true)}})});return{init:function(aR){p=aR.dropboxAppKey;aK(aR.restPath);var aQ=new G({id:aR.jobseekerId});var aP=new n();var aO=new g();var aS=new H({model:aQ,countries:aP.getCountries(),careerLevels:aO.getCareerLevels(),requireVerification:aR.requireVerification,enabled:aR.enabled});a('[data-outlet="container"]').append(aS.render().el);aQ.fetch()}}}(jQuery));