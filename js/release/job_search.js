var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobSearch=(function(a){var s;var Y={jobs:"/api/v1.1/public/jobs",jobCategories:"/api/v1.1/jobcategories",careerLevels:"/api/v1.1/careerlevels",memberStatuses:"/api/v1.1/memberstatuses",locations:"/api/v1.1/locations?pageSize=5&types=town%2Cprovince%2Cterritory",log:"/api/v1.1/public/jobs/log",jobAlerts:"/api/v1.1/jobalerts/fromjobsearch"};var X=Backbone.Model.extend({defaults:{ready:false,error:null}});var b=Backbone.Model.extend({});var G=Backbone.Model.extend({defaults:{page:1,q:"",location:"",range:0,freshness:0,categoryIds:"",careerLevelIds:"",memberStatusIds:"",featuredEmployersOnly:false,trainingPositionsOnly:false,positionTypeIds:"",employerTypeIds:""},getCategoryIds:function(){return this.getIds("categoryIds")},getCareerLevelIds:function(){return this.getIds("careerLevelIds")},getMemberStatusIds:function(){return this.getIds("memberStatusIds")},getPositionTypeIds:function(){return this.getIds("positionTypeIds")},getEmployerTypeIds:function(){return this.getIds("employerTypeIds")},getIds:function(Z){if(!this.get(Z).toString().length){return[]}return this.get(Z).toString().split(",")},toQueryString:function(){var Z=this.toJSON();var aa={};for(var ab in Z){if(Z.hasOwnProperty(ab)){if(Z[ab]){aa[ab]=Z[ab]}}}return a.param(aa)},toFullQueryString:function(){return a.param(this.toJSON())},jobAlertsUrl:function(Z){return Y.jobAlerts+"?email="+Z+"&"+this.toQueryString()},subscribeJobAlert:function(Z,aa){aa||(aa={});var ab=this;a.ajax({url:this.jobAlertsUrl(Z),dataType:"json",cache:false,type:"POST",success:function(ad,ae,ac){if(aa.success){aa.success(ab,ad)}},error:function(ad,af,ac){if(ad.status===400){var ae=JSON.parse(ad.responseText);if(aa.error){aa.error(ab,[ae.message]);return}}if(aa.error){aa.error(ab,["Error connecting to the server."])}}})}});var d=Backbone.Model.extend({defaults:{value:""}});var A=Backbone.Model.extend({defaults:{page:1,pageSize:20,total:0},pages:function(){return Math.ceil(this.get("total")/this.get("pageSize"))},prev:function(){if(this.get("page")>1){return this.get("page")-1}else{return null}},next:function(){if(this.get("page")<this.pages()){return this.get("page")+1}else{null}},toJSON:function(aa){var Z=Backbone.Model.prototype.toJSON.call(this,aa);Z.pages=this.pages();Z.prev=this.prev();Z.next=this.next();return Z}});var x=function(Z,aa){Backbone.Collection.apply(this,[Z,aa]);aa||(aa={});this.pagination=new A(aa.pagination||{});this.attribution=new d(aa.attribution||{});this.state=new X()};_.extend(x.prototype,Backbone.Collection.prototype,{to:function(aa,Z){this.pagination.set("page",aa);this.fetch(Z)},url:function(){return""},fetch:function(Z){var aa=this;Z||(Z={});this.state.set({ready:false,error:null});if(this.$ajax){this.$ajax.abort()}this.$ajax=a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(ac,ad,ab){aa.state.set({ready:true,error:null});aa.pagination.set({page:ac.paging.page,pageSize:ac.paging.pageSize,total:ac.paging.total});aa.attribution.set("value",ac.attribution);aa.reset(aa.parse(ac.data),Z);if(Z.success){Z.success(aa,ac)}},error:function(ad,ae,ac){if(ad.statusText==="abort"){return}var ab=ad.status===400?JSON.parse(ad.responseText).message:String.format("Error retrieving {0} list.",aa.modelDescription);aa.state.set({error:ab});if(Z.error){Z.error(aa,[ab])}}})}});x.extend=Backbone.Collection.extend;var i=Backbone.Model.extend({});var r=x.extend({model:i,modelDescription:"job",initialize:function(Z,aa){this.timer=null;this.search=aa.search;this.listenTo(this.search,"change",this.onSearchChange)},to:function(aa,Z){this.pagination.set("page",aa);this.search.set("page",aa,_.extend({immediate:true,pageChange:true},Z))},url:function(){return Y.jobs+"?"+this.search.toQueryString()},onSearchChange:function(Z,aa){clearTimeout(this.timer);this.pagination.set("page",this.search.get("page"));if(aa.immediate){this.fetch(aa)}else{this.timer=setTimeout(_.bind(this.fetch,this,aa),500)}}});var t=Backbone.Model.extend({});var u=Backbone.Collection.extend({model:t,initialize:function(){this.state=new X()},fetch:function(Z){var aa=this;Z||(Z={});this.state.set({ready:false,error:null});a.ajax({url:this.url(),dataType:"json",cache:true,type:"GET",success:function(ac,ad,ab){aa.reset(ac.data);aa.state.set({ready:true,error:null});if(Z.success){Z.success(aa,ac)}},error:function(ac,ad,ab){aa.state.set({error:"Error retrieving "+aa.description+" list."});if(Z.error){Z.error(aa,["Error retrieving "+aa.description+" list."])}}})}});var k=t.extend({});var j=u.extend({model:k,description:"Business Sector",url:function(){return Y.jobCategories}});var g=t.extend({});var h=u.extend({model:g,description:"Career Level",url:function(){return Y.careerLevels}});var v=t.extend({});var w=u.extend({model:v,description:"Member Status",url:function(){return Y.memberStatuses}});var f=function(Z){this.parent=null;this.children=[];Backbone.View.apply(this,[Z])};_.extend(f.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error_template").html()),loaderClass:"flex-loader-mini",renderState:function(Z){if(Z.get("error")){a(this.el).html(this.errorTemplate({error:Z.get("error")}));return true}if(!Z.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(Z){var aa=document.createElement("div");aa.className=this.loaderClass;a(Z).empty().append(aa)},addChildren:function(Z){var aa,ab=this;if(_.isArray(Z)){aa=Z}else{aa=_.toArray(arguments)}_.each(aa,function(ac){ab.children.push(ac);ac.parent=ab});if(aa.length===1){return aa[0]}else{return aa}},disposeChildren:function(Z){if(!Z){return}var ab=this;var aa=_.isArray(Z)?Z:_.toArray(arguments);_.each(aa,function(ac){ac.dispose()})},disposeAllChildren:function(){var Z=this.children.slice(0);_.each(Z,function(aa){aa.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(Z){var aa=_.indexOf(this.children,Z);if(aa!==-1){this.children.splice(aa,1)}}});f.extend=Backbone.View.extend;var y=f.extend({className:"overlay overlay-white overlay-absolute",events:{click:"onClick"},onClick:function(){this.trigger("clicked")},render:function(){this.$el.fadeIn();return this},dispose:function(){var Z=this;this.$el.fadeOut(function(){f.prototype.dispose.apply(Z)})}});var c=f.extend({tagName:"ins",className:"adsbygoogle",render:function(){this.$el.css({display:this.model.get("display"),height:this.model.get("height")+"px"}).attr({"data-ad-client":this.model.get("adClient"),"data-ad-slot":this.model.get("adSlot"),"data-format":this.model.get("format")});if(this.model.get("width")){this.$el.css("width",this.model.get("width")+"px")}return this}});var z=f.extend({el:a("#page")[0],initialize:function(){this.pageUnderlayView=null},initializeMap:function(){if(this.searchBoxView){this.searchBoxView.initializeMap()}},render:function(){this.searchBoxView=this.addChildren(T.create({el:a("#search_box")[0],type:this.type,search:this.options.search,enabled:this.options.enabled,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.searchBoxView.render();return this}});var U=z.extend({type:"search_jobs",onRefineSearch:function(){this.$('[data-element="sidebar_filter"]').animate({left:"50%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=new y();this.pageUnderlayView.on("clicked",this.onRefineSearchEnd,this);a("body").append(this.pageUnderlayView.render().el)},onRefineSearchEnd:function(){this.$('[data-element="sidebar_filter"]').animate({left:"-100%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=null},renderAds:function(){var Z=0;var ae=window.innerWidth||document.documentElement.clientWidth;if(ae>949&&this.options.ads.left){var ac=new c({model:new b(this.options.ads.left)});this.$('[data-outlet="left_ad"]').append(ac.render().el);Z++}if(ae>600&&this.options.ads.right){var ad=new c({model:new b(this.options.ads.right)});this.$('[data-outlet="right_ad"]').append(ad.render().el);Z++}if(this.options.ads.bottom){var aa=new c({model:new b(this.options.ads.bottom)});this.$('[data-outlet="leaderboard"]').append(aa.render().el);Z++}for(var ab=0;ab<Z;ab++){(adsbygoogle=window.adsbygoogle||[]).push({})}},render:function(){z.prototype.render.call(this);this.searchBoxView.on("refine-search-end",this.onRefineSearchEnd,this);var Z=this.addChildren(new q({el:a("#joblist")[0],jobs:this.options.jobs,jobUrlFormatOverride:this.options.jobUrlFormatOverride}));Z.on("refine-search",this.onRefineSearch,this);Z.render();this.renderAds();return this}});var D=z.extend({type:"saved_search"});var T=f.extend({template:_.template(a("#search_box_template").html()),initializeMap:function(){if(this.locationView){this.locationView.initializeMap()}}},{create:function(Z){switch(Z.type){case"search_jobs":return new W(Z);break;case"saved_search":return new F(Z);break;default:throw new Error("type not supported.")}}});var W=T.extend({initialize:function(Z){this.listenTo(Z.search,"change",this.onSearchChange)},events:{'click [data-action="show_advanced"]':"onShowAdvancedClick",'click [data-action="search"]':"onSearchClick"},onShowAdvancedClick:function(Z){this.$('[data-action="show_advanced"]').slideUp();this.$('[data-action="search"].first').slideUp();this.$("[data-section=advanced]").slideDown()},onSearchClick:function(){this.trigger("refine-search-end")},onSearchChange:function(){this.setAdvancedOptionsVisibility()},setAdvancedOptionsVisibility:function(){if(this.options.search.get("categoryIds")||this.options.search.get("employerTypeIds")||this.options.search.get("positionTypeIds")){this.$('[data-action="show_advanced"]').hide();this.$("[data-section=advanced]").show()}},render:function(){this.$el.html(this.template());var ae=this.addChildren(new N({model:this.options.search}));this.$("[data-section=basic]").append(ae.render().el);var ac=this.addChildren(new L({model:this.options.search}));this.$("[data-section=basic]").append(ac.render().el);if(this.options.enabled.memberStatusIds){var af=this.addChildren(new Q({model:this.options.search}));this.$("[data-section=basic]").append(af.render().el)}this.locationView=this.addChildren(new P({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var aa=this.addChildren(new I({model:this.options.search}));this.$("[data-section=advanced]").append(aa.render().el);if(this.options.enabled.careerLevelIds){var Z=this.addChildren(new H({model:this.options.search}));this.$("[data-section=advanced]").append(Z.render().el)}var ab=this.addChildren(new K({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(ab.render().el);var ad=this.addChildren(new M({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(ad.render().el);this.$("[data-section=advanced]").append('<div class="clearfix flex-mt15"><div data-action="search" class="search-jobs-widget-anchor btn btn-default pull-right">Search</div></div>');this.setAdvancedOptionsVisibility();return this}});var F=T.extend({setAdvancedOptionsVisibility:function(){this.$('[data-action="show_advanced"]').hide()},render:function(){this.$el.html(this.template());var ah=this.addChildren(new R({model:this.options.search}));this.$("[data-section=basic]").append(ah.render().el);var af=this.addChildren(new N({model:this.options.search}));this.$("[data-section=basic]").append(af.render().el);var ad=this.addChildren(new L({model:this.options.search}));this.$("[data-section=basic]").append(ad.render().el);if(this.options.enabled.memberStatusIds){var ag=this.addChildren(new Q({model:this.options.search}));this.$("[data-section=basic]").append(ag.render().el)}this.locationView=this.addChildren(new P({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var aa=this.addChildren(new I({model:this.options.search}));this.$("[data-section=basic]").append(aa.render().el);if(this.options.enabled.careerLevelIds){var Z=this.addChildren(new H({model:this.options.search}));this.$("[data-section=basic]").append(Z.render().el)}var ac=this.addChildren(new K({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(ac.render().el);var ae=this.addChildren(new M({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(ae.render().el);var ab=this.addChildren(new J({model:this.options.search}));this.$("[data-section=basic]").append(ab.render().el);var ai=this.addChildren(new S({model:this.options.search}));this.$("[data-section=basic]").append(ai.render().el);this.setAdvancedOptionsVisibility();return this}});var R=f.extend({template:_.template(a("#search_box_name_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:name",this.onModelChange)},events:{"keyup input":"onInputChange"},onInputChange:function(Z){this.model.set({name:a(Z.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var N=f.extend({template:_.template(a("#search_box_keywords_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:q",this.onModelChange)},events:{"keyup input":"onInputChange","search input":"onInputChange","webkitspeechchange input":"onInputChange"},onInputChange:function(Z){this.model.set({q:a(Z.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var L=f.extend({template:_.template(a("#search_box_freshness_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:freshness",this.onModelChange)},events:{"change select[name=freshness]":"onFreshnessChange"},onFreshnessChange:function(Z){this.model.set({freshness:parseInt(a(Z.currentTarget).val(),10),page:1},{source:this,immediate:true})},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.setSelection()},setSelection:function(){this.$("select[name=freshness]").select2("val",this.model.get("freshness"))},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("select").select2({containerCssClass:"freshness",dropdownCssClass:"freshness-dropdown"});this.setSelection();return this}});var P=f.extend({template:_.template(a("#search_box_location_template").html()),className:"flex-mb5",initialize:function(){this.map=null;this.mapLocation=null;this.circle=null;this.listenTo(this.model,"change:location",this.onModelChange);this.listenTo(this.model,"change:range",this.onModelChange)},events:{"change input[type=text]":"onInputTextChange","change select[name=range]":"onRangeChange"},onInputTextChange:function(Z){this.$("[data-info=location_search_error]").hide();var aa=a(Z.currentTarget).val().trim()?10:0;this.model.set({location:a(Z.currentTarget).val().trim(),range:aa,page:1},{source:this,immediate:true});this.setSelectStates();if(this.map){this.setMapLocation()}},onRangeChange:function(Z){this.model.set({range:parseInt(a(Z.currentTarget).val(),10),page:1},{source:this,immediate:true});this.renderCircle()},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.setSelectStates();if(this.map){this.setMapLocation()}},setMapLocation:function(){var ab=this;if(!this.model.get("location")){this.map.setCenter(new google.maps.LatLng(this.options.defaultLocation.latitude,this.options.defaultLocation.longitude));this.map.setZoom(this.options.defaultLocation.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var aa=this.options.provinces[this.model.get("location")];if(aa){this.map.setCenter(new google.maps.LatLng(aa.latitude,aa.longitude));this.map.setZoom(aa.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var Z=new google.maps.Geocoder();Z.geocode({address:this.model.get("location").trim(),region:"CA"},function(ac,ad){if(ad===google.maps.GeocoderStatus.ZERO_RESULTS){ab.$("[data-info=location_search_error]").text("Location not found.").show();return}if(ad!==google.maps.GeocoderStatus.OK){ab.$("[data-info=location_search_error]").text("Location search error.").show();return}ab.$("[data-info=location_search_error]").hide();ab.mapLocation={latitude:ac[0].geometry.location.lat(),longitude:ac[0].geometry.location.lng()};ab.map.fitBounds(ac[0].geometry.viewport);ab.renderCircle()})},renderCircle:function(){if(!this.map){return}if(this.circle){this.circle.setCenter(new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude));this.circle.setRadius(this.model.get("range")*1000)}else{this.circle=polygon=new google.maps.Circle({center:new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude),radius:this.model.get("range")*1000,strokeColor:"#3a9de2",strokeOpacity:0.8,strokeWeight:2,fillColor:"#3a9de2",fillOpacity:0.3,map:this.map})}this.map.fitBounds(this.circle.getBounds())},setSelectStates:function(){this.$("input[type=text]").select2("val",this.model.get("location"));this.$("select[name=range]").select2("val",this.model.get("range"));this.$(".range").toggle(!!this.model.get("location")&&!this.options.provinces[this.model.get("location")])},initializeMap:function(){this.map=new google.maps.Map(this.$('[data-outlet="map"]')[0],{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,draggable:false,disableDoubleClickZoom:true,scrollwheel:false});this.setMapLocation()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("input[type=text]").select2({minimumInputLength:3,allowClear:true,ajax:{url:Y.locations,dataType:"json",data:function(aa,Z){return{q:aa}},results:function(aa,Z){return{results:aa.data}}},initSelection:function(Z,aa){a.ajax({url:"/api/v1.1/locations?pageSize=1&types=town%2Cprovince%2Cterritory",data:{q:Z.val()},dataType:"json",type:"GET",success:function(ac,ad,ab){if(ac.data.length){aa(ac.data[0])}}})},id:function(Z){if(Z){return Z.description}else{return null}},formatResult:function(Z){return Z.description},formatSelection:function(Z){return Z.description}});this.$("select").select2({containerCssClass:"range",dropdownCssClass:"range-dropdown"});this.setSelectStates();return this}});var O=f.extend({className:"flex-mb5",initialize:function(){this.select2Rendered=false;this.collection=new this.collectionType();this.collection.fetch();this.listenTo(this.collection.state,"change",this.renderSelect);this.listenTo(this.model,"change:"+this.property,this.onModelChange)},events:{"change select":"onSelectChange","click [data-action=try_again]":"onTryAgainClick"},onSelectChange:function(aa){var Z={};Z[this.property]=aa.val.join(",");Z.page=1;this.model.set(Z,{source:this,immediate:true})},onModelChange:function(Z,ab,aa){if(aa.source===this||!this.select2Rendered){return}this.$("select").select2("val",this.model.getIds(this.property))},onTryAgainClick:function(Z){this.collection.fetch()},renderState:function(Z){if(Z.get("error")){this.$("[data-outlet]").html(this.errorTemplate({error:Z.get("error")}));return true}if(!Z.get("ready")){this.renderLoader(this.$("[data-outlet]")[0]);return true}return false},renderSelect:function(){if(this.renderState(this.collection.state)){return this}var aa=this,Z=[];Z.push('<select name="'+this.property+'" multiple="multiple" style="width:100%;"><option value=""></option>');this.collection.each(function(ab){Z.push(String.format('<option value="{0}"{1}>{2}</option>',ab.id,_.any(aa.model.getIds(aa.property),function(ac){return ac==ab.id})?' selected="selected"':"",ab.escape("name")))});Z.push("</select>");this.$("[data-outlet]").html(Z.join(""));this.$("select").select2({placeholder:this.placeholder(),allowClear:true});this.select2Rendered=true},render:function(){this.$el.html(this.template());this.renderSelect();return this}});var I=O.extend({template:_.template(a("#search_box_categories_template").html()),collectionType:j,property:"categoryIds",placeholder:function(){return"All "+s.jobCategories}});var H=O.extend({template:_.template(a("#search_box_careerLevels_template").html()),collectionType:h,property:"careerLevelIds",placeholder:function(){return"All Career Levels"}});var Q=O.extend({template:_.template(a("#search_box_memberstatuses_template").html()),collectionType:w,property:"memberStatusIds",placeholder:function(){return"All CPA Statuses"}});var K=f.extend({template:_.template(a("#search_box_employertype_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:employerTypeIds",this.onModelChange);this.listenTo(this.model,"change:featuredEmployersOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.setSelection();this.setFeaturedSelection()},onInputChange:function(){var Z=this.$("input[name=employerTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({employerTypeIds:Z.length===this.$("input[name=employerTypeIds][type=checkbox]").length?"":Z.join(","),featuredEmployersOnly:this.$("input[name=featuredEmployersOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var Z=this;if(!this.model.getEmployerTypeIds().length){this.$("input[name=employerTypeIds]").prop("checked",true);return}this.$("input[name=employerTypeIds]").each(function(){a(this).prop("checked",_.contains(Z.model.getEmployerTypeIds(),a(this).val()))})},setFeaturedSelection:function(){this.$("[name=featuredEmployersOnly]").prop("checked",this.model.get("featuredEmployersOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setFeaturedSelection();return this}});var M=f.extend({template:_.template(a("#search_box_jobtype_template").html()),className:"flex-mb5  text-center",initialize:function(){this.listenTo(this.model,"change:positionTypeIds",this.onModelChange);this.listenTo(this.model,"change:trainingPositionsOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.setSelection();this.setTrainingPositionSelection()},onInputChange:function(){var Z=this.$("input[name=positionTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({positionTypeIds:Z.length===this.$("input[name=positionTypeIds][type=checkbox]").length?"":Z.join(","),trainingPositionsOnly:this.$("input[name=trainingPositionsOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var Z=this;if(!this.model.getPositionTypeIds().length){this.$("input[name=positionTypeIds]").prop("checked",true);return}this.$("input[name=positionTypeIds]").each(function(){a(this).prop("checked",_.contains(Z.model.getPositionTypeIds(),a(this).val()))})},setTrainingPositionSelection:function(){this.$("[name=trainingPositionsOnly]").prop("checked",this.model.get("trainingPositionsOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setTrainingPositionSelection();return this}});var J=f.extend({template:_.template(a("#search_box_emailfrequency_template").html()),className:"flex-mb5 flex-w100 text-center",initialize:function(){this.listenTo(this.model,"change:emailFrequencyId",this.onModelChange)},events:{"change input[name=emailFrequencyId]":"onInputChange"},onModelChange:function(Z,ab,aa){if(aa.source===this){return}this.setSelection()},onInputChange:function(){this.model.set({emailFrequency:this.$("input[name=emailFrequencyId]:checked").val(),page:1},{source:this,immediate:true})},setSelection:function(){this.$("input[name=emailFrequencyId]").filter("[value="+this.model.get("emailFrequencyId")+"]").prop("checked",true)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.setSelection();return this}});var S=f.extend({template:_.template(a("#search_box_submitbutton_template").html()),className:"flex-p10 flex-mt30 text-center flex-clear",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var q=f.extend({initialize:function(){},onPageChanged:function(){var Z=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;if(Z>this.$el.offset().top){window.scrollTo(0,this.$el.offset().top)}},onRefineSearch:function(){this.trigger("refine-search")},render:function(){var ac=this.addChildren(new o({el:a("#joblist_header"),jobs:this.options.jobs}));ac.on("refine-search",this.onRefineSearch,this);ac.render();var aa=this.addChildren(new l({el:a("#joblist-body-content"),jobs:this.options.jobs,jobUrlFormatOverride:this.options.jobUrlFormatOverride}));aa.render();var ab=this.addChildren(new n({el:a("#joblist_footer"),jobs:this.options.jobs}));ab.on("page-changed",this.onPageChanged,this);ab.render();var Z=this.addChildren(new e({el:a("#joblist_attribution"),model:this.options.jobs.attribution}));Z.render();return this}});var o=f.extend({initialize:function(Z){this.listenTo(this.options.jobs,"reset",this.renderTitle)},events:{'click [data-action="refine_search"]':"onRefineSearchClick"},onRefineSearchClick:function(){this.trigger("refine-search")},renderTitle:function(){this.$('[data-outlet="total"]').html(this.options.jobs.pagination.get("total"));this.$('[data-element="title"]').remove()}});var l=f.extend({emptyTemplate:_.template(a("#empty-joblist-template").html()),initialize:function(Z){this.listenTo(Z.jobs.state,"change",this.renderState);this.listenTo(Z.jobs,"reset",this.renderJobs);this.jobViews=null},events:{"click [data-action=try_again]":"onTryAgainClick"},onTryAgainClick:function(Z){this.options.jobs.fetch()},renderJobs:function(){if(this.renderState(this.options.jobs.state)){return this}this.disposeChildren(this.jobViews);this.$el.empty();if(this.options.jobs.length===0){this.$el.html(this.emptyTemplate());return}var aa=this,Z=[];this.jobViews=[];this.options.jobs.each(function(ac,ab){var ad=ab%2==0?"even":"odd";var ae=new p({model:ac,className:"list-item-wrapper clearfix "+ad,attributes:{href:!!aa.options.jobUrlFormatOverride?aa.options.jobUrlFormatOverride.replace("{0}",ac.id):ac.get("url")}});aa.jobViews.push(ae.render());Z.push(ae.el)});this.addChildren(this.jobViews);this.$el.empty().append(Z)},renderState:function(Z){if(Z.get("error")){a(this.el).html(this.errorTemplate({error:Z.get("error")}));return true}if(!Z.get("ready")){if(this.$(".overlay").length<1){a('<div class="overlay overlay-white overlay-absolute"></div>').appendTo(this.$el)}return true}return false},render:function(){return this}});var p=f.extend({template:_.template(a("#joblist_item_template").html()),tagName:"a",events:{click:"onClick"},onClick:function(Z){B.changeRoute({replace:false})},target:function(){if(/^http(s)?:\/\//i.test(this.model.get("url"))){return"_blank"}else{return"_self"}},rel:function(){if(/^http(s)?:\/\//i.test(this.model.get("url"))){return"nofollow"}else{return null}},render:function(){this.$el.attr({title:this.model.get("title"),target:this.target(),rel:this.rel(),onmousedown:this.model.get("onmousedown")}).html(this.template(this.model.toJSON()));return this}});var n=f.extend({template:_.template(a("#joblist_footer_template").html()),subscribedTemplate:_.template(a("#joblist_footer_subscribed_template").html()),initialize:function(Z){this.listenTo(Z.jobs.pagination,"change",this.renderPagination);this.listenTo(Z.jobs.search,"change:page",this.renderPagination)},events:{"click [data-page]":"onPageClick","click [data-action=email]":"onEmailClick"},onEmailClick:function(Z){this.renderSubscribe()},renderSubscribe:function(){var Z=new m({search:this.options.jobs.search});Z.on("subscribe-success",this.renderSubscribed,this);this.$('[data-outlet="subscription"]').empty().append(Z.render().el)},renderSubscribed:function(){this.$('[data-outlet="subscription"]').html(this.subscribedTemplate())},onPageClick:function(Z){var aa=this;Z.preventDefault();this.options.jobs.to(a(Z.currentTarget).data("page"),{success:function(){aa.trigger("page-changed")},error:function(){aa.trigger("page-changed")}})},renderPagination:function(){a(this.el).show().empty().html(this.template({pagination:this.options.jobs.pagination.toJSON(),queryString:_.filter(this.options.jobs.search.toQueryString().split("&"),function(aa){var Z=aa.split("=");return Z[0]!="page"}).join("&"),showEmailButton:this.options.jobs.search.get("q")||this.options.jobs.search.getCategoryIds().length}));return this}});var m=f.extend({template:_.template(a("#joblist_footer_subscribe_template").html()),tagName:"form",events:{submit:"onSubmit"},onSubmit:function(Z){Z.preventDefault();var ab=this;var aa=this.$("[name=email]").val();if(!this.isEmailValid(aa)){this.showError("Email is invalid.");this.$("input").first().focus();return}this.showLoader();this.options.search.subscribeJobAlert(aa,{success:function(ad,ac){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobAlertSubscribe",eventLabel:"Source:JobSearch",nonInteraction:false});ab.trigger("subscribe-success")},error:function(ad,ac){ab.showError(ac[0])}})},showError:function(Z){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text(Z).show();this.$('[data-element="subscribe_loader"]').hide()},showLoader:function(){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text("").hide();this.$('[data-element="subscribe_loader"]').show()},isEmailValid:function(Z){return/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/.test(Z)},render:function(){var aa=this;this.$el.html(this.template());var Z=function(){aa.$("input").first().focus()};if(!a.contains(document.documentElement,this.el)){setTimeout(Z,10)}else{Z()}return this}});var e=f.extend({template:_.template(a("#joblist_attribution_template").html()),initialize:function(){this.listenTo(this.model,"change:value",this.render)},render:function(){a(this.el).html(this.template(this.model.toJSON()));return this}});var B;var C=Backbone.Router.extend({initialize:function(Z){this.timer=null;this.initialQuery=Z.query;this.enabled=Z.enabled;this.defaultLocation=Z.defaultLocation;this.provinces=Z.provinces;this.search=new G(Z.query)},initializeMap:function(){this.pageView.initializeMap()},routes:{"*queryString":"queryString"},queryString:function(aa){var Z=aa?this.parse(aa):this.initialQuery;this.search.set(Z,{source:this,immediate:true})},parse:function(aa){var Z={};if(aa){_.each(_.map(aa.split(/&/g),function(ac,ad){var ab=ac.split("="),ae={};if(ab.length>=1){var af=undefined;if(ab.length==2){http:af=decodeURIComponent(ab[1].replace(/\+/g,"%20"))}if(/^-?[\d\.]+$/g.test(af)){af=af*1}else{if(/^((true)|(false))$/g.test(af)){if(af==="true"){af=true}else{af=false}}}ae[ab[0]]=af}return ae}),function(ab){_.extend(Z,ab)})}return Z},changeRoute:function(Z){}});var V=C.extend({initialize:function(Z){C.prototype.initialize.call(this,Z);this.listenTo(this.search,"change",this.onSearchChange);this.jobs=new r(Z.jobs.data,{pagination:_.pick(Z.jobs.paging,"page","pageSize","total"),search:this.search,attribution:{value:decodeURIComponent(Z.attribution)}});this.jobs.state.set({ready:true,error:null});this.pageView=new U({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces,jobs:this.jobs,ads:Z.ads,jobUrlFormatOverride:Z.jobUrlFormatOverride});this.pageView.render()},changeRoute:function(Z){if(Backbone.history.fragment==this.search.toFullQueryString()){return}Z=_.extend({trigger:false,replace:false},Z);this.navigate(this.search.toFullQueryString(),Z);new Image().src=Y.log+"?"+this.search.toQueryString()},onSearchChange:function(Z,aa){if(aa.source===this){return}clearInterval(this.timer);if(aa.pageChange){this.changeRoute({replace:false})}else{this.timer=setTimeout(_.bind(this.changeRoute,this,{replace:false}),4000)}}});var E=C.extend({initialize:function(Z){C.prototype.initialize.call(this,Z);this.pageView=new D({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces});this.pageView.render()}});window.initializeMap=function(){B.initializeMap()};return{init:function(Z){s=Z.labels;switch(Z.type){case"search_jobs":B=new V(Z);break;case"saved_search":B=new E(Z);break;default:throw Error("options.type not supported.")}Backbone.history.start();var aa=document.createElement("script");aa.type="text/javascript";aa.src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyA7GqDK9GlTQJQc-WqPi-HHJ45vAtHgXAI&region=CA&callback=initializeMap";document.body.appendChild(aa)}}}(jQuery));