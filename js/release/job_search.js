var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobSearch=(function(a){var B,s;var Z=function(aa){Z={jobs:aa+"public/jobs",jobCategories:"/api/v1.0/jobcategories",careerLevels:"/api/v1.0/careerlevels",memberStatuses:"/api/v1.0/memberstatuses",locations:aa+"locations?pageSize=5&types=town%2Cprovince%2Cterritory",log:aa+"public/jobs/log",jobAlerts:"/api/v1.0/jobalerts/fromjobsearch"}};var Y=Backbone.Model.extend({defaults:{ready:false,error:null}});var b=Backbone.Model.extend({});var H=Backbone.Model.extend({defaults:{page:1,q:"",location:"",range:0,freshness:0,categoryIds:"",careerLevelIds:"",memberStatusIds:"",featuredEmployersOnly:false,trainingPositionsOnly:false,positionTypeIds:"",employerTypeIds:""},getCategoryIds:function(){return this.getIds("categoryIds")},getCareerLevelIds:function(){return this.getIds("careerLevelIds")},getMemberStatusIds:function(){return this.getIds("memberStatusIds")},getPositionTypeIds:function(){return this.getIds("positionTypeIds")},getEmployerTypeIds:function(){return this.getIds("employerTypeIds")},getIds:function(aa){if(!this.get(aa).toString().length){return[]}return this.get(aa).toString().split(",")},toQueryString:function(){var aa=this.toJSON();var ab={};for(var ac in aa){if(aa.hasOwnProperty(ac)){if(aa[ac]){ab[ac]=aa[ac]}}}return a.param(ab)},toFullQueryString:function(){return a.param(this.toJSON())},jobAlertsUrl:function(aa){return Z.jobAlerts+"?email="+aa+"&"+this.toQueryString()},subscribeJobAlert:function(aa,ab){ab||(ab={});var ac=this;a.ajax({url:this.jobAlertsUrl(aa),dataType:"json",cache:false,type:"POST",success:function(ae,af,ad){if(ab.success){ab.success(ac,ae)}},error:function(ae,ag,ad){if(ae.status===400){var af=JSON.parse(ae.responseText);if(ab.error){ab.error(ac,[af.message]);return}}if(ab.error){ab.error(ac,["Error connecting to the server."])}}})}});var d=Backbone.Model.extend({defaults:{value:""}});var A=Backbone.Model.extend({defaults:{page:1,pageSize:20,total:0},pages:function(){return Math.ceil(this.get("total")/this.get("pageSize"))},prev:function(){if(this.get("page")>1){return this.get("page")-1}else{return null}},next:function(){if(this.get("page")<this.pages()){return this.get("page")+1}else{null}},toJSON:function(ab){var aa=Backbone.Model.prototype.toJSON.call(this,ab);aa.pages=this.pages();aa.prev=this.prev();aa.next=this.next();return aa}});var x=function(aa,ab){Backbone.Collection.apply(this,[aa,ab]);ab||(ab={});this.pagination=new A(ab.pagination||{});this.attribution=new d(ab.attribution||{});this.state=new Y()};_.extend(x.prototype,Backbone.Collection.prototype,{to:function(ab,aa){this.pagination.set("page",ab);this.fetch(aa)},url:function(){return""},fetch:function(aa){var ab=this;aa||(aa={});this.state.set({ready:false,error:null});if(this.$ajax){this.$ajax.abort()}this.$ajax=a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(ad,ae,ac){ab.state.set({ready:true,error:null});ab.pagination.set({page:ad.paging.page,pageSize:ad.paging.pageSize,total:ad.paging.total});ab.attribution.set("value",ad.attribution);ab.reset(ab.parse(ad.data),aa);if(aa.success){aa.success(ab,ad)}},error:function(ae,af,ad){if(ae.statusText==="abort"){return}var ac=ae.status===400?JSON.parse(ae.responseText).message:String.format("Error retrieving {0} list.",ab.modelDescription);ab.state.set({error:ac});if(aa.error){aa.error(ab,[ac])}}})}});x.extend=Backbone.Collection.extend;var i=Backbone.Model.extend({});var r=x.extend({model:i,modelDescription:"job",initialize:function(aa,ab){this.timer=null;this.search=ab.search;this.listenTo(this.search,"change",this.onSearchChange)},to:function(ab,aa){this.pagination.set("page",ab);this.search.set("page",ab,_.extend({immediate:true,pageChange:true},aa))},url:function(){return Z.jobs+"?"+this.search.toQueryString()},onSearchChange:function(aa,ab){clearTimeout(this.timer);this.pagination.set("page",this.search.get("page"));if(ab.immediate){this.fetch(ab)}else{this.timer=setTimeout(_.bind(this.fetch,this,ab),500)}}});var t=Backbone.Model.extend({});var u=Backbone.Collection.extend({model:t,initialize:function(){this.state=new Y()},fetch:function(aa){var ab=this;aa||(aa={});this.state.set({ready:false,error:null});a.ajax({url:this.url(),dataType:"json",cache:true,type:"GET",success:function(ad,ae,ac){ab.reset(ad.data);ab.state.set({ready:true,error:null});if(aa.success){aa.success(ab,ad)}},error:function(ad,ae,ac){ab.state.set({error:"Error retrieving "+ab.description+" list."});if(aa.error){aa.error(ab,["Error retrieving "+ab.description+" list."])}}})}});var k=t.extend({});var j=u.extend({model:k,description:"Business Sector",url:function(){return Z.jobCategories}});var g=t.extend({});var h=u.extend({model:g,description:"Career Level",url:function(){return Z.careerLevels}});var v=t.extend({});var w=u.extend({model:v,description:"Member Status",url:function(){return Z.memberStatuses}});var f=function(aa){this.parent=null;this.children=[];Backbone.View.apply(this,[aa])};_.extend(f.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error_template").html()),loaderClass:"flex-loader-mini",renderState:function(aa){if(aa.get("error")){a(this.el).html(this.errorTemplate({error:aa.get("error")}));return true}if(!aa.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(aa){var ab=document.createElement("div");ab.className=this.loaderClass;a(aa).empty().append(ab)},addChildren:function(aa){var ab,ac=this;if(_.isArray(aa)){ab=aa}else{ab=_.toArray(arguments)}_.each(ab,function(ad){ac.children.push(ad);ad.parent=ac});if(ab.length===1){return ab[0]}else{return ab}},disposeChildren:function(aa){if(!aa){return}var ac=this;var ab=_.isArray(aa)?aa:_.toArray(arguments);_.each(ab,function(ad){ad.dispose()})},disposeAllChildren:function(){var aa=this.children.slice(0);_.each(aa,function(ab){ab.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(aa){var ab=_.indexOf(this.children,aa);if(ab!==-1){this.children.splice(ab,1)}}});f.extend=Backbone.View.extend;var y=f.extend({className:"overlay overlay-white overlay-absolute",events:{click:"onClick"},onClick:function(){this.trigger("clicked")},render:function(){this.$el.fadeIn();return this},dispose:function(){var aa=this;this.$el.fadeOut(function(){f.prototype.dispose.apply(aa)})}});var c=f.extend({tagName:"ins",className:"adsbygoogle",render:function(){this.$el.css({display:this.model.get("display"),height:this.model.get("height")+"px"}).attr({"data-ad-client":this.model.get("adClient"),"data-ad-slot":this.model.get("adSlot"),"data-format":this.model.get("format")});if(this.model.get("width")){this.$el.css("width",this.model.get("width")+"px")}return this}});var z=f.extend({el:a("#page")[0],initialize:function(){this.pageUnderlayView=null},initializeMap:function(){if(this.searchBoxView){this.searchBoxView.initializeMap()}},render:function(){this.searchBoxView=this.addChildren(U.create({el:a("#search_box")[0],type:this.type,search:this.options.search,enabled:this.options.enabled,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.searchBoxView.render();return this}});var V=z.extend({type:"search_jobs",onRefineSearch:function(){this.$('[data-element="sidebar_filter"]').animate({left:"50%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=new y();this.pageUnderlayView.on("clicked",this.onRefineSearchEnd,this);a("body").append(this.pageUnderlayView.render().el)},onRefineSearchEnd:function(){this.$('[data-element="sidebar_filter"]').animate({left:"-100%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=null},renderAds:function(){var aa=0;var af=window.innerWidth||document.documentElement.clientWidth;if(af>949&&this.options.ads.left){var ad=new c({model:new b(this.options.ads.left)});this.$('[data-outlet="left_ad"]').append(ad.render().el);aa++}if(af>600&&this.options.ads.right){var ae=new c({model:new b(this.options.ads.right)});this.$('[data-outlet="right_ad"]').append(ae.render().el);aa++}if(this.options.ads.bottom){var ab=new c({model:new b(this.options.ads.bottom)});this.$('[data-outlet="leaderboard"]').append(ab.render().el);aa++}for(var ac=0;ac<aa;ac++){(adsbygoogle=window.adsbygoogle||[]).push({})}},render:function(){z.prototype.render.call(this);this.searchBoxView.on("refine-search-end",this.onRefineSearchEnd,this);var aa=this.addChildren(new q({el:a("#joblist")[0],jobs:this.options.jobs,jobUrlFormatOverride:this.options.jobUrlFormatOverride}));aa.on("refine-search",this.onRefineSearch,this);aa.render();this.renderAds();return this}});var E=z.extend({type:"saved_search"});var U=f.extend({template:_.template(a("#search_box_template").html()),initializeMap:function(){if(this.locationView){this.locationView.initializeMap()}}},{create:function(aa){switch(aa.type){case"search_jobs":return new X(aa);break;case"saved_search":return new G(aa);break;default:throw new Error("type not supported.")}}});var X=U.extend({initialize:function(aa){this.listenTo(aa.search,"change",this.onSearchChange)},events:{'click [data-action="show_advanced"]':"onShowAdvancedClick",'click [data-action="search"]':"onSearchClick"},onShowAdvancedClick:function(aa){this.$('[data-action="show_advanced"]').slideUp();this.$('[data-action="search"].first').slideUp();this.$("[data-section=advanced]").slideDown()},onSearchClick:function(){this.trigger("refine-search-end")},onSearchChange:function(){this.setAdvancedOptionsVisibility()},setAdvancedOptionsVisibility:function(){if(this.options.search.get("categoryIds")||this.options.search.get("employerTypeIds")||this.options.search.get("positionTypeIds")){this.$('[data-action="show_advanced"]').hide();this.$("[data-section=advanced]").show()}},render:function(){this.$el.html(this.template());var af=this.addChildren(new O({model:this.options.search}));this.$("[data-section=basic]").append(af.render().el);var ad=this.addChildren(new M({model:this.options.search}));this.$("[data-section=basic]").append(ad.render().el);if(this.options.enabled.memberStatusIds){var ag=this.addChildren(new R({model:this.options.search}));this.$("[data-section=basic]").append(ag.render().el)}this.locationView=this.addChildren(new Q({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var ab=this.addChildren(new J({model:this.options.search}));this.$("[data-section=advanced]").append(ab.render().el);if(this.options.enabled.careerLevelIds){var aa=this.addChildren(new I({model:this.options.search}));this.$("[data-section=advanced]").append(aa.render().el)}var ac=this.addChildren(new L({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(ac.render().el);var ae=this.addChildren(new N({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(ae.render().el);this.$("[data-section=advanced]").append('<div class="clearfix flex-mt15"><div data-action="search" class="search-jobs-widget-anchor btn btn-default pull-right">Search</div></div>');this.setAdvancedOptionsVisibility();return this}});var G=U.extend({setAdvancedOptionsVisibility:function(){this.$('[data-action="show_advanced"]').hide()},render:function(){this.$el.html(this.template());var ai=this.addChildren(new S({model:this.options.search}));this.$("[data-section=basic]").append(ai.render().el);var ag=this.addChildren(new O({model:this.options.search}));this.$("[data-section=basic]").append(ag.render().el);var ae=this.addChildren(new M({model:this.options.search}));this.$("[data-section=basic]").append(ae.render().el);if(this.options.enabled.memberStatusIds){var ah=this.addChildren(new R({model:this.options.search}));this.$("[data-section=basic]").append(ah.render().el)}this.locationView=this.addChildren(new Q({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var ab=this.addChildren(new J({model:this.options.search}));this.$("[data-section=basic]").append(ab.render().el);if(this.options.enabled.careerLevelIds){var aa=this.addChildren(new I({model:this.options.search}));this.$("[data-section=basic]").append(aa.render().el)}var ad=this.addChildren(new L({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(ad.render().el);var af=this.addChildren(new N({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(af.render().el);var ac=this.addChildren(new K({model:this.options.search}));this.$("[data-section=basic]").append(ac.render().el);var aj=this.addChildren(new T({model:this.options.search}));this.$("[data-section=basic]").append(aj.render().el);this.setAdvancedOptionsVisibility();return this}});var S=f.extend({template:_.template(a("#search_box_name_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:name",this.onModelChange)},events:{"keyup input":"onInputChange"},onInputChange:function(aa){this.model.set({name:a(aa.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var O=f.extend({template:_.template(a("#search_box_keywords_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:q",this.onModelChange)},events:{"keyup input":"onInputChange","search input":"onInputChange","webkitspeechchange input":"onInputChange"},onInputChange:function(aa){this.model.set({q:a(aa.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var M=f.extend({template:_.template(a("#search_box_freshness_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:freshness",this.onModelChange)},events:{"change select[name=freshness]":"onFreshnessChange"},onFreshnessChange:function(aa){this.model.set({freshness:parseInt(a(aa.currentTarget).val(),10),page:1},{source:this,immediate:true})},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.setSelection()},setSelection:function(){this.$("select[name=freshness]").select2("val",this.model.get("freshness"))},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("select").select2({containerCssClass:"freshness",dropdownCssClass:"freshness-dropdown"});this.setSelection();return this}});var Q=f.extend({template:_.template(a("#search_box_location_template").html()),className:"flex-mb5",initialize:function(){this.map=null;this.mapLocation=null;this.circle=null;this.listenTo(this.model,"change:location",this.onModelChange);this.listenTo(this.model,"change:range",this.onModelChange)},events:{"change input[type=text]":"onInputTextChange","change select[name=range]":"onRangeChange"},onInputTextChange:function(aa){this.$("[data-info=location_search_error]").hide();var ab=a(aa.currentTarget).val().trim()?10:0;this.model.set({location:a(aa.currentTarget).val().trim(),range:ab,page:1},{source:this,immediate:true});this.setSelectStates();if(this.map){this.setMapLocation()}},onRangeChange:function(aa){this.model.set({range:parseInt(a(aa.currentTarget).val(),10),page:1},{source:this,immediate:true});this.renderCircle()},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.setSelectStates();if(this.map){this.setMapLocation()}},setMapLocation:function(){var ac=this;if(!this.model.get("location")){this.map.setCenter(new google.maps.LatLng(this.options.defaultLocation.latitude,this.options.defaultLocation.longitude));this.map.setZoom(this.options.defaultLocation.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var ab=this.options.provinces[this.model.get("location")];if(ab){this.map.setCenter(new google.maps.LatLng(ab.latitude,ab.longitude));this.map.setZoom(ab.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var aa=new google.maps.Geocoder();aa.geocode({address:this.model.get("location").trim(),region:"CA"},function(ad,ae){if(ae===google.maps.GeocoderStatus.ZERO_RESULTS){ac.$("[data-info=location_search_error]").text("Location not found.").show();return}if(ae!==google.maps.GeocoderStatus.OK){ac.$("[data-info=location_search_error]").text("Location search error.").show();return}ac.$("[data-info=location_search_error]").hide();ac.mapLocation={latitude:ad[0].geometry.location.lat(),longitude:ad[0].geometry.location.lng()};ac.map.fitBounds(ad[0].geometry.viewport);ac.renderCircle()})},renderCircle:function(){if(!this.map){return}if(this.circle){this.circle.setCenter(new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude));this.circle.setRadius(this.model.get("range")*1000)}else{this.circle=polygon=new google.maps.Circle({center:new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude),radius:this.model.get("range")*1000,strokeColor:"#3a9de2",strokeOpacity:0.8,strokeWeight:2,fillColor:"#3a9de2",fillOpacity:0.3,map:this.map})}this.map.fitBounds(this.circle.getBounds())},setSelectStates:function(){this.$("input[type=text]").select2("val",this.model.get("location"));this.$("select[name=range]").select2("val",this.model.get("range"));this.$(".range").toggle(!!this.model.get("location")&&!this.options.provinces[this.model.get("location")])},initializeMap:function(){this.map=new google.maps.Map(this.$('[data-outlet="map"]')[0],{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,draggable:false,disableDoubleClickZoom:true,scrollwheel:false});this.setMapLocation()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("input[type=text]").select2({minimumInputLength:3,allowClear:true,ajax:{url:Z.locations,dataType:"json",data:function(ab,aa){return{q:ab}},results:function(ab,aa){return{results:ab.data}}},initSelection:function(aa,ab){a.ajax({url:B+"locations?pageSize=1&types=town%2Cprovince%2Cterritory",data:{q:aa.val()},dataType:"json",type:"GET",success:function(ad,ae,ac){if(ad.data.length){ab(ad.data[0])}}})},id:function(aa){if(aa){return aa.description}else{return null}},formatResult:function(aa){return aa.description},formatSelection:function(aa){return aa.description}});this.$("select").select2({containerCssClass:"range",dropdownCssClass:"range-dropdown"});this.setSelectStates();return this}});var P=f.extend({className:"flex-mb5",initialize:function(){this.select2Rendered=false;this.collection=new this.collectionType();this.collection.fetch();this.listenTo(this.collection.state,"change",this.renderSelect);this.listenTo(this.model,"change:"+this.property,this.onModelChange)},events:{"change select":"onSelectChange","click [data-action=try_again]":"onTryAgainClick"},onSelectChange:function(ab){var aa={};aa[this.property]=ab.val.join(",");aa.page=1;this.model.set(aa,{source:this,immediate:true})},onModelChange:function(aa,ac,ab){if(ab.source===this||!this.select2Rendered){return}this.$("select").select2("val",this.model.getIds(this.property))},onTryAgainClick:function(aa){this.collection.fetch()},renderState:function(aa){if(aa.get("error")){this.$("[data-outlet]").html(this.errorTemplate({error:aa.get("error")}));return true}if(!aa.get("ready")){this.renderLoader(this.$("[data-outlet]")[0]);return true}return false},renderSelect:function(){if(this.renderState(this.collection.state)){return this}var ab=this,aa=[];aa.push('<select name="'+this.property+'" multiple="multiple" style="width:100%;"><option value=""></option>');this.collection.each(function(ac){aa.push(String.format('<option value="{0}"{1}>{2}</option>',ac.id,_.any(ab.model.getIds(ab.property),function(ad){return ad==ac.id})?' selected="selected"':"",ac.escape("name")))});aa.push("</select>");this.$("[data-outlet]").html(aa.join(""));this.$("select").select2({placeholder:this.placeholder(),allowClear:true});this.select2Rendered=true},render:function(){this.$el.html(this.template());this.renderSelect();return this}});var J=P.extend({template:_.template(a("#search_box_categories_template").html()),collectionType:j,property:"categoryIds",placeholder:function(){return"All "+s.jobCategories}});var I=P.extend({template:_.template(a("#search_box_careerLevels_template").html()),collectionType:h,property:"careerLevelIds",placeholder:function(){return"All Career Levels"}});var R=P.extend({template:_.template(a("#search_box_memberstatuses_template").html()),collectionType:w,property:"memberStatusIds",placeholder:function(){return"All CPA Statuses"}});var L=f.extend({template:_.template(a("#search_box_employertype_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:employerTypeIds",this.onModelChange);this.listenTo(this.model,"change:featuredEmployersOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.setSelection();this.setFeaturedSelection()},onInputChange:function(){var aa=this.$("input[name=employerTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({employerTypeIds:aa.length===this.$("input[name=employerTypeIds][type=checkbox]").length?"":aa.join(","),featuredEmployersOnly:this.$("input[name=featuredEmployersOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var aa=this;if(!this.model.getEmployerTypeIds().length){this.$("input[name=employerTypeIds]").prop("checked",true);return}this.$("input[name=employerTypeIds]").each(function(){a(this).prop("checked",_.contains(aa.model.getEmployerTypeIds(),a(this).val()))})},setFeaturedSelection:function(){this.$("[name=featuredEmployersOnly]").prop("checked",this.model.get("featuredEmployersOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setFeaturedSelection();return this}});var N=f.extend({template:_.template(a("#search_box_jobtype_template").html()),className:"flex-mb5  text-center",initialize:function(){this.listenTo(this.model,"change:positionTypeIds",this.onModelChange);this.listenTo(this.model,"change:trainingPositionsOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.setSelection();this.setTrainingPositionSelection()},onInputChange:function(){var aa=this.$("input[name=positionTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({positionTypeIds:aa.length===this.$("input[name=positionTypeIds][type=checkbox]").length?"":aa.join(","),trainingPositionsOnly:this.$("input[name=trainingPositionsOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var aa=this;if(!this.model.getPositionTypeIds().length){this.$("input[name=positionTypeIds]").prop("checked",true);return}this.$("input[name=positionTypeIds]").each(function(){a(this).prop("checked",_.contains(aa.model.getPositionTypeIds(),a(this).val()))})},setTrainingPositionSelection:function(){this.$("[name=trainingPositionsOnly]").prop("checked",this.model.get("trainingPositionsOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setTrainingPositionSelection();return this}});var K=f.extend({template:_.template(a("#search_box_emailfrequency_template").html()),className:"flex-mb5 flex-w100 text-center",initialize:function(){this.listenTo(this.model,"change:emailFrequencyId",this.onModelChange)},events:{"change input[name=emailFrequencyId]":"onInputChange"},onModelChange:function(aa,ac,ab){if(ab.source===this){return}this.setSelection()},onInputChange:function(){this.model.set({emailFrequency:this.$("input[name=emailFrequencyId]:checked").val(),page:1},{source:this,immediate:true})},setSelection:function(){this.$("input[name=emailFrequencyId]").filter("[value="+this.model.get("emailFrequencyId")+"]").prop("checked",true)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.setSelection();return this}});var T=f.extend({template:_.template(a("#search_box_submitbutton_template").html()),className:"flex-p10 flex-mt30 text-center flex-clear",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var q=f.extend({initialize:function(){},onPageChanged:function(){var aa=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;if(aa>this.$el.offset().top){window.scrollTo(0,this.$el.offset().top)}},onRefineSearch:function(){this.trigger("refine-search")},render:function(){var ad=this.addChildren(new o({el:a("#joblist_header"),jobs:this.options.jobs}));ad.on("refine-search",this.onRefineSearch,this);ad.render();var ab=this.addChildren(new l({el:a("#joblist-body-content"),jobs:this.options.jobs,jobUrlFormatOverride:this.options.jobUrlFormatOverride}));ab.render();var ac=this.addChildren(new n({el:a("#joblist_footer"),jobs:this.options.jobs}));ac.on("page-changed",this.onPageChanged,this);ac.render();var aa=this.addChildren(new e({el:a("#joblist_attribution"),model:this.options.jobs.attribution}));aa.render();return this}});var o=f.extend({initialize:function(aa){this.listenTo(this.options.jobs,"reset",this.renderTitle)},events:{'click [data-action="refine_search"]':"onRefineSearchClick"},onRefineSearchClick:function(){this.trigger("refine-search")},renderTitle:function(){this.$('[data-outlet="total"]').html(this.options.jobs.pagination.get("total"));this.$('[data-element="title"]').remove()}});var l=f.extend({emptyTemplate:_.template(a("#empty-joblist-template").html()),initialize:function(aa){this.listenTo(aa.jobs.state,"change",this.renderState);this.listenTo(aa.jobs,"reset",this.renderJobs);this.jobViews=null},events:{"click [data-action=try_again]":"onTryAgainClick"},onTryAgainClick:function(aa){this.options.jobs.fetch()},renderJobs:function(){if(this.renderState(this.options.jobs.state)){return this}this.disposeChildren(this.jobViews);this.$el.empty();if(this.options.jobs.length===0){this.$el.html(this.emptyTemplate());return}var ab=this,aa=[];this.jobViews=[];this.options.jobs.each(function(ad,ac){var ae=ac%2==0?"even":"odd";var af=new p({model:ad,className:"list-item-wrapper clearfix "+ae,attributes:{href:!!ab.options.jobUrlFormatOverride?ab.options.jobUrlFormatOverride.replace("{0}",ad.id):ad.get("url")}});ab.jobViews.push(af.render());aa.push(af.el)});this.addChildren(this.jobViews);this.$el.empty().append(aa)},renderState:function(aa){if(aa.get("error")){a(this.el).html(this.errorTemplate({error:aa.get("error")}));return true}if(!aa.get("ready")){if(this.$(".overlay").length<1){a('<div class="overlay overlay-white overlay-absolute"></div>').appendTo(this.$el)}return true}return false},render:function(){return this}});var p=f.extend({template:_.template(a("#joblist_item_template").html()),tagName:"a",events:{click:"onClick"},onClick:function(aa){C.changeRoute({replace:false})},target:function(){if(/^http(s)?:\/\//i.test(this.model.get("url"))){return"_blank"}else{return"_self"}},rel:function(){if(/^http(s)?:\/\//i.test(this.model.get("url"))){return"nofollow"}else{return null}},render:function(){this.$el.attr({title:this.model.get("title"),target:this.target(),rel:this.rel(),onmousedown:this.model.get("onmousedown")}).html(this.template(this.model.toJSON()));return this}});var n=f.extend({template:_.template(a("#joblist_footer_template").html()),subscribedTemplate:_.template(a("#joblist_footer_subscribed_template").html()),initialize:function(aa){this.listenTo(aa.jobs.pagination,"change",this.renderPagination);this.listenTo(aa.jobs.search,"change:page",this.renderPagination)},events:{"click [data-page]":"onPageClick","click [data-action=email]":"onEmailClick"},onEmailClick:function(aa){this.renderSubscribe()},renderSubscribe:function(){var aa=new m({search:this.options.jobs.search});aa.on("subscribe-success",this.renderSubscribed,this);this.$('[data-outlet="subscription"]').empty().append(aa.render().el)},renderSubscribed:function(){this.$('[data-outlet="subscription"]').html(this.subscribedTemplate())},onPageClick:function(aa){var ab=this;aa.preventDefault();this.options.jobs.to(a(aa.currentTarget).data("page"),{success:function(){ab.trigger("page-changed")},error:function(){ab.trigger("page-changed")}})},renderPagination:function(){a(this.el).show().empty().html(this.template({pagination:this.options.jobs.pagination.toJSON(),queryString:_.filter(this.options.jobs.search.toQueryString().split("&"),function(ab){var aa=ab.split("=");return aa[0]!="page"}).join("&"),showEmailButton:this.options.jobs.search.get("q")||this.options.jobs.search.getCategoryIds().length}));return this}});var m=f.extend({template:_.template(a("#joblist_footer_subscribe_template").html()),tagName:"form",events:{submit:"onSubmit"},onSubmit:function(aa){aa.preventDefault();var ac=this;var ab=this.$("[name=email]").val();if(!this.isEmailValid(ab)){this.showError("Email is invalid.");this.$("input").first().focus();return}this.showLoader();this.options.search.subscribeJobAlert(ab,{success:function(ae,ad){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobAlertSubscribe",eventLabel:"Source:JobSearch",nonInteraction:false});ac.trigger("subscribe-success")},error:function(ae,ad){ac.showError(ad[0])}})},showError:function(aa){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text(aa).show();this.$('[data-element="subscribe_loader"]').hide()},showLoader:function(){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text("").hide();this.$('[data-element="subscribe_loader"]').show()},isEmailValid:function(aa){return/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/.test(aa)},render:function(){var ab=this;this.$el.html(this.template());var aa=function(){ab.$("input").first().focus()};if(!a.contains(document.documentElement,this.el)){setTimeout(aa,10)}else{aa()}return this}});var e=f.extend({template:_.template(a("#joblist_attribution_template").html()),initialize:function(){this.listenTo(this.model,"change:value",this.render)},render:function(){a(this.el).html(this.template(this.model.toJSON()));return this}});var C;var D=Backbone.Router.extend({initialize:function(aa){this.timer=null;this.initialQuery=aa.query;this.enabled=aa.enabled;this.defaultLocation=aa.defaultLocation;this.provinces=aa.provinces;this.search=new H(aa.query)},initializeMap:function(){this.pageView.initializeMap()},routes:{"*queryString":"queryString"},queryString:function(ab){var aa=ab?this.parse(ab):this.initialQuery;this.search.set(aa,{source:this,immediate:true})},parse:function(ab){var aa={};if(ab){_.each(_.map(ab.split(/&/g),function(ad,ae){var ac=ad.split("="),af={};if(ac.length>=1){var ag=undefined;if(ac.length==2){http:ag=decodeURIComponent(ac[1].replace(/\+/g,"%20"))}if(/^-?[\d\.]+$/g.test(ag)){ag=ag*1}else{if(/^((true)|(false))$/g.test(ag)){if(ag==="true"){ag=true}else{ag=false}}}af[ac[0]]=ag}return af}),function(ac){_.extend(aa,ac)})}return aa},changeRoute:function(aa){}});var W=D.extend({initialize:function(aa){D.prototype.initialize.call(this,aa);this.listenTo(this.search,"change",this.onSearchChange);this.jobs=new r(aa.jobs.data,{pagination:_.pick(aa.jobs.paging,"page","pageSize","total"),search:this.search,attribution:{value:decodeURIComponent(aa.attribution)}});this.jobs.state.set({ready:true,error:null});this.pageView=new V({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces,jobs:this.jobs,ads:aa.ads,jobUrlFormatOverride:aa.jobUrlFormatOverride});this.pageView.render()},changeRoute:function(aa){if(Backbone.history.fragment==this.search.toFullQueryString()){return}aa=_.extend({trigger:false,replace:false},aa);this.navigate(this.search.toFullQueryString(),aa);new Image().src=Z.log+"?"+this.search.toQueryString()},onSearchChange:function(aa,ab){if(ab.source===this){return}clearInterval(this.timer);if(ab.pageChange){this.changeRoute({replace:false})}else{this.timer=setTimeout(_.bind(this.changeRoute,this,{replace:false}),4000)}}});var F=D.extend({initialize:function(aa){D.prototype.initialize.call(this,aa);this.pageView=new E({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces});this.pageView.render()}});window.initializeMap=function(){C.initializeMap()};return{init:function(aa){B=aa.restPath;s=aa.labels;Z(aa.restPath);switch(aa.type){case"search_jobs":C=new W(aa);break;case"saved_search":C=new F(aa);break;default:throw Error("options.type not supported.")}Backbone.history.start();var ab=document.createElement("script");ab.type="text/javascript";ab.src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyA7GqDK9GlTQJQc-WqPi-HHJ45vAtHgXAI&region=CA&callback=initializeMap";document.body.appendChild(ab)}}}(jQuery));