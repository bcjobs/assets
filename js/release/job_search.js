var JOBCENTRE=window.JOBCENTRE||{};JOBCENTRE.jobSearch=(function(a){var z,q;var X=function(Y){X={jobs:Y+"public/jobs",jobCategories:Y+"jobcategories",careerLevels:Y+"careerlevels",memberStatuses:Y+"memberstatuses",locations:Y+"locations?pageSize=5&types=town%2Cprovince%2Cterritory",log:Y+"public/jobs/log",jobAlerts:Y+"jobalerts/fromjobsearch"}};var W=Backbone.Model.extend({defaults:{ready:false,error:null}});var b=Backbone.Model.extend({});var F=Backbone.Model.extend({defaults:{page:1,q:"",location:"",range:0,freshness:0,categoryIds:"",careerLevelIds:"",memberStatusIds:"",featuredEmployersOnly:false,trainingPositionsOnly:false,positionTypeIds:"",employerTypeIds:""},getCategoryIds:function(){return this.getIds("categoryIds")},getCareerLevelIds:function(){return this.getIds("careerLevelIds")},getMemberStatusIds:function(){return this.getIds("memberStatusIds")},getPositionTypeIds:function(){return this.getIds("positionTypeIds")},getEmployerTypeIds:function(){return this.getIds("employerTypeIds")},getIds:function(Y){if(!this.get(Y).toString().length){return[]}return this.get(Y).toString().split(",")},toQueryString:function(){var Y=this.toJSON();var Z={};for(var aa in Y){if(Y.hasOwnProperty(aa)){if(Y[aa]){Z[aa]=Y[aa]}}}return a.param(Z)},toFullQueryString:function(){return a.param(this.toJSON())},jobAlertsUrl:function(Y){return X.jobAlerts+"?email="+Y+"&"+this.toQueryString()},subscribeJobAlert:function(Y,Z){Z||(Z={});var aa=this;a.ajax({url:this.jobAlertsUrl(Y),dataType:"json",cache:false,type:"POST",success:function(ac,ad,ab){if(Z.success){Z.success(aa,ac)}},error:function(ac,ae,ab){if(ac.status===400){var ad=JSON.parse(ac.responseText);if(Z.error){Z.error(aa,[ad.message]);return}}if(Z.error){Z.error(aa,["Error connecting to the server."])}}})}});var y=Backbone.Model.extend({defaults:{page:1,pageSize:20,total:0},pages:function(){return Math.ceil(this.get("total")/this.get("pageSize"))},prev:function(){if(this.get("page")>1){return this.get("page")-1}else{return null}},next:function(){if(this.get("page")<this.pages()){return this.get("page")+1}else{null}},toJSON:function(Z){var Y=Backbone.Model.prototype.toJSON.call(this,Z);Y.pages=this.pages();Y.prev=this.prev();Y.next=this.next();return Y}});var v=function(Y,Z){Backbone.Collection.apply(this,[Y,Z]);Z||(Z={});this.pagination=new y(Z.pagination||{});this.state=new W()};_.extend(v.prototype,Backbone.Collection.prototype,{to:function(Z,Y){this.pagination.set("page",Z);this.fetch(Y)},url:function(){return""},fetch:function(Y){var Z=this;Y||(Y={});this.state.set({ready:false,error:null});if(this.$ajax){this.$ajax.abort()}this.$ajax=a.ajax({url:this.url(),dataType:"json",cache:false,type:"GET",success:function(ab,ac,aa){Z.state.set({ready:true,error:null});Z.pagination.set({page:ab.paging.page,pageSize:ab.paging.pageSize,total:ab.paging.total});Z.reset(Z.parse(ab.data),Y);if(Y.success){Y.success(Z,ab)}},error:function(ac,ad,ab){if(ac.statusText==="abort"){return}var aa=ac.status===400?JSON.parse(ac.responseText).message:String.format("Error retrieving {0} list.",Z.modelDescription);Z.state.set({error:aa});if(Y.error){Y.error(Z,[aa])}}})}});v.extend=Backbone.Collection.extend;var g=Backbone.Model.extend({});var p=v.extend({model:g,modelDescription:"job",initialize:function(Y,Z){this.timer=null;this.search=Z.search;this.listenTo(this.search,"change",this.onSearchChange)},to:function(Z,Y){this.pagination.set("page",Z);this.search.set("page",Z,_.extend({immediate:true,pageChange:true},Y))},url:function(){return X.jobs+"?"+this.search.toQueryString()},onSearchChange:function(Y,Z){clearTimeout(this.timer);this.pagination.set("page",this.search.get("page"));if(Z.immediate){this.fetch(Z)}else{this.timer=setTimeout(_.bind(this.fetch,this,Z),500)}}});var r=Backbone.Model.extend({});var s=Backbone.Collection.extend({model:r,initialize:function(){this.state=new W()},fetch:function(Y){var Z=this;Y||(Y={});this.state.set({ready:false,error:null});a.ajax({url:this.url(),dataType:"json",cache:true,type:"GET",success:function(ab,ac,aa){Z.reset(ab.data);Z.state.set({ready:true,error:null});if(Y.success){Y.success(Z,ab)}},error:function(ab,ac,aa){Z.state.set({error:"Error retrieving "+Z.description+" list."});if(Y.error){Y.error(Z,["Error retrieving "+Z.description+" list."])}}})}});var i=r.extend({});var h=s.extend({model:i,description:"Business Sector",url:function(){return X.jobCategories}});var e=r.extend({});var f=s.extend({model:e,description:"Career Level",url:function(){return X.careerLevels}});var t=r.extend({});var u=s.extend({model:t,description:"Member Status",url:function(){return X.memberStatuses}});var d=function(Y){this.parent=null;this.children=[];Backbone.View.apply(this,[Y])};_.extend(d.prototype,Backbone.View.prototype,{errorTemplate:_.template(a("#error_template").html()),loaderClass:"flex-loader-mini",renderState:function(Y){if(Y.get("error")){a(this.el).html(this.errorTemplate({error:Y.get("error")}));return true}if(!Y.get("ready")){this.renderLoader(this.el);return true}return false},renderLoader:function(Y){var Z=document.createElement("div");Z.className=this.loaderClass;a(Y).empty().append(Z)},addChildren:function(Y){var Z,aa=this;if(_.isArray(Y)){Z=Y}else{Z=_.toArray(arguments)}_.each(Z,function(ab){aa.children.push(ab);ab.parent=aa});if(Z.length===1){return Z[0]}else{return Z}},disposeChildren:function(Y){if(!Y){return}var aa=this;var Z=_.isArray(Y)?Y:_.toArray(arguments);_.each(Z,function(ab){ab.dispose()})},disposeAllChildren:function(){var Y=this.children.slice(0);_.each(Y,function(Z){Z.dispose()})},dispose:function(){this.disposeAllChildren();this.remove();this._removeFromParent()},_removeFromParent:function(){if(this.parent){this.parent._removeChild(this)}},_removeChild:function(Y){var Z=_.indexOf(this.children,Y);if(Z!==-1){this.children.splice(Z,1)}}});d.extend=Backbone.View.extend;var w=d.extend({className:"overlay overlay-white overlay-absolute",events:{click:"onClick"},onClick:function(){this.trigger("clicked")},render:function(){this.$el.fadeIn();return this},dispose:function(){var Y=this;this.$el.fadeOut(function(){d.prototype.dispose.apply(Y)})}});var c=d.extend({tagName:"ins",className:"adsbygoogle",render:function(){this.$el.css({display:this.model.get("display"),height:this.model.get("height")+"px"}).attr({"data-ad-client":this.model.get("adClient"),"data-ad-slot":this.model.get("adSlot"),"data-format":this.model.get("format")});if(this.model.get("width")){this.$el.css("width",this.model.get("width")+"px")}return this}});var x=d.extend({el:a("#page")[0],initialize:function(){this.pageUnderlayView=null},initializeMap:function(){if(this.searchBoxView){this.searchBoxView.initializeMap()}},render:function(){this.searchBoxView=this.addChildren(S.create({el:a("#search_box")[0],type:this.type,search:this.options.search,enabled:this.options.enabled,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.searchBoxView.render();return this}});var T=x.extend({type:"search_jobs",onRefineSearch:function(){this.$('[data-element="sidebar_filter"]').animate({left:"50%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=new w();this.pageUnderlayView.on("clicked",this.onRefineSearchEnd,this);a("body").append(this.pageUnderlayView.render().el)},onRefineSearchEnd:function(){this.$('[data-element="sidebar_filter"]').animate({left:"-100%"});this.disposeChildren(this.pageUnderlayView);this.pageUnderlayView=null},renderAds:function(){var Y=0;var ad=window.innerWidth||document.documentElement.clientWidth;if(ad>949&&this.options.ads.left){var ab=new c({model:new b(this.options.ads.left)});this.$('[data-outlet="left_ad"]').append(ab.render().el);Y++}if(ad>600&&this.options.ads.right){var ac=new c({model:new b(this.options.ads.right)});this.$('[data-outlet="right_ad"]').append(ac.render().el);Y++}if(this.options.ads.bottom){var Z=new c({model:new b(this.options.ads.bottom)});this.$('[data-outlet="leaderboard"]').append(Z.render().el);Y++}for(var aa=0;aa<Y;aa++){(adsbygoogle=window.adsbygoogle||[]).push({})}},render:function(){x.prototype.render.call(this);this.searchBoxView.on("refine-search-end",this.onRefineSearchEnd,this);var Y=this.addChildren(new o({el:a("#joblist")[0],jobs:this.options.jobs}));Y.on("refine-search",this.onRefineSearch,this);Y.render();this.renderAds();return this}});var C=x.extend({type:"saved_search"});var S=d.extend({template:_.template(a("#search_box_template").html()),initializeMap:function(){if(this.locationView){this.locationView.initializeMap()}}},{create:function(Y){switch(Y.type){case"search_jobs":return new V(Y);break;case"saved_search":return new E(Y);break;default:throw new Error("type not supported.")}}});var V=S.extend({initialize:function(Y){this.listenTo(Y.search,"change",this.onSearchChange)},events:{'click [data-action="show_advanced"]':"onShowAdvancedClick",'click [data-action="search"]':"onSearchClick"},onShowAdvancedClick:function(Y){this.$('[data-action="show_advanced"]').slideUp();this.$('[data-action="search"].first').slideUp();this.$("[data-section=advanced]").slideDown()},onSearchClick:function(){this.trigger("refine-search-end")},onSearchChange:function(){this.setAdvancedOptionsVisibility()},setAdvancedOptionsVisibility:function(){if(this.options.search.get("categoryIds")||this.options.search.get("employerTypeIds")||this.options.search.get("positionTypeIds")){this.$('[data-action="show_advanced"]').hide();this.$("[data-section=advanced]").show()}},render:function(){this.$el.html(this.template());var ad=this.addChildren(new M({model:this.options.search}));this.$("[data-section=basic]").append(ad.render().el);var ab=this.addChildren(new K({model:this.options.search}));this.$("[data-section=basic]").append(ab.render().el);if(this.options.enabled.memberStatusIds){var ae=this.addChildren(new P({model:this.options.search}));this.$("[data-section=basic]").append(ae.render().el)}this.locationView=this.addChildren(new O({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var Z=this.addChildren(new H({model:this.options.search}));this.$("[data-section=advanced]").append(Z.render().el);if(this.options.enabled.careerLevelIds){var Y=this.addChildren(new G({model:this.options.search}));this.$("[data-section=advanced]").append(Y.render().el)}var aa=this.addChildren(new J({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(aa.render().el);var ac=this.addChildren(new L({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=advanced]").append(ac.render().el);this.$("[data-section=advanced]").append('<div class="clearfix flex-mt15"><div data-action="search" class="search-jobs-widget-anchor btn btn-default pull-right">Search</div></div>');this.setAdvancedOptionsVisibility();return this}});var E=S.extend({setAdvancedOptionsVisibility:function(){this.$('[data-action="show_advanced"]').hide()},render:function(){this.$el.html(this.template());var ag=this.addChildren(new Q({model:this.options.search}));this.$("[data-section=basic]").append(ag.render().el);var ae=this.addChildren(new M({model:this.options.search}));this.$("[data-section=basic]").append(ae.render().el);var ac=this.addChildren(new K({model:this.options.search}));this.$("[data-section=basic]").append(ac.render().el);if(this.options.enabled.memberStatusIds){var af=this.addChildren(new P({model:this.options.search}));this.$("[data-section=basic]").append(af.render().el)}this.locationView=this.addChildren(new O({model:this.options.search,defaultLocation:this.options.defaultLocation,provinces:this.options.provinces}));this.$("[data-section=basic]").append(this.locationView.render().el);var Z=this.addChildren(new H({model:this.options.search}));this.$("[data-section=basic]").append(Z.render().el);if(this.options.enabled.careerLevelIds){var Y=this.addChildren(new G({model:this.options.search}));this.$("[data-section=basic]").append(Y.render().el)}var ab=this.addChildren(new J({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(ab.render().el);var ad=this.addChildren(new L({model:this.options.search,enabled:this.options.enabled}));this.$("[data-section=basic]").append(ad.render().el);var aa=this.addChildren(new I({model:this.options.search}));this.$("[data-section=basic]").append(aa.render().el);var ah=this.addChildren(new R({model:this.options.search}));this.$("[data-section=basic]").append(ah.render().el);this.setAdvancedOptionsVisibility();return this}});var Q=d.extend({template:_.template(a("#search_box_name_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:name",this.onModelChange)},events:{"keyup input":"onInputChange"},onInputChange:function(Y){this.model.set({name:a(Y.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var M=d.extend({template:_.template(a("#search_box_keywords_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:q",this.onModelChange)},events:{"keyup input":"onInputChange","search input":"onInputChange","webkitspeechchange input":"onInputChange"},onInputChange:function(Y){this.model.set({q:a(Y.currentTarget).val().trim(),page:1},{source:this})},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var K=d.extend({template:_.template(a("#search_box_freshness_template").html()),className:"flex-mb5",initialize:function(){this.listenTo(this.model,"change:freshness",this.onModelChange)},events:{"change select[name=freshness]":"onFreshnessChange"},onFreshnessChange:function(Y){this.model.set({freshness:parseInt(a(Y.currentTarget).val(),10),page:1},{source:this,immediate:true})},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.setSelection()},setSelection:function(){this.$("select[name=freshness]").select2("val",this.model.get("freshness"))},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("select").select2({containerCssClass:"freshness",dropdownCssClass:"freshness-dropdown"});this.setSelection();return this}});var O=d.extend({template:_.template(a("#search_box_location_template").html()),className:"flex-mb5",initialize:function(){this.map=null;this.mapLocation=null;this.circle=null;this.listenTo(this.model,"change:location",this.onModelChange);this.listenTo(this.model,"change:range",this.onModelChange)},events:{"change input[type=text]":"onInputTextChange","change select[name=range]":"onRangeChange"},onInputTextChange:function(Y){this.$("[data-info=location_search_error]").hide();var Z=a(Y.currentTarget).val().trim()?10:0;this.model.set({location:a(Y.currentTarget).val().trim(),range:Z,page:1},{source:this,immediate:true});this.setSelectStates();if(this.map){this.setMapLocation()}},onRangeChange:function(Y){this.model.set({range:parseInt(a(Y.currentTarget).val(),10),page:1},{source:this,immediate:true});this.renderCircle()},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.setSelectStates();if(this.map){this.setMapLocation()}},setMapLocation:function(){var aa=this;if(!this.model.get("location")){this.map.setCenter(new google.maps.LatLng(this.options.defaultLocation.latitude,this.options.defaultLocation.longitude));this.map.setZoom(this.options.defaultLocation.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var Z=this.options.provinces[this.model.get("location")];if(Z){this.map.setCenter(new google.maps.LatLng(Z.latitude,Z.longitude));this.map.setZoom(Z.zoom);this.mapLocation=null;if(this.circle){this.circle.setMap(null);this.circle=null}return}var Y=new google.maps.Geocoder();Y.geocode({address:this.model.get("location").trim(),region:"CA"},function(ab,ac){if(ac===google.maps.GeocoderStatus.ZERO_RESULTS){aa.$("[data-info=location_search_error]").text("Location not found.").show();return}if(ac!==google.maps.GeocoderStatus.OK){aa.$("[data-info=location_search_error]").text("Location search error.").show();return}aa.$("[data-info=location_search_error]").hide();aa.mapLocation={latitude:ab[0].geometry.location.lat(),longitude:ab[0].geometry.location.lng()};aa.map.fitBounds(ab[0].geometry.viewport);aa.renderCircle()})},renderCircle:function(){if(!this.map){return}if(this.circle){this.circle.setCenter(new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude));this.circle.setRadius(this.model.get("range")*1000)}else{this.circle=polygon=new google.maps.Circle({center:new google.maps.LatLng(this.mapLocation.latitude,this.mapLocation.longitude),radius:this.model.get("range")*1000,strokeColor:"#3a9de2",strokeOpacity:0.8,strokeWeight:2,fillColor:"#3a9de2",fillOpacity:0.3,map:this.map})}this.map.fitBounds(this.circle.getBounds())},setSelectStates:function(){this.$("input[type=text]").select2("val",this.model.get("location"));this.$("select[name=range]").select2("val",this.model.get("range"));this.$(".range").toggle(!!this.model.get("location")&&!this.options.provinces[this.model.get("location")])},initializeMap:function(){this.map=new google.maps.Map(this.$('[data-outlet="map"]')[0],{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,draggable:false,disableDoubleClickZoom:true,scrollwheel:false});this.setMapLocation()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$("input[type=text]").select2({minimumInputLength:3,allowClear:true,ajax:{url:X.locations,dataType:"json",data:function(Z,Y){return{q:Z}},results:function(Z,Y){return{results:Z.data}}},initSelection:function(Y,Z){a.ajax({url:z+"locations?pageSize=1&types=town%2Cprovince%2Cterritory",data:{q:Y.val()},dataType:"json",type:"GET",success:function(ab,ac,aa){if(ab.data.length){Z(ab.data[0])}}})},id:function(Y){if(Y){return Y.description}else{return null}},formatResult:function(Y){return Y.description},formatSelection:function(Y){return Y.description}});this.$("select").select2({containerCssClass:"range",dropdownCssClass:"range-dropdown"});this.setSelectStates();return this}});var N=d.extend({className:"flex-mb5",initialize:function(){this.select2Rendered=false;this.collection=new this.collectionType();this.collection.fetch();this.listenTo(this.collection.state,"change",this.renderSelect);this.listenTo(this.model,"change:"+this.property,this.onModelChange)},events:{"change select":"onSelectChange","click [data-action=try_again]":"onTryAgainClick"},onSelectChange:function(Z){var Y={};Y[this.property]=Z.val.join(",");Y.page=1;this.model.set(Y,{source:this,immediate:true})},onModelChange:function(Y,aa,Z){if(Z.source===this||!this.select2Rendered){return}this.$("select").select2("val",this.model.getIds(this.property))},onTryAgainClick:function(Y){this.collection.fetch()},renderState:function(Y){if(Y.get("error")){this.$("[data-outlet]").html(this.errorTemplate({error:Y.get("error")}));return true}if(!Y.get("ready")){this.renderLoader(this.$("[data-outlet]")[0]);return true}return false},renderSelect:function(){if(this.renderState(this.collection.state)){return this}var Z=this,Y=[];Y.push('<select name="'+this.property+'" multiple="multiple" style="width:100%;"><option value=""></option>');this.collection.each(function(aa){Y.push(String.format('<option value="{0}"{1}>{2}</option>',aa.id,_.any(Z.model.getIds(Z.property),function(ab){return ab==aa.id})?' selected="selected"':"",aa.escape("name")))});Y.push("</select>");this.$("[data-outlet]").html(Y.join(""));this.$("select").select2({placeholder:this.placeholder(),allowClear:true});this.select2Rendered=true},render:function(){this.$el.html(this.template());this.renderSelect();return this}});var H=N.extend({template:_.template(a("#search_box_categories_template").html()),collectionType:h,property:"categoryIds",placeholder:function(){return"All "+q.jobCategories}});var G=N.extend({template:_.template(a("#search_box_careerLevels_template").html()),collectionType:f,property:"careerLevelIds",placeholder:function(){return"All Career Levels"}});var P=N.extend({template:_.template(a("#search_box_memberstatuses_template").html()),collectionType:u,property:"memberStatusIds",placeholder:function(){return"All CPA Statuses"}});var J=d.extend({template:_.template(a("#search_box_employertype_template").html()),className:"flex-mb5 text-center",initialize:function(){this.listenTo(this.model,"change:employerTypeIds",this.onModelChange);this.listenTo(this.model,"change:featuredEmployersOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.setSelection();this.setFeaturedSelection()},onInputChange:function(){var Y=this.$("input[name=employerTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({employerTypeIds:Y.length===this.$("input[name=employerTypeIds][type=checkbox]").length?"":Y.join(","),featuredEmployersOnly:this.$("input[name=featuredEmployersOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var Y=this;if(!this.model.getEmployerTypeIds().length){this.$("input[name=employerTypeIds]").prop("checked",true);return}this.$("input[name=employerTypeIds]").each(function(){a(this).prop("checked",_.contains(Y.model.getEmployerTypeIds(),a(this).val()))})},setFeaturedSelection:function(){this.$("[name=featuredEmployersOnly]").prop("checked",this.model.get("featuredEmployersOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setFeaturedSelection();return this}});var L=d.extend({template:_.template(a("#search_box_jobtype_template").html()),className:"flex-mb5  text-center",initialize:function(){this.listenTo(this.model,"change:positionTypeIds",this.onModelChange);this.listenTo(this.model,"change:trainingPositionsOnly",this.onModelChange)},events:{"change input":"onInputChange"},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.setSelection();this.setTrainingPositionSelection()},onInputChange:function(){var Y=this.$("input[name=positionTypeIds][type=checkbox]:checked").map(function(){return this.value}).get();this.model.set({positionTypeIds:Y.length===this.$("input[name=positionTypeIds][type=checkbox]").length?"":Y.join(","),trainingPositionsOnly:this.$("input[name=trainingPositionsOnly]").prop("checked"),page:1},{source:this,immediate:true})},setSelection:function(){var Y=this;if(!this.model.getPositionTypeIds().length){this.$("input[name=positionTypeIds]").prop("checked",true);return}this.$("input[name=positionTypeIds]").each(function(){a(this).prop("checked",_.contains(Y.model.getPositionTypeIds(),a(this).val()))})},setTrainingPositionSelection:function(){this.$("[name=trainingPositionsOnly]").prop("checked",this.model.get("trainingPositionsOnly"))},render:function(){this.$el.html(this.template({model:this.model.toJSON(),enabled:this.options.enabled}));this.setSelection();this.setTrainingPositionSelection();return this}});var I=d.extend({template:_.template(a("#search_box_emailfrequency_template").html()),className:"flex-mb5 flex-w100 text-center",initialize:function(){this.listenTo(this.model,"change:emailFrequencyId",this.onModelChange)},events:{"change input[name=emailFrequencyId]":"onInputChange"},onModelChange:function(Y,aa,Z){if(Z.source===this){return}this.setSelection()},onInputChange:function(){this.model.set({emailFrequency:this.$("input[name=emailFrequencyId]:checked").val(),page:1},{source:this,immediate:true})},setSelection:function(){this.$("input[name=emailFrequencyId]").filter("[value="+this.model.get("emailFrequencyId")+"]").prop("checked",true)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.setSelection();return this}});var R=d.extend({template:_.template(a("#search_box_submitbutton_template").html()),className:"flex-p10 flex-mt30 text-center flex-clear",render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});var o=d.extend({initialize:function(){},onPageChanged:function(){var Y=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;if(Y>this.$el.offset().top){window.scrollTo(0,this.$el.offset().top)}},onRefineSearch:function(){this.trigger("refine-search")},render:function(){var aa=this.addChildren(new m({el:a("#joblist_header"),jobs:this.options.jobs}));aa.on("refine-search",this.onRefineSearch,this);aa.render();var Y=this.addChildren(new j({el:a("#joblist-body-content"),jobs:this.options.jobs}));Y.render();var Z=this.addChildren(new l({el:a("#joblist_footer"),jobs:this.options.jobs}));Z.on("page-changed",this.onPageChanged,this);Z.render();return this}});var m=d.extend({initialize:function(Y){this.listenTo(this.options.jobs,"reset",this.renderTitle)},events:{'click [data-action="refine_search"]':"onRefineSearchClick"},onRefineSearchClick:function(){this.trigger("refine-search")},renderTitle:function(){this.$('[data-outlet="total"]').html(this.options.jobs.pagination.get("total"));this.$('[data-element="title"]').remove()}});var j=d.extend({emptyTemplate:_.template(a("#empty-joblist-template").html()),initialize:function(Y){this.listenTo(Y.jobs.state,"change",this.renderState);this.listenTo(Y.jobs,"reset",this.renderJobs);this.jobViews=null},events:{"click [data-action=try_again]":"onTryAgainClick"},onTryAgainClick:function(Y){this.options.jobs.fetch()},renderJobs:function(){if(this.renderState(this.options.jobs.state)){return this}this.disposeChildren(this.jobViews);this.$el.empty();if(this.options.jobs.length===0){this.$el.html(this.emptyTemplate());return}var Z=this,Y=[];this.jobViews=[];this.options.jobs.each(function(ab,aa){var ac=aa%2==0?"even":"odd";var ad=new n({model:ab,className:"list-item-wrapper clearfix "+ac,attributes:{href:ab.get("url")}});Z.jobViews.push(ad.render());Y.push(ad.el)});this.addChildren(this.jobViews);this.$el.empty().append(Y)},renderState:function(Y){if(Y.get("error")){a(this.el).html(this.errorTemplate({error:Y.get("error")}));return true}if(!Y.get("ready")){if(this.$(".overlay").length<1){a('<div class="overlay overlay-white overlay-absolute"></div>').appendTo(this.$el)}return true}return false},render:function(){return this}});var n=d.extend({template:_.template(a("#joblist_item_template").html()),tagName:"a",events:{click:"onClick"},onClick:function(Y){A.changeRoute({replace:false})},render:function(){this.$el.attr("title",this.model.get("title")).html(this.template(this.model.toJSON()));return this}});var l=d.extend({template:_.template(a("#joblist_footer_template").html()),subscribedTemplate:_.template(a("#joblist_footer_subscribed_template").html()),initialize:function(Y){this.listenTo(Y.jobs.pagination,"change",this.renderPagination);this.listenTo(Y.jobs.search,"change:page",this.renderPagination)},events:{"click [data-page]":"onPageClick","click [data-action=email]":"onEmailClick"},onEmailClick:function(Y){this.renderSubscribe()},renderSubscribe:function(){var Y=new k({search:this.options.jobs.search});Y.on("subscribe-success",this.renderSubscribed,this);this.$('[data-outlet="subscription"]').empty().append(Y.render().el)},renderSubscribed:function(){this.$('[data-outlet="subscription"]').html(this.subscribedTemplate())},onPageClick:function(Y){var Z=this;Y.preventDefault();this.options.jobs.to(a(Y.currentTarget).data("page"),{success:function(){Z.trigger("page-changed")},error:function(){Z.trigger("page-changed")}})},renderPagination:function(){a(this.el).show().empty().html(this.template({pagination:this.options.jobs.pagination.toJSON(),queryString:_.filter(this.options.jobs.search.toQueryString().split("&"),function(Z){var Y=Z.split("=");return Y[0]!="page"}).join("&"),showEmailButton:this.options.jobs.search.get("q")||this.options.jobs.search.getCategoryIds().length}));return this}});var k=d.extend({template:_.template(a("#joblist_footer_subscribe_template").html()),tagName:"form",events:{submit:"onSubmit"},onSubmit:function(Y){Y.preventDefault();var aa=this;var Z=this.$("[name=email]").val();if(!this.isEmailValid(Z)){this.showError("Email is invalid.");this.$("input").first().focus();return}this.showLoader();this.options.search.subscribeJobAlert(Z,{success:function(ac,ab){dataLayer.push({event:"custom",eventCategory:"App",eventAction:"JobAlertSubscribe",eventLabel:"Source:JobSearch",nonInteraction:false});aa.trigger("subscribe-success")},error:function(ac,ab){aa.showError(ab[0])}})},showError:function(Y){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text(Y).show();this.$('[data-element="subscribe_loader"]').hide()},showLoader:function(){this.$('[data-element="subscribe_message"]').hide();this.$('[data-element="subscribe_error"]').text("").hide();this.$('[data-element="subscribe_loader"]').show()},isEmailValid:function(Y){return/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/.test(Y)},render:function(){var Z=this;this.$el.html(this.template());var Y=function(){Z.$("input").first().focus()};if(!a.contains(document.documentElement,this.el)){setTimeout(Y,10)}else{Y()}return this}});var A;var B=Backbone.Router.extend({initialize:function(Y){this.timer=null;this.initialQuery=Y.query;this.enabled=Y.enabled;this.defaultLocation=Y.defaultLocation;this.provinces=Y.provinces;this.search=new F(Y.query)},initializeMap:function(){this.pageView.initializeMap()},routes:{"*queryString":"queryString"},queryString:function(Z){var Y=Z?this.parse(Z):this.initialQuery;this.search.set(Y,{source:this,immediate:true})},parse:function(Z){var Y={};if(Z){_.each(_.map(Z.split(/&/g),function(ab,ac){var aa=ab.split("="),ad={};if(aa.length>=1){var ae=undefined;if(aa.length==2){http:ae=decodeURIComponent(aa[1].replace(/\+/g,"%20"))}if(/^-?[\d\.]+$/g.test(ae)){ae=ae*1}else{if(/^((true)|(false))$/g.test(ae)){if(ae==="true"){ae=true}else{ae=false}}}ad[aa[0]]=ae}return ad}),function(aa){_.extend(Y,aa)})}return Y},changeRoute:function(Y){}});var U=B.extend({initialize:function(Y){B.prototype.initialize.call(this,Y);this.listenTo(this.search,"change",this.onSearchChange);this.jobs=new p(Y.jobs.data,{pagination:_.pick(Y.jobs.paging,"page","pageSize","total"),search:this.search});this.jobs.state.set({ready:true,error:null});this.pageView=new T({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces,jobs:this.jobs,ads:Y.ads});this.pageView.render()},changeRoute:function(Y){if(Backbone.history.fragment==this.search.toFullQueryString()){return}Y=_.extend({trigger:false,replace:false},Y);this.navigate(this.search.toFullQueryString(),Y);new Image().src=X.log+"?"+this.search.toQueryString()},onSearchChange:function(Y,Z){if(Z.source===this){return}clearInterval(this.timer);if(Z.pageChange){this.changeRoute({replace:false})}else{this.timer=setTimeout(_.bind(this.changeRoute,this,{replace:false}),4000)}}});var D=B.extend({initialize:function(Y){B.prototype.initialize.call(this,Y);this.pageView=new C({search:this.search,enabled:this.enabled,defaultLocation:this.defaultLocation,provinces:this.provinces});this.pageView.render()}});window.initializeMap=function(){A.initializeMap()};return{init:function(Y){z=Y.restPath;q=Y.labels;X(Y.restPath);switch(Y.type){case"search_jobs":A=new U(Y);break;case"saved_search":A=new D(Y);break;default:throw Error("options.type not supported.")}Backbone.history.start();var Z=document.createElement("script");Z.type="text/javascript";Z.src="https://maps.googleapis.com/maps/api/js?v=3.10&key=AIzaSyA7GqDK9GlTQJQc-WqPi-HHJ45vAtHgXAI&sensor=false&region=CA&callback=initializeMap";document.body.appendChild(Z)}}}(jQuery));